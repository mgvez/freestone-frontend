!function(){"use strict";var t=function(e){var r=e,n=function(){return r};return{get:n,set:function(t){r=t},clone:function(){return t(n())}}},e=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),n=tinymce.util.Tools.resolve("tinymce.util.Tools"),a=function(t,e){return((t=/^(\d+)([ms]?)$/.exec(""+(t||e)))[2]?{s:1e3,m:6e4}[t[2]]:1)*parseInt(t,10)},o=function(t){var e=t.getParam("autosave_prefix","tinymce-autosave-{path}{query}{hash}-{id}-");return(e=(e=(e=e.replace(/\{path\}/g,document.location.pathname)).replace(/\{query\}/g,document.location.search)).replace(/\{hash\}/g,document.location.hash)).replace(/\{id\}/g,t.id)},i=function(t,e){var r=t.settings.forced_root_block;return""===(e=n.trim(void 0===e?t.getBody().innerHTML:e))||new RegExp("^<"+r+"[^>]*>((Â |&nbsp;|[ \t]|<br[^>]*>)+?|)</"+r+">|<br>$","i").test(e)},s=function(t){var e=parseInt(r.getItem(o(t)+"time"),10)||0;return!((new Date).getTime()-e>function(t){return a(t.settings.autosave_retention,"20m")}(t)&&(u(t,!1),1))},u=function(t,e){var n=o(t);r.removeItem(n+"draft"),r.removeItem(n+"time"),!1!==e&&function(t){t.fire("RemoveDraft")}(t)},f=function(t){var e=o(t);!i(t)&&t.isDirty()&&(r.setItem(e+"draft",t.getContent({format:"raw",no_events:!0})),r.setItem(e+"time",(new Date).getTime().toString()),function(t){t.fire("StoreDraft")}(t))},c=function(t){var e=o(t);s(t)&&(t.setContent(r.getItem(e+"draft"),{format:"raw"}),function(t){t.fire("RestoreDraft")}(t))},l={isEmpty:i,hasDraft:s,removeDraft:u,storeDraft:f,restoreDraft:c,startStoreDraft:function(t,e){var r=function(t){return a(t.settings.autosave_interval,"30s")}(t);e.get()||(setInterval((function(){t.removed||f(t)}),r),e.set(!0))},restoreLastDraft:function(t){t.undoManager.transact((function(){c(t),u(t)})),t.focus()}},m=function(t,e){return function(){var r=Array.prototype.slice.call(arguments);return t.apply(null,[e].concat(r))}},v=tinymce.util.Tools.resolve("tinymce.EditorManager");v._beforeUnloadHandler=function(){var t;return n.each(v.get(),(function(e){e.plugins.autosave&&e.plugins.autosave.storeDraft(),!t&&e.isDirty()&&function(t){return t.getParam("autosave_ask_before_unload",!0)}(e)&&(t=e.translate("You have unsaved changes are you sure you want to navigate away?"))})),t};var d=function(t,e){return function(r){var n=r.control;n.disabled(!l.hasDraft(t)),t.on("StoreDraft RestoreDraft RemoveDraft",(function(){n.disabled(!l.hasDraft(t))})),l.startStoreDraft(t,e)}};e.add("autosave",(function(e){var r=t(!1);return window.onbeforeunload=v._beforeUnloadHandler,function(t,e){t.addButton("restoredraft",{title:"Restore last draft",onclick:function(){l.restoreLastDraft(t)},onPostRender:d(t,e)}),t.addMenuItem("restoredraft",{text:"Restore last draft",onclick:function(){l.restoreLastDraft(t)},onPostRender:d(t,e),context:"file"})}(e,r),function(t){return{hasDraft:m(l.hasDraft,t),storeDraft:m(l.storeDraft,t),restoreDraft:m(l.restoreDraft,t),removeDraft:m(l.removeDraft,t),isEmpty:m(l.isEmpty,t)}}(e)}))}();