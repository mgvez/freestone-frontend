!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),n=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),o=tinymce.util.Tools.resolve("tinymce.util.VK"),r=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),a=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),s=function(e){return e&&"BR"===e.nodeName},d=function(e){return e&&/^(OL|UL|DL)$/.test(e.nodeName)},l=function(e){return e&&/^(LI|DT|DD)$/.test(e.nodeName)},c=function(e){return e&&/^(TH|TD)$/.test(e.nodeName)},f=s,u=function(e){return e.parentNode.firstChild===e},m=function(e){return e.parentNode.lastChild===e},g=function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},p=function(e,t){return e&&e.nodeName in t},v=function(e,t){return!!s(t)&&!(!e.isBlock(t.nextSibling)||s(t.previousSibling))},h=function(e,t,n){var o=e.isEmpty(t);return!(n&&e.select("span[data-mce-type=bookmark]",t).length>0)&&o},C=function(e,t){return e.isChildOf(t,e.getRoot())},y=function(e,n){var o=t.getNode(e,n);return l(e)&&function(e){return e&&3===e.nodeType}(o)?{container:o,offset:n>=e.childNodes.length?o.data.length:0}:{container:e,offset:n}},N=function(e){var t=e.cloneRange(),n=y(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);var o=y(e.endContainer,e.endOffset);return t.setEnd(o.container,o.offset),t},L=a.DOM,S=function(e){var t={},n=function(n){var o,r,i;r=e[n?"startContainer":"endContainer"],i=e[n?"startOffset":"endOffset"],1===r.nodeType&&(o=L.create("span",{"data-mce-type":"bookmark"}),r.hasChildNodes()?(i=Math.min(i,r.childNodes.length-1),n?r.insertBefore(o,r.childNodes[i]):L.insertAfter(o,r.childNodes[i])):r.appendChild(o),r=o,i=0),t[n?"startContainer":"endContainer"]=r,t[n?"startOffset":"endOffset"]=i};return n(!0),e.collapsed||n(),t},b=function(e){function t(t){var n,o,r;n=r=e[t?"startContainer":"endContainer"],o=e[t?"startOffset":"endOffset"],n&&(1===n.nodeType&&(o=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1}(n),n=n.parentNode,L.remove(r),!n.hasChildNodes()&&L.isBlock(n)&&n.appendChild(L.create("br"))),e[t?"startContainer":"endContainer"]=n,e[t?"startOffset":"endOffset"]=o)}t(!0),t();var n=L.createRng();return n.setStart(e.startContainer,e.startOffset),e.endContainer&&n.setEnd(e.endContainer,e.endOffset),N(n)},D=a.DOM,k=function(e,t){i.each(i.grep(e.select("ol,ul",t)),(function(t){!function(e,t){var n,o=t.parentNode;"LI"===o.nodeName&&o.firstChild===t&&((n=o.previousSibling)&&"LI"===n.nodeName?(n.appendChild(t),h(e,o)&&D.remove(o)):D.setStyle(o,"listStyleType","none")),d(o)&&(n=o.previousSibling)&&"LI"===n.nodeName&&n.appendChild(t)}(e,t)}))},T=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),I=function(e){var t=e.selection.getStart(!0);return e.dom.getParent(t,"OL,UL,DL",B(e,t))},B=function(e,t){var n=e.dom.getParents(t,"TD,TH");return n.length>0?n[0]:e.getBody()},R={getParentList:I,getSelectedSubLists:function(e){var t,n,o,r=I(e),a=e.selection.getSelectedBlocks();return o=a,(n=r)&&1===o.length&&o[0]===n?(t=r,i.grep(t.querySelectorAll("ol,ul,dl"),(function(e){return d(e)}))):i.grep(a,(function(e){return d(e)&&r!==e}))},getSelectedListItems:function(e){var t,n,o,r=e.selection.getSelectedBlocks();return i.grep((t=e,n=r,o=i.map(n,(function(e){return t.dom.getParent(e,"li,dd,dt",B(t,e))||e})),T.unique(o)),(function(e){return l(e)}))},getClosestListRootElm:B},O=tinymce.util.Tools.resolve("tinymce.Env"),E=a.DOM,A=function(e,t,n){var o,r,i,a=E.createFragment(),s=e.schema.getBlockElements();if(e.settings.forced_root_block&&(n=n||e.settings.forced_root_block),n&&((r=E.create(n)).tagName===e.settings.forced_root_block&&E.setAttribs(r,e.settings.forced_root_block_attrs),p(t.firstChild,s)||a.appendChild(r)),t)for(;o=t.firstChild;){var d=o.nodeName;i||"SPAN"===d&&"bookmark"===o.getAttribute("data-mce-type")||(i=!0),p(o,s)?(a.appendChild(o),r=null):n?(r||(r=E.create(n),a.appendChild(r)),r.appendChild(o)):a.appendChild(o)}return e.settings.forced_root_block?i||O.ie&&!(O.ie>10)||r.appendChild(E.create("br",{"data-mce-bogus":"1"})):a.appendChild(E.create("br")),a},P=a.DOM,x=function(e,t,n,o){var r,a,s,d,l;for(s=P.select('span[data-mce-type="bookmark"]',t),o=o||A(e,n),(r=P.createRng()).setStartAfter(n),r.setEndAfter(t),d=(a=r.extractContents()).firstChild;d;d=d.firstChild)if("LI"===d.nodeName&&e.dom.isEmpty(d)){P.remove(d);break}e.dom.isEmpty(a)||P.insertAfter(a,t),P.insertAfter(o,t),h(e.dom,n.parentNode)&&(l=n.parentNode,i.each(s,(function(e){l.parentNode.insertBefore(e,n.parentNode)})),P.remove(l)),P.remove(n),h(e.dom,t)&&P.remove(t)},_=a.DOM,M=function(e,t){h(e,t)&&_.remove(t)},U=function(e,t){var n,o=t.parentNode,r=o.parentNode;return!(o!==e.getBody()&&("DD"===t.nodeName?(_.rename(t,"DT"),0):u(t)&&m(t)?("LI"===r.nodeName?(_.insertAfter(t,r),M(e.dom,r),_.remove(o)):d(r)?_.remove(o,!0):(r.insertBefore(A(e,t),o),_.remove(o)),0):u(t)?("LI"===r.nodeName?(_.insertAfter(t,r),t.appendChild(o),M(e.dom,r)):d(r)?r.insertBefore(t,o):(r.insertBefore(A(e,t),o),_.remove(t)),0):m(t)?("LI"===r.nodeName?_.insertAfter(t,r):d(r)?_.insertAfter(t,o):(_.insertAfter(A(e,t),o),_.remove(t)),0):("LI"===r.nodeName?(o=r,n=A(e,t,"LI")):n=d(r)?A(e,t,"LI"):A(e,t),x(e,o,t,n),k(e.dom,o.parentNode),0)))},H=U,$=function(e){var t=R.getSelectedListItems(e);if(t.length){var n=S(e.selection.getRng(!0)),o=void 0,r=void 0,i=R.getClosestListRootElm(e,e.selection.getStart(!0));for(o=t.length;o--;)for(var a=t[o].parentNode;a&&a!==i;){for(r=t.length;r--;)if(t[r]===a){t.splice(o,1);break}a=a.parentNode}for(o=0;o<t.length&&(U(e,t[o])||0!==o);o++);return e.selection.setRng(b(n)),e.nodeChanged(),!0}},w=function(e,t){i.each(t,(function(t,n){e.setAttribute(n,t)}))},K=function(e,t,n){var o,r,a,s,d,l,c;o=e,r=t,s=(a=n)["list-style-type"]?a["list-style-type"]:null,o.setStyle(r,"list-style-type",s),d=e,w(l=t,(c=n)["list-attributes"]),i.each(d.select("li",l),(function(e){w(e,c["list-item-attributes"])}))},Q=function(e,t,n,o){var r,i;for(r=t[n?"startContainer":"endContainer"],i=t[n?"startOffset":"endOffset"],1===r.nodeType&&(r=r.childNodes[Math.min(i,r.childNodes.length-1)]||r),!n&&f(r.nextSibling)&&(r=r.nextSibling);r.parentNode!==o;){if(g(e,r))return r;if(/^(TD|TH)$/.test(r.parentNode.nodeName))return r;r=r.parentNode}return r},W=function(e,t,n){void 0===n&&(n={});var o,a=e.selection.getRng(!0),s="LI",l=R.getClosestListRootElm(e,e.selection.getStart(!0)),c=e.dom;"false"!==c.getContentEditable(e.selection.getNode())&&("DL"===(t=t.toUpperCase())&&(s="DT"),o=S(a),i.each(function(e,t,n){for(var o,a=[],s=e.dom,d=Q(e,t,!0,n),l=Q(e,t,!1,n),c=[],u=d;u&&(c.push(u),u!==l);u=u.nextSibling);return i.each(c,(function(t){if(g(e,t))return a.push(t),void(o=null);if(s.isBlock(t)||f(t))return f(t)&&s.remove(t),void(o=null);var i=t.nextSibling;r.isBookmarkNode(t)&&(g(e,i)||!i&&t.parentNode===n)?o=null:(o||(o=s.create("p"),t.parentNode.insertBefore(o,t),a.push(o)),o.appendChild(t))})),a}(e,a,l),(function(o){var r,a,l,f,u,m,g,p;(a=o.previousSibling)&&d(a)&&a.nodeName===t&&(l=a,f=n,c.getStyle(l,"list-style-type")===(u=null===(u=f?f["list-style-type"]:"")?"":u))?(r=a,o=c.rename(o,s),a.appendChild(o)):(r=c.create(t),o.parentNode.insertBefore(r,o),r.appendChild(o),o=c.rename(o,s)),m=c,g=o,p=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],i.each(p,(function(e){return m.setStyle(g,((t={})[e]="",t));var t})),K(c,r,n),F(e.dom,r)})),e.selection.setRng(b(o)))},j=function(e){var t=S(e.selection.getRng(!0)),n=R.getClosestListRootElm(e,e.selection.getStart(!0)),o=R.getSelectedListItems(e),r=i.grep(o,(function(t){return e.dom.isEmpty(t)}));o=i.grep(o,(function(t){return!e.dom.isEmpty(t)})),i.each(r,(function(t){h(e.dom,t)&&H(e,t)})),i.each(o,(function(t){var o,r;if(t.parentNode!==e.getBody()){for(o=t;o&&o!==n;o=o.parentNode)d(o)&&(r=o);x(e,r,t),k(e.dom,r.parentNode)}})),e.selection.setRng(b(t))},q=function(e,t,n){return l=n,(s=t)&&l&&d(s)&&s.nodeName===l.nodeName&&(i=t,a=n,(r=e).getStyle(i,"list-style-type",!0)===r.getStyle(a,"list-style-type",!0))&&(o=n,t.className===o.className);var o,r,i,a,s,l},F=function(e,t){var n,o;if(n=t.nextSibling,q(e,t,n)){for(;o=n.firstChild;)t.appendChild(o);e.remove(n)}if(n=t.previousSibling,q(e,t,n)){for(;o=n.lastChild;)t.insertBefore(o,t.firstChild);e.remove(n)}},V=function(e){return"list-style-type"in e},z={toggleList:function(e,t,n){var o=R.getParentList(e),r=R.getSelectedSubLists(e);n=n||{},o&&r.length>0?function(e,t,n,o,r){if(t.nodeName!==o||V(r)){var a=S(e.selection.getRng(!0));i.each([t].concat(n),(function(t){!function(e,t,n,o){if(t.nodeName!==n){var r=e.rename(t,n);K(e,r,o)}else K(e,t,o)}(e.dom,t,o,r)})),e.selection.setRng(b(a))}else j(e)}(e,o,r,t,n):function(e,t,n,o){if(t!==e.getBody())if(t)if(t.nodeName!==n||V(o)){var r=S(e.selection.getRng(!0));K(e.dom,t,o),F(e.dom,e.dom.rename(t,n)),e.selection.setRng(b(r))}else j(e);else W(e,n,o)}(e,o,t,n)},removeList:j,mergeWithAdjacentLists:F},G=function(e,o,r,i){var a,s,d=o.startContainer,l=o.startOffset;if(3===d.nodeType&&(r?l<d.data.length:l>0))return d;for(a=e.schema.getNonEmptyElements(),1===d.nodeType&&(d=t.getNode(d,l)),s=new n(d,i),r&&v(e.dom,d)&&s.next();d=s[r?"next":"prev2"]();){if("LI"===d.nodeName&&!d.hasChildNodes())return d;if(a[d.nodeName])return d;if(3===d.nodeType&&d.data.length>0)return d}},J=function(e,t){var n=t.childNodes;return 1===n.length&&!d(n[0])&&e.isBlock(n[0])},X=function(e,t,n){var o,r,i=t.parentNode;C(e,t)&&C(e,n)&&(d(n.lastChild)&&(r=n.lastChild),i===n.lastChild&&f(i.previousSibling)&&e.remove(i.previousSibling),(o=n.lastChild)&&f(o)&&t.hasChildNodes()&&e.remove(o),h(e,n,!0)&&e.$(n).empty(),function(e,t,n){var o,r,i,a;if(r=J(e,n)?n.firstChild:n,J(i=e,a=t)&&i.remove(a.firstChild,!0),!h(e,t,!0))for(;o=t.firstChild;)r.appendChild(o)}(e,t,n),r&&n.appendChild(r),e.remove(t),h(e,i)&&i!==e.getRoot()&&e.remove(i))},Y=function(e,t){return e.selection.isCollapsed()?function(e,t){return function(e,t){var n,o,r,i=e.dom,a=e.selection,s=a.getStart(),d=R.getClosestListRootElm(e,s),l=i.getParent(a.getStart(),"LI",d);if(l){if((n=l.parentNode)===e.getBody()&&h(i,n))return!0;if(o=N(a.getRng(!0)),(r=i.getParent(G(e,o,t,d),"LI",d))&&r!==l)return t?function(e,t,n,o){var r,i,a,s=e.dom;if(s.isEmpty(o))i=n,a=o,(r=e).dom.$(a).empty(),X(r.dom,i,a),r.selection.setCursorLocation(a);else{var d=S(t);X(s,n,o),e.selection.setRng(b(d))}}(e,o,r,l):function(e,t,n,o){var r=S(t);X(e.dom,n,o);var i=b(r);e.selection.setRng(i)}(e,o,l,r),!0;if(!r&&!t&&z.removeList(e))return!0}return!1}(e,t)||function(e,t){var n=e.dom,o=e.selection.getStart(),r=R.getClosestListRootElm(e,o),i=n.getParent(o,n.isBlock,r);if(i&&n.isEmpty(i)){var a=N(e.selection.getRng(!0)),s=n.getParent(G(e,a,t,r),"LI",r);if(s)return e.undoManager.transact((function(){var o,a,d,l;a=i,d=r,l=(o=n).getParent(a.parentNode,o.isBlock,d),o.remove(a),l&&o.isEmpty(l)&&o.remove(l),z.mergeWithAdjacentLists(n,s.parentNode),e.selection.select(s,!0),e.selection.collapse(t)})),!0}return!1}(e,t)}(e,t):(o=(n=e).selection.getStart(),r=R.getClosestListRootElm(n,o),!!(n.dom.getParent(o,"LI,DT,DD",r)||R.getSelectedListItems(n).length>0)&&(n.undoManager.transact((function(){n.execCommand("Delete"),k(n.dom,n.getBody())})),!0));var n,o,r},Z=Y,ee=a.DOM,te=function(e,t){var n;if(d(e)){for(;n=e.firstChild;)t.appendChild(n);ee.remove(e)}},ne=function(e){var t,n,o,r,i=R.getSelectedListItems(e);if(i.length){for(var a=S(e.selection.getRng(!0)),s=0;s<i.length&&(n=void 0,o=void 0,r=void 0,("DT"===(t=i[s]).nodeName?(ee.rename(t,"DD"),1):(n=t.previousSibling)&&d(n)?(n.appendChild(t),1):n&&"LI"===n.nodeName&&d(n.lastChild)?(n.lastChild.appendChild(t),te(t.lastChild,n.lastChild),1):(n=t.nextSibling)&&d(n)?(n.insertBefore(t,n.firstChild),1):(n=t.previousSibling)&&"LI"===n.nodeName&&(o=ee.create(t.parentNode.nodeName),(r=ee.getStyle(t.parentNode,"listStyleType"))&&ee.setStyle(o,"listStyleType",r),n.appendChild(o),o.appendChild(t),te(t.lastChild,o),1))||0!==s);s++);return e.selection.setRng(b(a)),e.nodeChanged(),!0}},oe=function(e,t){return function(){var n=e.dom.getParent(e.selection.getStart(),"UL,OL,DL");return n&&n.nodeName===t}},re=function(e,t){return function(n){var o=n.control;e.on("NodeChange",(function(e){var n=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}(e.parents,c),r=-1!==n?e.parents.slice(0,n):e.parents,a=i.grep(r,d);o.active(a.length>0&&a[0].nodeName===t)}))}};e.add("lists",(function(e){return function(e){var t;(function(e){return e.getParam("lists_indent_on_tab",!0)})(e)&&(t=e).on("keydown",(function(e){e.keyCode!==o.TAB||o.metaKeyPressed(e)||t.dom.getParent(t.selection.getStart(),"LI,DT,DD")&&(e.preventDefault(),e.shiftKey?$(t):ne(t))})),function(e){e.on("keydown",(function(t){t.keyCode===o.BACKSPACE?Y(e,!1)&&t.preventDefault():t.keyCode===o.DELETE&&Y(e,!0)&&t.preventDefault()}))}(e)}(e),function(e){var t,n,o;n=(t=e).settings.plugins?t.settings.plugins:"",-1===i.inArray(n.split(/[ ,]/),"advlist")&&(e.addButton("numlist",{active:!1,title:"Numbered list",cmd:"InsertOrderedList",onPostRender:re(e,"OL")}),e.addButton("bullist",{active:!1,title:"Bullet list",cmd:"InsertUnorderedList",onPostRender:re(e,"UL")})),e.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:(o=e,function(e){var t=e.control;o.on("nodechange",(function(){var e=R.getSelectedListItems(o),n=e.length>0&&u(e[0]);t.disabled(n)}))})})}(e),function(e){e.on("BeforeExecCommand",(function(t){var n,o=t.command.toLowerCase();if("indent"===o?ne(e)&&(n=!0):"outdent"===o&&$(e)&&(n=!0),n)return e.fire("ExecCommand",{command:t.command}),t.preventDefault(),!0})),e.addCommand("InsertUnorderedList",(function(t,n){z.toggleList(e,"UL",n)})),e.addCommand("InsertOrderedList",(function(t,n){z.toggleList(e,"OL",n)})),e.addCommand("InsertDefinitionList",(function(t,n){z.toggleList(e,"DL",n)})),e.addQueryStateHandler("InsertUnorderedList",oe(e,"UL")),e.addQueryStateHandler("InsertOrderedList",oe(e,"OL")),e.addQueryStateHandler("InsertDefinitionList",oe(e,"DL"))}(e),function(e){return{backspaceDelete:function(t){Z(e,t)}}}(e)}))}();