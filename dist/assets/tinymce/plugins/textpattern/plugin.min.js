!function(){"use strict";var t=function(e){var n=e,r=function(){return n};return{get:r,set:function(t){n=t},clone:function(){return t(r())}}},e=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],r=function(t){return void 0!==t.textpattern_patterns?t.textpattern_patterns:n},a=tinymce.util.Tools.resolve("tinymce.util.Delay"),o=tinymce.util.Tools.resolve("tinymce.util.VK"),s=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),f=function(t,e){for(var n=0;n<t.length;n++)if(0===e.indexOf(t[n].start)&&(!t[n].end||e.lastIndexOf(t[n].end)===e.length-t[n].end.length))return t[n]},d=function(t,e,n){var r=t.selection.getRng(!0),a=function(t,e,n){if(!1!==e.collapsed){var r=e.startContainer,a=r.data,o=!0===n?1:0;if(3===r.nodeType){var s=function(t,e,n,r){var a,o,s,i,f,d,l=t.sort((function(t,e){return t.start.length>e.start.length?-1:t.start.length<e.start.length?1:0}));for(o=0;o<l.length;o++)if(void 0!==(a=l[o]).end&&(i=a,f=n,d=r,e.substr(f-i.end.length-d,i.end.length)===i.end)&&n-r-(s=a).end.length-s.start.length>0)return a}(t,a,e.startOffset,o);if(void 0!==s){var i=a.lastIndexOf(s.end,e.startOffset-o),d=a.lastIndexOf(s.start,i-s.end.length);if(i=a.indexOf(s.end,d+s.start.length),-1!==d){var l=document.createRange();l.setStart(r,d),l.setEnd(r,i+s.end.length);var u=f(t,l.toString());if(!(void 0===s||u!==s||r.data.length<=s.start.length+s.end.length))return{pattern:s,startOffset:d,endOffset:i}}}}}}(e,r,n);if(a)return function(t,e,n,r){var a=i.isArray(n.pattern.format)?n.pattern.format:[n.pattern.format];if(0!==i.grep(a,(function(e){var n=t.formatter.get(e);return n&&n[0].inline})).length)return t.undoManager.transact((function(){var r,o,s,i;r=e,o=n.pattern,s=n.endOffset,(r=(i=n.startOffset)>0?r.splitText(i):r).splitText(s-i+o.end.length),r.deleteData(0,o.start.length),r.deleteData(r.data.length-o.end.length,o.end.length),e=r,a.forEach((function(n){t.formatter.apply(n,{},e)}))})),e}(t,r.startContainer,a)},l=function(t,e,n){for(var r=0;r<t.length;r++)if(n(t[r],e))return!0},u=function(t,e){var n,r;(n=function(t,e){return d(t,e,!1)}(t,e))&&((r=t.dom.createRng()).setStart(n,n.data.length),r.setEnd(n,n.data.length),t.selection.setRng(r)),function(t,e){var n,r,a,o,d,l,u,c,g,m,h;if(n=t.selection,r=t.dom,n.isCollapsed()&&(u=r.getParent(n.getStart(),"p"))){for(g=new s(u,u);d=g.next();)if(3===d.nodeType){o=d;break}if(o){if(!(c=f(e,o.data)))return;if(a=(m=n.getRng(!0)).startContainer,h=m.startOffset,o===a&&(h=Math.max(0,h-c.start.length)),i.trim(o.data).length===c.start.length)return;c.format&&(l=t.formatter.get(c.format))&&l[0].block&&(o.deleteData(0,c.start.length),t.formatter.apply(c.format,{},o),m.setStart(a,h),m.collapse(!0),n.setRng(m)),c.cmd&&t.undoManager.transact((function(){o.deleteData(0,c.start.length),t.execCommand(c.cmd)}))}}}(t,e)},c=function(t,e){var n,r,a,o,s;(n=function(t,e){return d(t,e,!0)}(t,e))&&(s=t.dom,r=n.data.slice(-1),/[\u00a0 ]/.test(r)&&(n.deleteData(n.data.length-1,1),a=s.doc.createTextNode(r),s.insertAfter(a,n.parentNode),(o=s.createRng()).setStart(a,1),o.setEnd(a,1),t.selection.setRng(o)))};e.add("textpattern",(function(e){var n=t(r(e.settings));return function(t,e){var n=[",",".",";",":","!","?"],r=[32];t.on("keydown",(function(n){13!==n.keyCode||o.modifierPressed(n)||u(t,e.get())}),!0),t.on("keyup",(function(n){(function(t,e){return l(t,e,(function(t,e){return t===e.keyCode&&!1===o.modifierPressed(e)}))})(r,n)&&c(t,e.get())})),t.on("keypress",(function(r){(function(t,e){return l(t,e,(function(t,e){return t.charCodeAt(0)===e.charCode}))})(n,r)&&a.setEditorTimeout(t,(function(){c(t,e.get())}))}))}(e,n),function(t){return{setPatterns:function(e){t.set(e)},getPatterns:function(){return t.get()}}}(n)}))}();