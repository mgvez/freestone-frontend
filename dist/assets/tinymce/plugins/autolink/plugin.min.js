!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.Env"),n=function(e,t){if(t<0&&(t=0),3===e.nodeType){var n=e.data.length;t>n&&(t=n)}return t},i=function(e,t,i){1!==t.nodeType||t.hasChildNodes()?e.setStart(t,n(t,i)):e.setStartBefore(t)},o=function(e,t,i){1!==t.nodeType||t.hasChildNodes()?e.setEnd(t,n(t,i)):e.setEndAfter(t)},r=function(e,t,n){var r,a,f,s,d,l,c,u,g,h,C=function(e){return e.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i)}(e),m=function(e){return e.getParam("default_link_target","")}(e);if("A"!==e.selection.getNode().tagName){if((r=e.selection.getRng(!0).cloneRange()).startOffset<5){if(!(u=r.endContainer.previousSibling)){if(!r.endContainer.firstChild||!r.endContainer.firstChild.nextSibling)return;u=r.endContainer.firstChild.nextSibling}if(g=u.length,i(r,u,g),o(r,u,g),r.endOffset<5)return;a=r.endOffset,s=u}else{if(3!==(s=r.endContainer).nodeType&&s.firstChild){for(;3!==s.nodeType&&s.firstChild;)s=s.firstChild;3===s.nodeType&&(i(r,s,0),o(r,s,s.nodeValue.length))}a=1===r.endOffset?2:r.endOffset-1-t}for(f=a;i(r,s,a>=2?a-2:0),o(r,s,a>=1?a-1:0),a-=1," "!==(h=r.toString())&&""!==h&&160!==h.charCodeAt(0)&&a-2>=0&&h!==n;);var y;(y=r.toString())===n||" "===y||160===y.charCodeAt(0)?(i(r,s,a),o(r,s,f),a+=1):0===r.startOffset?(i(r,s,0),o(r,s,f)):(i(r,s,a),o(r,s,f)),"."===(l=r.toString()).charAt(l.length-1)&&o(r,s,f-1),(c=(l=r.toString().trim()).match(C))&&("www."===c[1]?c[1]="http://www.":/@$/.test(c[1])&&!/^mailto:/.test(c[1])&&(c[1]="mailto:"+c[1]),d=e.selection.getBookmark(),e.selection.setRng(r),e.execCommand("createlink",!1,c[1]+c[2]),m&&e.dom.setAttrib(e.selection.getNode(),"target",m),e.selection.moveToBookmark(d),e.nodeChanged())}};e.add("autolink",(function(e){!function(e){var n;e.on("keydown",(function(t){13!==t.keyCode||r(e,-1,"")})),t.ie?e.on("focus",(function(){if(!n){n=!0;try{e.execCommand("AutoUrlDetect",!1,!0)}catch(e){}}})):(e.on("keypress",(function(t){41!==t.keyCode||r(e,-1,"(")})),e.on("keyup",(function(t){32!==t.keyCode||r(e,0,"")})))}(e)}))}();