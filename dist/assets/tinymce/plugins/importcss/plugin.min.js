!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),n=tinymce.util.Tools.resolve("tinymce.EditorManager"),r=tinymce.util.Tools.resolve("tinymce.Env"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),c=function(e){return e.getParam("importcss_selector_converter")},o=function(e){var t=r.cacheSuffix;return"string"==typeof e&&(e=e.replace("?"+t,"").replace("&"+t,"")),e},s=function(e,t){var r=e.settings,i=!1!==r.skin&&(r.skin||"lightgray");return!!i&&t===(r.skin_url?e.documentBaseURI.toAbsolute(r.skin_url):n.baseURL+"/skins/"+i)+"/content"+(e.inline?".inline":"")+".min.css"},u=function(e){return"string"==typeof e?function(t){return-1!==t.indexOf(e)}:e instanceof RegExp?function(t){return e.test(t)}:e},l=function(e,t,n){var r=[],c={};i.each(e.contentCSS,(function(e){c[e]=!0})),n||(n=function(e,t){return t||c[e]});try{i.each(t.styleSheets,(function(t){!function t(c,u){var l,a=c.href;if((a=o(a))&&n(a,u)&&!s(e,a)){i.each(c.imports,(function(e){t(e,!0)}));try{l=c.cssRules||c.rules}catch(e){}i.each(l,(function(e){e.styleSheet?t(e.styleSheet,!0):e.selectorText&&i.each(e.selectorText.split(","),(function(e){r.push(i.trim(e))}))}))}}(t)}))}catch(e){}return r},a=function(e,t){var n,r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(r){var c=r[1],o=r[2].substr(1).split(".").join(" "),s=i.makeMap("a,img");return r[1]?(n={title:t},e.schema.getTextBlockElements()[c]?n.block=c:e.schema.getBlockElements()[c]||s[c.toLowerCase()]?n.selector=c:n.inline=c):r[2]&&(n={inline:"span",title:t.substr(1),classes:o}),!1!==function(e){return e.getParam("importcss_merge_classes")}(e)?n.classes=o:n.attributes={class:o},n}},f=function(e,t){return null===t||!1!==function(e){return e.getParam("importcss_exclusive")}(e)},m=a;e.add("importcss",(function(e){return function(e){e.on("renderFormatsMenu",(function(n){var r,o={},s=u(function(e){return e.getParam("importcss_selector_filter")}(e)),m=n.control,g=(r=function(e){return e.getParam("importcss_groups")}(e),i.map(r,(function(e){return i.extend({},e,{original:e,selectors:{},filter:u(e.filter),item:{text:e.title,menu:[]}})}))),p=function(n,r){if(_=n,T=o,!(f(e,x=r)?_ in T:_ in x.selectors)){h=n,y=o,f(e,d=r)?y[h]=!0:d.selectors[h]=!0;var s=(l=e,g=e.plugins.importcss,p=n,((v=r)&&v.selector_converter?v.selector_converter:c(l)?c(l):function(){return a(l,p)}).call(g,p,v));if(s){var u=s.name||t.DOM.uniqueId();return e.formatter.register(u,s),i.extend({},m.settings.itemDefaults,{text:s.title,format:u})}}var l,g,p,v,h,d,y,_,x,T;return null};(function(e){return e.getParam("importcss_append")})(e)||m.items().remove(),i.each(l(e,n.doc||e.getDoc(),u(function(e){return e.getParam("importcss_file_filter")}(e))),(function(e){if(-1===e.indexOf(".mce-")&&(!s||s(e))){var t=(r=g,c=e,i.grep(r,(function(e){return!e.filter||e.filter(c)})));if(t.length>0)i.each(t,(function(t){var n=p(e,t);n&&t.item.menu.push(n)}));else{var n=p(e,null);n&&m.add(n)}}var r,c})),i.each(g,(function(e){e.item.menu.length>0&&m.add(e.item)})),n.control.renderNew()}))}(e),function(e){return{convertSelectorToFormat:function(t){return m(e,t)}}}(e)}))}();