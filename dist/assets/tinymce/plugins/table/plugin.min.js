!function(){"use strict";var n,t,e,r,o,i,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=function(n){return function(){return n}},c={noop:function(){},noarg:function(n){return function(){return n()}},compose:function(n,t){return function(){return n(t.apply(null,arguments))}},constant:a,identity:function(n){return n},tripleEquals:function(n,t){return n===t},curry:function(n){for(var t=new Array(arguments.length-1),e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var o=t.concat(e);return n.apply(null,o)}},not:function(n){return function(){return!n.apply(null,arguments)}},die:function(n){return function(){throw new Error(n)}},apply:function(n){return n()},call:function(n){n()},never:a(!1),always:a(!0)},l=c.never,s=c.always,f=function(){return d},d=(r={fold:function(n,t){return n()},is:l,isSome:l,isNone:s,getOr:e=function(n){return n},getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},or:e,orThunk:t,map:f,ap:f,each:function(){},bind:f,flatten:f,exists:l,forall:s,filter:f,equals:n=function(n){return n.isNone()},equals_:n,toArray:function(){return[]},toString:c.constant("none()")},Object.freeze&&Object.freeze(r),r),m=function(n){var t=function(){return n},e=function(){return o},r=function(t){return t(n)},o={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:s,isNone:l,getOr:t,getOrThunk:t,getOrDie:t,or:e,orThunk:e,map:function(t){return m(t(n))},ap:function(t){return t.fold(f,(function(t){return m(t(n))}))},each:function(t){t(n)},bind:r,flatten:t,exists:r,forall:r,filter:function(t){return t(n)?o:d},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(l,(function(t){return e(n,t)}))},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},g={some:m,none:f,from:function(n){return null==n?d:m(n)}},p=void 0===(o=Array.prototype.indexOf)?function(n,t){return w(n,t)}:function(n,t){return o.call(n,t)},h=function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o,n)}return r},v=function(n,t){for(var e=0,r=n.length;e<r;e++)t(n[e],e,n)},b=function(n,t){for(var e=0,r=n.length;e<r;e++)if(t(n[e],e,n))return g.some(e);return g.none()},w=function(n,t){for(var e=0,r=n.length;e<r;++e)if(n[e]===t)return e;return-1},y=Array.prototype.push,x=function(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!Array.prototype.isPrototypeOf(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);y.apply(t,n[e])}return t},R=Array.prototype.slice,C=h,S=v,T=function(n,t){for(var e=[],r=0,o=n.length;r<o;r++){var i=n[r];t(i,r,n)&&e.push(i)}return e},D=function(n,t,e){return function(n,t){for(var e=n.length-1;e>=0;e--)t(n[e],e,n)}(n,(function(n){e=t(e,n)})),e},k=function(n,t,e){return v(n,(function(n){e=t(e,n)})),e},A=function(n,t){for(var e=0,r=n.length;e<r;e++){var o=n[e];if(t(o,e,n))return g.some(o)}return g.none()},O=b,N=x,P=function(n,t){var e=h(n,t);return x(e)},B=function(n,t){for(var e=0,r=n.length;e<r;++e)if(!0!==t(n[e],e,n))return!1;return!0},E=function(n,t){return b(n,t).isSome()},I=function(n,t){return p(n,t)>-1},W=function(n){var t=R.call(n,0);return t.reverse(),t},M=void 0===(i=Object.keys)?function(n){var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t}:i,q=function(n,t){for(var e=M(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i,n)}},_=function(n,t){var e={};return q(n,(function(r,o){var i=t(r,o,n);e[i.k]=i.v})),e},j=function(n,t){var e=[];return q(n,(function(n,r){e.push(t(n,r))})),e},z=function(n){return j(n,(function(n){return n}))},L={bifilter:function(n,t){var e={},r={};return q(n,(function(n,o){(t(n,o)?e:r)[o]=n})),{t:e,f:r}},each:q,map:function(n,t){return _(n,(function(n,e,r){return{k:e,v:t(n,e,r)}}))},mapToArray:j,tupleMap:_,find:function(n,t){for(var e=M(n),r=0,o=e.length;r<o;r++){var i=e[r],u=n[i];if(t(u,i,n))return g.some(u)}return g.none()},keys:M,values:z,size:function(n){return z(n).length}},H=function(n){return function(t){return function(n){if(null===n)return"null";var t=typeof n;return"object"===t&&Array.prototype.isPrototypeOf(n)?"array":"object"===t&&String.prototype.isPrototypeOf(n)?"string":t}(t)===n}},F={isString:H("string"),isObject:H("object"),isArray:H("array"),isNull:H("null"),isBoolean:H("boolean"),isUndefined:H("undefined"),isFunction:H("function"),isNumber:H("number")},V=function(n){return n.slice(0).sort()},U=function(n,t){throw new Error("All required keys ("+V(n).join(", ")+") were not specified. Specified keys were: "+V(t).join(", ")+".")},G=function(n){throw new Error("Unsupported keys for object: "+V(n).join(", "))},X=function(n,t){if(!F.isArray(t))throw new Error("The "+n+" fields must be an array. Was: "+t+".");S(t,(function(t){if(!F.isString(t))throw new Error("The value "+t+" in the "+n+" fields was not a string.")}))},Y=function(n){var t=V(n);A(t,(function(n,e){return e<t.length-1&&n===t[e+1]})).each((function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+t.join(", ")+"].")}))},K={immutable:function(){var n=arguments;return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];if(n.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+t.length+" arguments");var r={};return S(n,(function(n,e){r[n]=c.constant(t[e])})),r}},immutableBag:function(n,t){var e=n.concat(t);if(0===e.length)throw new Error("You must specify at least one required or optional field.");return X("required",n),X("optional",t),Y(e),function(r){var o=L.keys(r);B(n,(function(n){return I(o,n)}))||U(n,o);var i=T(o,(function(n){return!I(e,n)}));i.length>0&&G(i);var u={};return S(n,(function(n){u[n]=c.constant(r[n])})),S(t,(function(n){u[n]=c.constant(Object.prototype.hasOwnProperty.call(r,n)?g.some(r[n]):g.none())})),u}}},J=K.immutable("width","height"),$=K.immutable("rows","columns"),Q=K.immutable("row","column"),Z=K.immutable("x","y"),nn=K.immutable("element","rowspan","colspan"),tn=K.immutable("element","rowspan","colspan","isNew"),en={dimensions:J,grid:$,address:Q,coords:Z,extended:K.immutable("element","rowspan","colspan","row","column"),detail:nn,detailnew:tn,rowdata:K.immutable("element","cells","section"),elementnew:K.immutable("element","isNew"),rowdatanew:K.immutable("element","cells","section","isNew"),rowcells:K.immutable("cells","section"),rowdetails:K.immutable("details","section"),bounds:K.immutable("startRow","startCol","finishRow","finishCol")},rn=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:c.constant(n)}},on={fromHtml:function(n,t){var e=(t||document).createElement("div");if(e.innerHTML=n,!e.hasChildNodes()||e.childNodes.length>1)throw console.error("HTML does not have a single root node",n),"HTML must have a single root node";return rn(e.childNodes[0])},fromTag:function(n,t){var e=(t||document).createElement(n);return rn(e)},fromText:function(n,t){var e=(t||document).createTextNode(n);return rn(e)},fromDom:rn,fromPoint:function(n,t,e){return g.from(n.dom().elementFromPoint(t,e)).map(rn)}},un=function(n){return 1!==n.nodeType&&9!==n.nodeType||0===n.childElementCount},an={all:function(n,t){var e=void 0===t?document:t.dom();return un(e)?[]:C(e.querySelectorAll(n),on.fromDom)},is:function(n,t){var e=n.dom();if(1!==e.nodeType)return!1;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},one:function(n,t){var e=void 0===t?document:t.dom();return un(e)?g.none():g.from(e.querySelector(n)).map(on.fromDom)}},cn=function(n,t){for(var e=[],r=function(n){return e.push(n),t(n)},o=t(n);(o=o.bind(r)).isSome(););return e},ln="undefined"!=typeof window?window:Function("return this;")(),sn=function(){return function(n,t){var e=function(n,t){return function(n,t){for(var e=null!=t?t:ln,r=0;r<n.length&&null!=e;++r)e=e[n[r]];return e}(n.split("."),t)}(n,void 0);if(null==e)throw n+" not available on this browser";return e}("Node")},fn=function(n){var t,e=!1;return function(){return e||(e=!0,t=n.apply(null,arguments)),t}},dn=function(){return mn(0,0)},mn=function(n,t){return{major:n,minor:t}},gn=function(n,t){var e=String(t).toLowerCase();return 0===n.length?dn():function(n,t){var e=function(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(r.test(t))return r}}(n,t);if(!e)return{major:0,minor:0};var r=function(n){return Number(t.replace(e,"$"+n))};return mn(r(1),r(2))}(n,e)},pn=dn,hn="Firefox",vn=function(n,t){return function(){return t===n}},bn=function(n){var t=n.current;return{current:t,version:n.version,isEdge:vn("Edge",t),isChrome:vn("Chrome",t),isIE:vn("IE",t),isOpera:vn("Opera",t),isFirefox:vn(hn,t),isSafari:vn("Safari",t)}},wn=function(){return bn({current:void 0,version:pn()})},yn=bn,xn=(c.constant("Edge"),c.constant("Chrome"),c.constant("IE"),c.constant("Opera"),c.constant(hn),c.constant("Safari"),"Windows"),Rn="Android",Cn="Solaris",Sn="FreeBSD",Tn=function(n,t){return function(){return t===n}},Dn=function(n){var t=n.current;return{current:t,version:n.version,isWindows:Tn(xn,t),isiOS:Tn("iOS",t),isAndroid:Tn(Rn,t),isOSX:Tn("OSX",t),isLinux:Tn("Linux",t),isSolaris:Tn(Cn,t),isFreeBSD:Tn(Sn,t)}},kn=function(){return Dn({current:void 0,version:pn()})},An=Dn,On=(c.constant(xn),c.constant("iOS"),c.constant(Rn),c.constant("Linux"),c.constant("OSX"),c.constant(Cn),c.constant(Sn),function(n,t){var e=String(t).toLowerCase();return A(n,(function(n){return n.search(e)}))}),Nn=function(n,t){return function(n,t,e){return""===t||!(n.length<t.length)&&n.substr(e,e+t.length)===t}(n,t,n.length-t.length)},Pn=function(n,t){return-1!==n.indexOf(t)},Bn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,En=function(n){return function(t){return Pn(t,n)}},In=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return Pn(n,"edge/")&&Pn(n,"chrome")&&Pn(n,"safari")&&Pn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Bn],search:function(n){return Pn(n,"chrome")&&!Pn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return Pn(n,"msie")||Pn(n,"trident")}},{name:"Opera",versionRegexes:[Bn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:En("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:En("firefox")},{name:"Safari",versionRegexes:[Bn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(Pn(n,"safari")||Pn(n,"mobile/"))&&Pn(n,"applewebkit")}}],Wn=[{name:"Windows",search:En("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return Pn(n,"iphone")||Pn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:En("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:En("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:En("linux"),versionRegexes:[]},{name:"Solaris",search:En("sunos"),versionRegexes:[]},{name:"FreeBSD",search:En("freebsd"),versionRegexes:[]}],Mn={browsers:c.constant(In),oses:c.constant(Wn)},qn={detect:fn((function(){return function(n){var t,e,r,o,i,u,a,l,s,f,d,m=Mn.browsers(),g=Mn.oses(),p=function(n,t){return On(n,t).map((function(n){var e=gn(n.versionRegexes,t);return{current:n.name,version:e}}))}(m,n).fold(wn,yn),h=function(n,t){return On(n,t).map((function(n){var e=gn(n.versionRegexes,t);return{current:n.name,version:e}}))}(g,n).fold(kn,An);return{browser:p,os:h,deviceType:(e=p,r=n,o=(t=h).isiOS()&&!0===/ipad/i.test(r),i=t.isiOS()&&!o,u=t.isAndroid()&&3===t.version.major,a=t.isAndroid()&&4===t.version.major,l=o||u||a&&!0===/mobile/i.test(r),s=t.isiOS()||t.isAndroid(),f=s&&!l,d=e.isSafari()&&t.isiOS()&&!1===/safari/i.test(r),{isiPad:c.constant(o),isiPhone:c.constant(i),isTablet:c.constant(l),isPhone:c.constant(f),isTouch:c.constant(s),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:c.constant(d)})}}(navigator.userAgent)}))},_n=function(n,t){return n.dom()===t.dom()},jn=qn.detect().browser.isIE()?function(n,t){return function(n,t){return function(n,t,e){return 0!=(n.compareDocumentPosition(t)&e)}(n,t,sn().DOCUMENT_POSITION_CONTAINED_BY)}(n.dom(),t.dom())}:function(n,t){var e=n.dom(),r=t.dom();return e!==r&&e.contains(r)},zn={eq:_n,isEqualNode:function(n,t){return n.dom().isEqualNode(t.dom())},member:function(n,t){return E(t,c.curry(_n,n))},contains:jn,is:an.is},Ln=function(n){return on.fromDom(n.dom().ownerDocument)},Hn=function(n){var t=n.dom();return g.from(t.parentNode).map(on.fromDom)},Fn=function(n){var t=n.dom();return g.from(t.previousSibling).map(on.fromDom)},Vn=function(n){var t=n.dom();return g.from(t.nextSibling).map(on.fromDom)},Un=function(n){var t=n.dom();return C(t.childNodes,on.fromDom)},Gn=function(n,t){var e=n.dom().childNodes;return g.from(e[t]).map(on.fromDom)},Xn=K.immutable("element","offset"),Yn={owner:Ln,defaultView:function(n){var t=n.dom().ownerDocument.defaultView;return on.fromDom(t)},documentElement:function(n){var t=Ln(n);return on.fromDom(t.dom().documentElement)},parent:Hn,findIndex:function(n){return Hn(n).bind((function(t){var e=Un(t);return O(e,(function(t){return zn.eq(n,t)}))}))},parents:function(n,t){for(var e=F.isFunction(t)?t:c.constant(!1),r=n.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var i=r.parentNode,u=on.fromDom(i);if(o.push(u),!0===e(u))break;r=i}return o},siblings:function(n){return Hn(n).map(Un).map((function(t){return T(t,(function(t){return!zn.eq(n,t)}))})).getOr([])},prevSibling:Fn,offsetParent:function(n){var t=n.dom();return g.from(t.offsetParent).map(on.fromDom)},prevSiblings:function(n){return W(cn(n,Fn))},nextSibling:Vn,nextSiblings:function(n){return cn(n,Vn)},children:Un,child:Gn,firstChild:function(n){return Gn(n,0)},lastChild:function(n){return Gn(n,n.dom().childNodes.length-1)},childNodesCount:function(n){return n.dom().childNodes.length},hasChildNodes:function(n){return n.dom().hasChildNodes()},leaf:function(n,t){var e=Un(n);return e.length>0&&t<e.length?Xn(e[t],0):Xn(n,t)}},Kn=function(n,t,e){return P(Yn.children(n),(function(n){return an.is(n,t)?e(n)?[n]:[]:Kn(n,t,e)}))},Jn={firstLayer:function(n,t){return Kn(n,t,c.constant(!0))},filterFirstLayer:Kn},$n=function(n){return n.dom().nodeName.toLowerCase()},Qn=function(n){return n.dom().nodeType},Zn=function(n){return function(t){return Qn(t)===n}},nt=Zn(1),tt=Zn(3),et=Zn(9),rt={name:$n,type:Qn,value:function(n){return n.dom().nodeValue},isElement:nt,isText:tt,isDocument:et,isComment:function(n){return 8===Qn(n)||"#comment"===$n(n)}},ot=function(n,t,e){if(!(F.isString(e)||F.isBoolean(e)||F.isNumber(e)))throw console.error("Invalid call to Attr.set. Key ",t,":: Value ",e,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,e+"")},it=function(n,t,e){ot(n.dom(),t,e)},ut=function(n,t){var e=n.dom().getAttribute(t);return null===e?void 0:e},at=function(n,t){var e=n.dom();return!(!e||!e.hasAttribute)&&e.hasAttribute(t)},ct={clone:function(n){return k(n.dom().attributes,(function(n,t){return n[t.name]=t.value,n}),{})},set:it,setAll:function(n,t){var e=n.dom();L.each(t,(function(n,t){ot(e,t,n)}))},get:ut,has:at,remove:function(n,t){n.dom().removeAttribute(t)},hasNone:function(n){var t=n.dom().attributes;return null==t||0===t.length},transfer:function(n,t,e){rt.isElement(n)&&rt.isElement(t)&&S(e,(function(e){var r,o,i;o=t,at(r=n,i=e)&&!at(o,i)&&it(o,i,ut(r,i))}))}},lt=fn((function(){return st(on.fromDom(document))})),st=function(n){var t=n.dom().body;if(null==t)throw"Body is not available yet";return on.fromDom(t)},ft={body:lt,getBody:st,inBody:function(n){var t=rt.isText(n)?n.dom().parentNode:n.dom();return null!=t&&t.ownerDocument.body.contains(t)}},dt=function(n,t){var e=[];return S(Yn.children(n),(function(n){t(n)&&(e=e.concat([n])),e=e.concat(dt(n,t))})),e},mt={all:function(n){return dt(ft.body(),n)},ancestors:function(n,t,e){return T(Yn.parents(n,e),t)},siblings:function(n,t){return T(Yn.siblings(n),t)},children:function(n,t){return T(Yn.children(n),t)},descendants:dt},gt={all:function(n){return an.all(n)},ancestors:function(n,t,e){return mt.ancestors(n,(function(n){return an.is(n,t)}),e)},siblings:function(n,t){return mt.siblings(n,(function(n){return an.is(n,t)}))},children:function(n,t){return mt.children(n,(function(n){return an.is(n,t)}))},descendants:function(n,t){return an.all(t,n)}};function pt(n,t,e,r,o){return n(e,r)?g.some(e):F.isFunction(o)&&o(e)?g.none():t(e,r,o)}var ht,vt,bt,wt,yt=function(n,t,e){for(var r=n.dom(),o=F.isFunction(e)?e:c.constant(!1);r.parentNode;){r=r.parentNode;var i=on.fromDom(r);if(t(i))return g.some(i);if(o(i))break}return g.none()},xt=function(n,t){return A(n.dom().childNodes,c.compose(t,on.fromDom)).map(on.fromDom)},Rt=function(n,t){var e=function(n){for(var r=0;r<n.childNodes.length;r++){if(t(on.fromDom(n.childNodes[r])))return g.some(on.fromDom(n.childNodes[r]));var o=e(n.childNodes[r]);if(o.isSome())return o}return g.none()};return e(n.dom())},Ct={first:function(n){return Rt(ft.body(),n)},ancestor:yt,closest:function(n,t,e){return pt((function(n){return t(n)}),yt,n,t,e)},sibling:function(n,t){var e=n.dom();return e.parentNode?xt(on.fromDom(e.parentNode),(function(e){return!zn.eq(n,e)&&t(e)})):g.none()},child:xt,descendant:Rt},St=function(n,t,e){return Ct.ancestor(n,(function(n){return an.is(n,t)}),e)},Tt={first:function(n){return an.one(n)},ancestor:St,sibling:function(n,t){return Ct.sibling(n,(function(n){return an.is(n,t)}))},child:function(n,t){return Ct.child(n,(function(n){return an.is(n,t)}))},descendant:function(n,t){return an.one(t,n)},closest:function(n,t,e){return pt(an.is,St,n,t,e)}},Dt=function(n,t){return Yn.parent(t).map((function(t){return gt.children(t,n)}))},kt=(c.curry(Dt,"th,td"),c.curry(Dt,"tr"),function(n,t){return function(n,t,e){var r=void 0!==e?e:c.constant(!1);return r(t)?g.none():I(n,rt.name(t))?g.some(t):Tt.ancestor(t,n.join(","),(function(n){return an.is(n,"table")||r(n)}))}(["td","th"],n,t)}),At=function(n){return Jn.firstLayer(n,"th,td")},Ot=function(n,t){return Tt.closest(n,"table",t)},Nt=function(n){var t=function(n){return Jn.firstLayer(n,"tr")}(n);return C(t,(function(n){var t=n,e=Yn.parent(t).bind((function(n){var t=rt.name(n);return"tfoot"===t||"thead"===t||"tbody"===t?t:"tbody"})),r=C(At(n),(function(n){var t=ct.has(n,"rowspan")?parseInt(ct.get(n,"rowspan"),10):1,e=ct.has(n,"colspan")?parseInt(ct.get(n,"colspan"),10):1;return en.detail(n,t,e)}));return en.rowdata(t,r,e)}))},Pt=function(n,t){return n+","+t},Bt=function(n,t){var e=P(n.all(),(function(n){return n.cells()}));return T(e,t)},Et=function(n){var t={},e=[],r=n.length,o=0;S(n,(function(n,r){var i=[];S(n.cells(),(function(n,e){for(var u=0;void 0!==t[Pt(r,u)];)u++;for(var a=en.extended(n.element(),n.rowspan(),n.colspan(),r,u),c=0;c<n.colspan();c++)for(var l=0;l<n.rowspan();l++){var s=u+c,f=Pt(r+l,s);t[f]=a,o=Math.max(o,s+1)}i.push(a)})),e.push(en.rowdata(n.element(),i,n.section()))}));var i=en.grid(r,o);return{grid:c.constant(i),access:c.constant(t),all:c.constant(e)}},It=function(n,t,e){var r=n.access()[Pt(t,e)];return void 0!==r?g.some(r):g.none()},Wt=function(n,t,e){var r=Bt(n,(function(n){return e(t,n.element())}));return r.length>0?g.some(r[0]):g.none()},Mt=Bt,qt=function(n){var t=C(n.all(),(function(n){return n.cells()}));return N(t)},_t=function(n){return void 0!==n.style},jt=function(n,t,e){if(!F.isString(e))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",e,":: Element ",n),new Error("CSS value must be a string: "+e);_t(n)&&n.style.setProperty(t,e)},zt=function(n,t){_t(n)&&n.style.removeProperty(t)},Lt=function(n,t,e){var r=n.dom();jt(r,t,e)},Ht=function(n,t){return _t(n)?n.style.getPropertyValue(t):""},Ft=function(n,t){var e=n.dom(),r=Ht(e,t);return g.from(r).filter((function(n){return n.length>0}))},Vt={copy:function(n,t){var e=n.dom(),r=t.dom();_t(e)&&_t(r)&&(r.style.cssText=e.style.cssText)},set:Lt,preserve:function(n,t){var e=ct.get(n,"style"),r=t(n);return(void 0===e?ct.remove:ct.set)(n,"style",e),r},setAll:function(n,t){var e=n.dom();L.each(t,(function(n,t){jt(e,t,n)}))},setOptions:function(n,t){var e=n.dom();L.each(t,(function(n,t){n.fold((function(){zt(e,t)}),(function(n){jt(e,t,n)}))}))},remove:function(n,t){var e=n.dom();zt(e,t),ct.has(n,"style")&&""===function(n){return n.replace(/^\s+|\s+$/g,"")}(ct.get(n,"style"))&&ct.remove(n,"style")},get:function(n,t){var e=n.dom(),r=window.getComputedStyle(e).getPropertyValue(t),o=""!==r||ft.inBody(n)?r:Ht(e,t);return null===o?void 0:o},getRaw:Ft,getAllRaw:function(n){var t={},e=n.dom();if(_t(e))for(var r=0;r<e.style.length;r++){var o=e.style.item(r);t[o]=e.style[o]}return t},isValidValue:function(n,t,e){var r=on.fromTag(n);return Lt(r,t,e),Ft(r,t).isSome()},reflow:function(n){return n.dom().offsetWidth},transfer:function(n,t,e){rt.isElement(n)&&rt.isElement(t)&&S(e,(function(e){var r,o;r=t,Ft(n,o=e).each((function(n){Ft(r,o).isNone()&&Lt(r,o,n)}))}))}},Ut=function(n,t){Yn.parent(n).each((function(e){e.dom().insertBefore(t.dom(),n.dom())}))},Gt=function(n,t){n.dom().appendChild(t.dom())},Xt={before:Ut,after:function(n,t){Yn.nextSibling(n).fold((function(){Yn.parent(n).each((function(n){Gt(n,t)}))}),(function(n){Ut(n,t)}))},prepend:function(n,t){Yn.firstChild(n).fold((function(){Gt(n,t)}),(function(e){n.dom().insertBefore(t.dom(),e.dom())}))},append:Gt,appendAt:function(n,t,e){Yn.child(n,e).fold((function(){Gt(n,t)}),(function(n){Ut(n,t)}))},wrap:function(n,t){Ut(n,t),Gt(t,n)}},Yt={before:function(n,t){S(t,(function(t){Xt.before(n,t)}))},after:function(n,t){S(t,(function(e,r){var o=0===r?n:t[r-1];Xt.after(o,e)}))},prepend:function(n,t){S(t.slice().reverse(),(function(t){Xt.prepend(n,t)}))},append:function(n,t){S(t,(function(t){Xt.append(n,t)}))}},Kt=function(n){var t=n.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},Jt={empty:function(n){n.dom().textContent="",S(Yn.children(n),(function(n){Kt(n)}))},remove:Kt,unwrap:function(n){var t=Yn.children(n);t.length>0&&Yt.before(n,t),Kt(n)}},$t=K.immutable("minRow","minCol","maxRow","maxCol"),Qt=function(n,t){var e,r,o,i,u,a,c,l,s,f,d=function(n){return an.is(n.element(),t)},m=Nt(n),g=Et(m),p=(r=d,o=(e=g).grid().columns(),i=e.grid().rows(),u=o,a=0,c=0,L.each(e.access(),(function(n){if(r(n)){var t=n.row(),e=t+n.rowspan()-1,o=n.column(),l=o+n.colspan()-1;t<i?i=t:e>a&&(a=e),o<u?u=o:l>c&&(c=l)}})),$t(i,u,a,c)),h="th:not("+t+"),td:not("+t+")",v=Jn.filterFirstLayer(n,"th,td",(function(n){return an.is(n,h)}));return S(v,Jt.remove),function(n,t,e,r){for(var o,i,u,a=t.grid().columns(),c=t.grid().rows(),l=0;l<c;l++)for(var s=!1,f=0;f<a;f++)l<e.minRow()||l>e.maxRow()||f<e.minCol()||f>e.maxCol()||(It(t,l,f).filter(r).isNone()?(o=s,i=n[l].element(),u=on.fromTag("td"),Xt.append(u,on.fromTag("br")),(o?Xt.append:Xt.prepend)(i,u)):s=!0)}(m,g,p,d),l=n,s=p,f=T(Jn.firstLayer(l,"tr"),(function(n){return 0===n.dom().childElementCount})),S(f,Jt.remove),s.minCol()!==s.maxCol()&&s.minRow()!==s.maxRow()||S(Jn.firstLayer(l,"th,td"),(function(n){ct.remove(n,"rowspan"),ct.remove(n,"colspan")})),ct.remove(l,"width"),ct.remove(l,"height"),Vt.remove(l,"width"),Vt.remove(l,"height"),n},Zt=function(n,t){return on.fromDom(n.dom().cloneNode(t))},ne=function(n){return Zt(n,!0)},te=function(n){return Zt(n,!1)},ee=ne,re=(ht=rt.isText,vt=function(n){return ht(n)?g.from(n.dom().nodeValue):g.none()},bt=qn.detect().browser,{get:function(n){if(!ht(n))throw new Error("Can only get text value of a text node");return wt(n).getOr("")},getOption:wt=bt.isIE()&&10===bt.version.major?function(n){try{return vt(n)}catch(n){return g.none()}}:vt,set:function(n,t){if(!ht(n))throw new Error("Can only set raw text value of a text node");n.dom().nodeValue=t}}),oe={get:function(n){return re.get(n)},getOption:function(n){return re.getOption(n)},set:function(n,t){re.set(n,t)}},ie=["img","br"],ue=function(n){return"img"===rt.name(n)?1:oe.getOption(n).fold((function(){return Yn.children(n).length}),(function(n){return n.length}))},ae=function(n){return oe.getOption(n).filter((function(n){return 0!==n.trim().length||n.indexOf(" ")>-1})).isSome()||I(ie,rt.name(n))},ce=function(n){return Ct.descendant(n,ae)},le=function(n){return function(n,t){var e=function(n){for(var r=Yn.children(n),o=r.length-1;o>=0;o--){var i=r[o];if(t(i))return g.some(i);var u=e(i);if(u.isSome())return u}return g.none()};return e(n)}(n,ae)},se=function(){var n=on.fromTag("td");return Xt.append(n,on.fromTag("br")),n},fe=function(n,t,e){var r=function(n,t){var e=function(n,t){var e=on.fromTag(t),r=ct.clone(n);return ct.setAll(e,r),e}(n,t),r=Yn.children(ne(n));return Yt.append(e,r),e}(n,t);return L.each(e,(function(n,t){null===n?ct.remove(r,t):ct.set(r,t,n)})),r},de=function(n){return n},me=function(n){return function(){return on.fromTag("tr",n.dom())}},ge=function(n,t,e){return{row:me(t),cell:function(t){var r,o,i,u=Yn.owner(t.element()),a=on.fromTag(rt.name(t.element()),u.dom()),c=e.getOr(["strong","em","b","i","span","font","h1","h2","h3","h4","h5","h6","p","div"]),l=c.length>0?(r=t.element(),o=a,i=c,ce(r).map((function(n){var t=i.join(","),e=gt.ancestors(n,t,(function(n){return zn.eq(n,r)}));return D(e,(function(n,t){var e=te(t);return Xt.append(n,e),e}),o)})).getOr(o)):a;return Xt.append(l,on.fromTag("br")),Vt.copy(t.element(),a),Vt.remove(a,"height"),1!==t.colspan()&&Vt.remove(t.element(),"width"),n(t.element(),a),a},replace:fe,gap:se}},pe=function(n){return{row:me(n),cell:se,replace:de,gap:se}},he=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];function ve(){return{up:c.constant({selector:Tt.ancestor,closest:Tt.closest,predicate:Ct.ancestor,all:Yn.parents}),down:c.constant({selector:gt.descendants,predicate:mt.descendants}),styles:c.constant({get:Vt.get,getRaw:Vt.getRaw,set:Vt.set,remove:Vt.remove}),attrs:c.constant({get:ct.get,set:ct.set,remove:ct.remove,copyTo:function(n,t){var e=ct.clone(n);ct.setAll(t,e)}}),insert:c.constant({before:Xt.before,after:Xt.after,afterAll:Yt.after,append:Xt.append,appendAll:Yt.append,prepend:Xt.prepend,wrap:Xt.wrap}),remove:c.constant({unwrap:Jt.unwrap,remove:Jt.remove}),create:c.constant({nu:on.fromTag,clone:function(n){return on.fromDom(n.dom().cloneNode(!1))},text:on.fromText}),query:c.constant({comparePosition:function(n,t){return n.dom().compareDocumentPosition(t.dom())},prevSibling:Yn.prevSibling,nextSibling:Yn.nextSibling}),property:c.constant({children:Yn.children,name:rt.name,parent:Yn.parent,isText:rt.isText,isComment:rt.isComment,isElement:rt.isElement,getText:oe.get,setText:oe.set,isBoundary:function(n){return!!rt.isElement(n)&&("body"===rt.name(n)||I(he,rt.name(n)))},isEmptyTag:function(n){return!!rt.isElement(n)&&I(["br","img","hr","input"],rt.name(n))}}),eq:zn.eq,is:zn.is}}K.immutable("left","right");var be=function(n,t,e){return e.length>0?function(n,t,e,r){var o=t(n,e);return D(r,(function(e,r){var o=t(n,r);return function(n,t,e){return t.bind((function(t){return e.filter(c.curry(n.eq,t))}))}(n,e,o)}),o)}(n,t,(r=e)[0],r.slice(1)):g.none();var r},we=ve(),ye=function(n,t){return function(n,t,e){return be(n,t,e)}(we,(function(t,e){return n(e)}),t)},xe=function(n,t,e){return function(n,t,e,r){return function(n,t,e,r){var o=void 0!==r?r:c.constant(!1),i=[t].concat(n.up().all(t)),u=[e].concat(n.up().all(e)),a=function(n){return O(n,o).fold((function(){return n}),(function(t){return n.slice(0,t+1)}))},l=a(i),s=a(u),f=A(l,(function(t){return E(s,function(n,t){return c.curry(n.eq,t)}(n,t))}));return{firstpath:c.constant(l),secondpath:c.constant(s),shared:c.constant(f)}}(n,t,e,r)}(we,n,t,e)},Re=function(n,t){return t.column()>=n.startCol()&&t.column()+t.colspan()-1<=n.finishCol()&&t.row()>=n.startRow()&&t.row()+t.rowspan()-1<=n.finishRow()},Ce=function(n,t){var e=t.column(),r=t.column()+t.colspan()-1,o=t.row(),i=t.row()+t.rowspan()-1;return e<=n.finishCol()&&r>=n.startCol()&&o<=n.finishRow()&&i>=n.startRow()},Se=function(n,t,e){var r=Wt(n,t,zn.eq),o=Wt(n,e,zn.eq);return r.bind((function(n){return o.map((function(t){return e=n,r=t,en.bounds(Math.min(e.row(),r.row()),Math.min(e.column(),r.column()),Math.max(e.row()+e.rowspan()-1,r.row()+r.rowspan()-1),Math.max(e.column()+e.colspan()-1,r.column()+r.colspan()-1));var e,r}))}))},Te=Se,De=function(n,t,e){return Te(n,t,e).map((function(t){var e=Mt(n,c.curry(Ce,t));return C(e,(function(n){return n.element()}))}))},ke=function(n,t){return Wt(n,t,(function(n,t){return zn.contains(t,n)})).bind((function(n){return n.element()}))},Ae=function(n){var t=Nt(n);return Et(t)},Oe=function(n,t,e){var r=Ae(n);return De(r,t,e)},Ne=function(n,t,e,r,o){var i=Ae(n),u=zn.eq(n,e)?t:ke(i,t),a=zn.eq(n,o)?r:ke(i,r);return De(i,u,a)},Pe=function(n,t){return Tt.ancestor(n,"table")},Be=K.immutableBag(["boxes","start","finish"],[]),Ee=function(n,t,e){var r=function(n){return function(t){return e(t)||zn.eq(t,n)}};return zn.eq(n,t)?g.some(Be({boxes:g.some([n]),start:n,finish:t})):Pe(n).bind((function(o){return Pe(t).bind((function(i){if(zn.eq(o,i))return g.some(Be({boxes:Oe(o,n,t),start:n,finish:t}));if(zn.contains(o,i)){var u=(a=gt.ancestors(t,"td,th",r(o))).length>0?a[a.length-1]:t;return g.some(Be({boxes:Ne(o,n,o,t,i),start:n,finish:u}))}if(zn.contains(i,o)){var a,c=(a=gt.ancestors(n,"td,th",r(i))).length>0?a[a.length-1]:n;return g.some(Be({boxes:Ne(i,n,o,t,i),start:n,finish:c}))}return xe(n,t).shared().bind((function(u){return Tt.closest(u,"table",e).bind((function(e){var u=gt.ancestors(t,"td,th",r(e)),a=u.length>0?u[u.length-1]:t,c=gt.ancestors(n,"td,th",r(e)),l=c.length>0?c[c.length-1]:n;return g.some(Be({boxes:Ne(e,n,o,t,i),start:l,finish:a}))}))}))}))}))},Ie=Ee,We=function(n,t){var e=gt.descendants(n,t);return e.length>0?g.some(e):g.none()},Me=function(n,t,e,r,o){return(i=n,u=o,A(i,(function(n){return an.is(n,u)}))).bind((function(n){return function(n,t,e){return Ot(n).bind((function(r){return function(n,t,e,r){return Wt(n,t,zn.eq).bind((function(t){var o=e>0?t.row()+t.rowspan()-1:t.row(),i=r>0?t.column()+t.colspan()-1:t.column();return It(n,o+e,i+r).map((function(n){return n.element()}))}))}(Ae(r),n,t,e)}))}(n,t,e).bind((function(n){return e=r,Tt.ancestor(t=n,"table").bind((function(n){return Tt.descendant(n,e).bind((function(n){return Ee(n,t).bind((function(n){return n.boxes().map((function(t){return{boxes:c.constant(t),start:c.constant(n.start()),finish:c.constant(n.finish())}}))}))}))}));var t,e}))}));var i,u},qe=function(n,t,e){return Tt.descendant(n,t).bind((function(t){return Tt.descendant(n,e).bind((function(n){return ye(Pe,[t,n]).map((function(e){return{first:c.constant(t),last:c.constant(n),table:c.constant(e)}}))}))}))},_e=function(n,t,e){return qe(n,t,e).bind((function(t){var e=function(t){return zn.eq(n,t)},r=Tt.ancestor(t.first(),"thead,tfoot,tbody,table",e),o=Tt.ancestor(t.last(),"thead,tfoot,tbody,table",e);return r.bind((function(n){return o.bind((function(e){return zn.eq(n,e)?function(n,t,e){return function(n,t,e){return Se(n,t,e).bind((function(t){return function(n,t){for(var e=!0,r=c.curry(Re,t),o=t.startRow();o<=t.finishRow();o++)for(var i=t.startCol();i<=t.finishCol();i++)e=e&&It(n,o,i).exists(r);return e?g.some(t):g.none()}(n,t)}))}(Ae(n),t,e)}(t.table(),t.first(),t.last()):g.none()}))}))}))},je={selected:c.constant("data-mce-selected"),selectedSelector:c.constant("td[data-mce-selected],th[data-mce-selected]"),attributeSelector:c.constant("[data-mce-selected]"),firstSelected:c.constant("data-mce-first-selected"),firstSelectedSelector:c.constant("td[data-mce-first-selected],th[data-mce-first-selected]"),lastSelected:c.constant("data-mce-last-selected"),lastSelectedSelector:c.constant("td[data-mce-last-selected],th[data-mce-last-selected]")},ze=function(n){if(!F.isArray(n))throw new Error("cases must be an array");if(0===n.length)throw new Error("there must be at least one case");var t=[],e={};return S(n,(function(r,o){var i=L.keys(r);if(1!==i.length)throw new Error("one and only one name per case");var u=i[0],a=r[u];if(void 0!==e[u])throw new Error("duplicate key detected:"+u);if("cata"===u)throw new Error("cannot have a case named cata (sorry)");if(!F.isArray(a))throw new Error("case arguments must be an array");t.push(u),e[u]=function(){var e=arguments.length;if(e!==a.length)throw new Error("Wrong number of arguments to case "+u+". Expected "+a.length+" ("+a+"), got "+e);for(var r=new Array(e),i=0;i<r.length;i++)r[i]=arguments[i];return{fold:function(){if(arguments.length!==n.length)throw new Error("Wrong number of arguments to fold. Expected "+n.length+", got "+arguments.length);return arguments[o].apply(null,r)},match:function(n){var e=L.keys(n);if(t.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+e.join(","));if(!B(t,(function(n){return I(e,n)})))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+t.join(", "));return n[u].apply(null,r)},log:function(n){console.log(n,{constructors:t,constructor:u,params:r})}}}})),e},Le=ze([{none:[]},{multiple:["elements"]},{single:["selection"]}]),He={cata:function(n,t,e,r){return n.fold(t,e,r)},none:Le.none,multiple:Le.multiple,single:Le.single},Fe=function(n,t){return He.cata(t.get(),c.constant([]),c.identity,c.constant([n]))},Ve=function(n,t){return He.cata(t.get(),g.none,(function(t,e){return 0===t.length?g.none():_e(n,je.firstSelectedSelector(),je.lastSelectedSelector()).bind((function(n){return t.length>1?g.some({bounds:c.constant(n),cells:c.constant(t)}):g.none()}))}),g.none)},Ue=function(n,t){var e=Fe(n,t);return e.length>0&&B(e,(function(n){return ct.has(n,"rowspan")&&parseInt(ct.get(n,"rowspan"),10)>1||ct.has(n,"colspan")&&parseInt(ct.get(n,"colspan"),10)>1}))?g.some(e):g.none()},Ge=Fe,Xe=function(n){return{element:c.constant(n),mergable:g.none,unmergable:g.none,selection:c.constant([n])}},Ye=K.immutable("element","clipboard","generators"),Ke={noMenu:Xe,forMenu:function(n,t,e){return{element:c.constant(e),mergable:c.constant(Ve(t,n)),unmergable:c.constant(Ue(e,n)),selection:c.constant(Ge(e,n))}},notCell:function(n){return Xe(n)},paste:Ye,pasteRows:function(n,t,e,r,o){return{element:c.constant(e),mergable:g.none,unmergable:g.none,selection:c.constant(Ge(e,n)),clipboard:c.constant(r),generators:c.constant(o)}}};function Je(n,t){var e=function(e){var r=t(e);if(r<=0||null===r){var o=Vt.get(e,n);return parseFloat(o)||0}return r},r=function(n,t){return k(t,(function(t,e){var r=Vt.get(n,e),o=void 0===r?0:parseInt(r,10);return isNaN(o)?t:t+o}),0)};return{set:function(t,e){if(!F.isNumber(e)&&!e.match(/^[0-9]+$/))throw n+".set accepts only positive integer values. Value was "+e;var r=t.dom();_t(r)&&(r.style[n]=e+"px")},get:e,getOuter:e,aggregate:r,max:function(n,t,e){var o=r(n,e);return t>o?t-o:0}}}var $e=Je("height",(function(n){return ft.inBody(n)?n.dom().getBoundingClientRect().height:n.dom().offsetHeight})),Qe=function(n){return $e.get(n)},Ze=function(n){return $e.getOuter(n)},nr=Je("width",(function(n){return n.dom().offsetWidth})),tr=function(n){return nr.get(n)},er=function(n){return nr.getOuter(n)},rr=qn.detect(),or=function(n,t,e){return r=Vt.get(n,t),o=e,i=parseFloat(r),isNaN(i)?o:i;var r,o,i},ir=/(\d+(\.\d+)?)(\w|%)*/,ur=/(\d+(\.\d+)?)%/,ar=/(\d+(\.\d+)?)px|em/,cr=function(n,t){Vt.set(n,"height",t+"px")},lr=function(n){return Vt.getRaw(n,"width").fold((function(){return g.from(ct.get(n,"width"))}),(function(n){return g.some(n)}))},sr=function(n,t){return n/t.pixelWidth()*100},fr={percentageBasedSizeRegex:c.constant(ur),pixelBasedSizeRegex:c.constant(ar),setPixelWidth:function(n,t){Vt.set(n,"width",t+"px")},setPercentageWidth:function(n,t){Vt.set(n,"width",t+"%")},setHeight:cr,getPixelWidth:function(n,t){return lr(n).fold((function(){var t=tr(n);return parseInt(t,10)}),(function(e){return function(n,t,e){if(ar.test(t)){var r=ar.exec(t);return parseInt(r[1],10)}if(ur.test(t)){var o=ur.exec(t);return parseFloat(o[1])/100*e.pixelWidth()}var i=tr(n);return parseInt(i,10)}(n,e,t)}))},getPercentageWidth:function(n,t){return lr(n).fold((function(){var e=tr(n),r=parseInt(e,10);return sr(r,t)}),(function(e){return function(n,t,e){if(ur.test(t)){var r=ur.exec(t);return parseFloat(r[1])}var o=tr(n),i=parseInt(o,10);return sr(i,e)}(n,e,t)}))},getGenericWidth:function(n){return lr(n).bind((function(n){if(ir.test(n)){var t=ir.exec(n);return g.some({width:c.constant(t[1]),unit:c.constant(t[3])})}return g.none()}))},setGenericWidth:function(n,t,e){Vt.set(n,"width",t+e)},getHeight:function(n){return function(n){var t,e=Vt.getRaw(t=n,"height").getOrThunk((function(){return function(n){return rr.browser.isIE()||rr.browser.isEdge()?(e=or(t=n,"padding-top",0),r=or(t,"padding-bottom",0),o=or(t,"border-top-width",0),i=or(t,"border-bottom-width",0),u=t.dom().getBoundingClientRect().height,"border-box"===Vt.get(t,"box-sizing")?u:u-e-r-(o+i)):or(n,"height",Qe(n));var t,e,r,o,i,u}(t)+"px"}));return e?function(n,t,e,r){var o,i,u,a,c,l=parseInt(n,10);return Nn(n,"%")&&"table"!==rt.name(t)?(i=l,u=e,a=r,c=Ot(o=t).map((function(n){var t=u(n);return Math.floor(i/100*t)})).getOr(i),a(o,c),c):l}(e,n,Qe,cr):Qe(n)}(t=n)/function(n,t){return ct.has(n,t)?parseInt(ct.get(n,t),10):1}(t,"rowspan");var t},getRawWidth:lr},dr=function(n,t){fr.getGenericWidth(n).each((function(e){var r=e.width()/2;fr.setGenericWidth(n,r,e.unit()),fr.setGenericWidth(t,r,e.unit())}))},mr=function(n,t){return{left:c.constant(n),top:c.constant(t),translate:function(e,r){return mr(n+e,t+r)}}},gr=function(n,t){return void 0!==n?n:void 0!==t?t:0},pr=function(n){var t,e=n.dom(),r=e.ownerDocument,o=r.body,i=on.fromDom(r.documentElement);return o===e?mr(o.offsetLeft,o.offsetTop):function(n,t){var e=t||on.fromDom(document.documentElement);return Ct.ancestor(n,c.curry(zn.eq,e)).isSome()}(n,i)?(t=e.getBoundingClientRect(),mr(t.left,t.top)):mr(0,0)},hr=function(n){var t=n.dom().ownerDocument,e=t.body,r=function(n){var t=n.dom();return t===t.window?n:rt.isDocument(n)?t.defaultView||t.parentWindow:null}(on.fromDom(t)),o=t.documentElement,i=gr(r.pageYOffset,o.scrollTop),u=gr(r.pageXOffset,o.scrollLeft),a=gr(o.clientTop,e.clientTop),c=gr(o.clientLeft,e.clientLeft);return pr(n).translate(u-c,i-a)},vr=K.immutable("row","y"),br=K.immutable("col","x"),wr=function(n){return hr(n).left()+er(n)},yr=function(n){return hr(n).left()},xr=function(n,t){return br(n,yr(t))},Rr=function(n,t){return br(n,wr(t))},Cr=function(n){return hr(n).top()},Sr=function(n,t,e){if(0===e.length)return[];var r=C(e.slice(1),(function(t,e){return t.map((function(t){return n(e,t)}))})),o=e[e.length-1].map((function(n){return t(e.length-1,n)}));return r.concat([o])},Tr={delta:c.identity,positions:c.curry(Sr,(function(n,t){return vr(n,Cr(t))}),(function(n,t){return vr(n,Cr(t)+Ze(t))})),edge:Cr},Dr={delta:c.identity,edge:yr,positions:c.curry(Sr,xr,Rr)},kr={height:Tr,rtl:{delta:function(n,t){return-n},edge:wr,positions:c.curry(Sr,Rr,xr)},ltr:Dr},Ar={ltr:kr.ltr,rtl:kr.rtl};function Or(n){var t=function(t){return n(t).isRtl()?Ar.rtl:Ar.ltr};return{delta:function(n,e){return t(e).delta(n,e)},edge:function(n){return t(n).edge(n)},positions:function(n,e){return t(e).positions(n,e)}}}var Nr=function(n){var t=Nt(n);return Et(t).grid()},Pr=function(n){var t=n,e=function(){return t};return{get:e,set:function(n){t=n},clone:function(){return Pr(e())}}},Br=function(n,t){return Er(n,t,{validate:F.isFunction,label:"function"})},Er=function(n,t,e){if(0===t.length)throw new Error("You must specify at least one required field.");return X("required",t),Y(t),function(r){var o=L.keys(r);B(t,(function(n){return I(o,n)}))||U(t,o),n(t,o);var i=T(t,(function(n){return!e.validate(r[n],n)}));return i.length>0&&function(n,t){throw new Error("All values need to be of type: "+t+". Keys ("+V(n).join(", ")+") were not.")}(i,e.label),r}},Ir=c.noop,Wr={exactly:c.curry(Br,(function(n,t){var e=T(t,(function(t){return!I(n,t)}));e.length>0&&G(e)})),ensure:c.curry(Br,Ir),ensureWith:c.curry(Er,Ir)},Mr=function(n){var t=ct.has(n,"colspan")?parseInt(ct.get(n,"colspan"),10):1,e=ct.has(n,"rowspan")?parseInt(ct.get(n,"rowspan"),10):1;return{element:c.constant(n),colspan:c.constant(t),rowspan:c.constant(e)}},qr=Wr.exactly(["cell","row","replace","gap"]),_r=function(n,t){qr(n);var e=Pr(g.none()),r=void 0!==t?t:Mr,o=function(t){var e;return e=r(t),n.cell(e)},i=function(n){var t=o(n);return e.get().isNone()&&e.set(g.some(t)),u=g.some({item:n,replacement:t}),t},u=g.none();return{getOrInit:function(n,t){return u.fold((function(){return i(n)}),(function(e){return t(n,e.item)?e.replacement:i(n)}))},cursor:e.get}},jr=function(n,t){return function(e){var r=Pr(g.none());qr(e);var o=[],i=function(i){var u=e.replace(i,t,{scope:n});return o.push({item:i,sub:u}),r.get().isNone()&&r.set(g.some(u)),u};return{replaceOrInit:function(n,t){return(e=n,r=t,A(o,(function(n){return r(n.item,e)}))).fold((function(){return i(n)}),(function(e){return t(n,e.item)?e.sub:i(n)}));var e,r},cursor:r.get}}},zr=function(n){qr(n);var t=Pr(g.none());return{combine:function(e){return t.get().isNone()&&t.set(g.some(e)),function(){var t=n.cell({element:c.constant(e),colspan:c.constant(1),rowspan:c.constant(1)});return Vt.remove(t,"width"),Vt.remove(e,"width"),t}},cursor:t.get}},Lr=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","table","thead","tfoot","tbody","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"],Hr=ve(),Fr=function(n){return function(n,t){var e=n.property().name(t);return I(Lr,e)}(Hr,n)},Vr=function(n){return function(n,t){var e=n.property().name(t);return I(["ol","ul"],e)}(Hr,n)},Ur=function(n){var t,e=function(n){return"br"===rt.name(n)},r=function(n){return le(n).bind((function(t){var r=Yn.nextSibling(t).map((function(n){return!!Fr(n)||(function(n){return function(n,t){return I(["br","img","hr","input"],n.property().name(t))}(Hr,n)}(n)?"img"!==rt.name(n):void 0)})).getOr(!1);return Yn.parent(t).map((function(o){return!0===r||(i=o,"li"===rt.name(i)||Ct.ancestor(i,Vr).isSome())||e(t)||Fr(o)&&!zn.eq(n,o)?[]:[on.fromTag("br")];var i}))})).getOr([])},o=0===(t=P(n,(function(n){var t=Yn.children(n);return B(t,(function(n){return e(n)||rt.isText(n)&&0===oe.get(n).trim().length}))?[]:t.concat(r(n))}))).length?[on.fromTag("br")]:t;Jt.empty(n[0]),Yt.append(n[0],o)},Gr=function(n){return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];if(0===t.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<t.length;o++){var i=t[o];for(var u in i)i.hasOwnProperty(u)&&(r[u]=n(r[u],i[u]))}return r}},Xr=Gr((function(n,t){return F.isObject(n)&&F.isObject(t)?Xr(n,t):t})),Yr=Gr((function(n,t){return t})),Kr={deepMerge:Xr,merge:Yr},Jr=function(n){for(var t=[],e=function(n){t.push(n)},r=0;r<n.length;r++)n[r].each(e);return t},$r=function(n,t){for(var e=0;e<n.length;e++){var r=t(n[e],e);if(r.isSome())return r}return g.none()},Qr=function(n,t){return en.rowcells(t,n.section())},Zr=function(n,t){return n.cells()[t]},no=function(n,t,e){var r=n.cells(),o=r.slice(0,t),i=r.slice(t),u=o.concat([e]).concat(i);return Qr(n,u)},to=Qr,eo=function(n,t,e){n.cells()[t]=e},ro=Zr,oo=function(n,t){return Zr(n,t).element()},io=function(n,t){var e=n.cells(),r=C(e,t);return en.rowcells(r,n.section())},uo=function(n){return n.cells().length},ao=function(n,t){if(0===n.length)return 0;var e=n[0];return O(n,(function(n){return!t(e.element(),n.element())})).fold((function(){return n.length}),(function(n){return n}))},co=function(n,t,e){for(var r=[],o=0;o<n.grid().rows();o++){for(var i=[],u=0;u<n.grid().columns();u++){var a=It(n,o,u).map((function(n){return en.elementnew(n.element(),e)})).getOrThunk((function(){return en.elementnew(t.gap(),!0)}));i.push(a)}var c=en.rowcells(i,n.all()[o].section());r.push(c)}return r},lo=function(n,t,e,r){e===r?ct.remove(n,t):ct.set(n,t,e)},so=function(n,t){for(var e=[],r=n;r<t;r++)e.push(r);return e},fo=function(n,t){if(t<0||t>=n.length-1)return g.none();var e=n[t].fold((function(){var e=W(n.slice(0,t));return $r(e,(function(n,t){return n.map((function(n){return{value:n,delta:t+1}}))}))}),(function(n){return g.some({value:n,delta:0})})),r=n[t+1].fold((function(){var e=n.slice(t+1);return $r(e,(function(n,t){return n.map((function(n){return{value:n,delta:t+1}}))}))}),(function(n){return g.some({value:n,delta:1})}));return e.bind((function(n){return r.map((function(t){var e=t.delta+n.delta;return Math.abs(t.value-n.value)/e}))}))},mo=function(n,t,e){var r=n();return A(r,t).orThunk((function(){return g.from(r[0]).orThunk(e)})).map((function(n){return n.element()}))},go=function(n){var t=n.grid(),e=so(0,t.columns()),r=so(0,t.rows());return C(e,(function(t){return mo((function(){return P(r,(function(e){return It(n,e,t).filter((function(n){return n.column()===t})).fold(c.constant([]),(function(n){return[n]}))}))}),(function(n){return 1===n.colspan()}),(function(){return It(n,0,t)}))}))},po=function(n){var t=n.grid(),e=so(0,t.rows()),r=so(0,t.columns());return C(e,(function(t){return mo((function(){return P(r,(function(e){return It(n,t,e).filter((function(n){return n.row()===t})).fold(c.constant([]),(function(n){return[n]}))}))}),(function(n){return 1===n.rowspan()}),(function(){return It(n,t,0)}))}))},ho=function(n){var t=n.replace(/\./g,"-");return{resolve:function(n){return t+"-"+n}}},vo={resolve:ho("ephox-snooker").resolve},bo=function(n,t){return function(n,t,e){var r=function(n,t){var e=ct.get(n,t);return void 0===e||""===e?[]:e.split(" ")}(n,t).concat([e]);ct.set(n,t,r.join(" "))}(n,"class",t)},wo=function(n){return void 0!==n.dom().classList},yo=function(n,t){wo(n)?n.dom().classList.add(t):bo(n,t)},xo=function(n,t){return wo(n)&&n.dom().classList.contains(t)},Ro=vo.resolve("resizer-bar"),Co=vo.resolve("resizer-rows"),So=vo.resolve("resizer-cols"),To=function(n){var t=gt.descendants(n.parent(),"."+Ro);S(t,Jt.remove)},Do=function(n,t,e){var r=n.origin();S(t,(function(t,o){t.each((function(t){var o=e(r,t);yo(o,Ro),Xt.append(n.parent(),o)}))}))},ko=function(n,t){var e=gt.descendants(n.parent(),"."+Ro);S(e,t)},Ao=function(n,t,e,r){To(n);var o=Nt(t),i=Et(o);!function(n,t,e,r,o,i){var u,a,c,l,s,f,d,m,g=hr(t);u=n,a=e.length>0?o.positions(e,t):[],c=g,l=er(t),Do(u,a,(function(n,t){var e=function(n,t,e,r,o){var i=on.fromTag("div");return Vt.setAll(i,{position:"absolute",left:t+"px",top:e-3.5+"px",height:"7px",width:r+"px"}),ct.setAll(i,{"data-row":n,role:"presentation"}),i}(t.row(),c.left()-n.left(),t.y()-n.top(),l);return yo(e,Co),e})),s=n,f=r.length>0?i.positions(r,t):[],d=g,m=Ze(t),Do(s,f,(function(n,t){var e=function(n,t,e,r,o){var i=on.fromTag("div");return Vt.setAll(i,{position:"absolute",left:t-3.5+"px",top:e+"px",height:o+"px",width:"7px"}),ct.setAll(i,{"data-column":n,role:"presentation"}),i}(t.col(),t.x()-n.left(),d.top()-n.top(),0,m);return yo(e,So),e}))}(n,t,po(i),go(i),e,r)},Oo=function(n){ko(n,(function(n){Vt.set(n,"display","none")}))},No=function(n){ko(n,(function(n){Vt.set(n,"display","block")}))},Po=To,Bo=function(n,t){return function(n,t){return C(n,(function(n){var e,r=(e=n.details(),$r(e,(function(n){return Yn.parent(n.element()).map((function(n){var t=Yn.parent(n).isNone();return en.elementnew(n,t)}))})).getOrThunk((function(){return en.elementnew(t.row(),!0)})));return en.rowdatanew(r.element(),n.details(),n.section(),r.isNew())}))}(function(n,t){var e=C(n,(function(n,t){return C(n.cells(),(function(n,t){return!1}))}));return C(n,(function(r,o){var i=P(r.cells(),(function(r,i){if(!1===e[o][i]){var u=function(n,t,e,r){var o,i,u,a,l=(o=n,i=t,o[i]).cells().slice(e),s=ao(l,r),f=(u=n,a=e,C(u,(function(n){return ro(n,a)}))).slice(t),d=ao(f,r);return{colspan:c.constant(s),rowspan:c.constant(d)}}(n,o,i,t);return function(n,t,r,o){for(var i=n;i<n+r;i++)for(var u=t;u<t+o;u++)e[i][u]=!0}(o,i,u.rowspan(),u.colspan()),[en.detailnew(r.element(),u.rowspan(),u.colspan(),r.isNew())]}return[]}));return en.rowdetails(i,r.section())}))}(n,zn.eq),t)},Eo=function(n,t){var e=N(C(n.all(),(function(n){return n.cells()})));return A(e,(function(n){return zn.eq(t,n.element())}))},Io=function(n,t,e,r,o){return function(i,u,a,l,s){var f=Nt(u),d=Et(f);return t(d,a).map((function(t){var e=co(d,l,!1),r=n(e,t,zn.eq,o(l)),i=Bo(r.grid(),l);return{grid:c.constant(i),cursor:r.cursor}})).fold((function(){return g.none()}),(function(n){var t=function(n,t){var e=[],r=[],o=function(t,o){t.length>0?function(t,o){var i=Tt.child(n,o).getOrThunk((function(){var t=on.fromTag(o,Yn.owner(n).dom());return Xt.append(n,t),t}));Jt.empty(i);var u=C(t,(function(n){n.isNew()&&e.push(n.element());var t=n.element();return Jt.empty(t),S(n.cells(),(function(n){n.isNew()&&r.push(n.element()),lo(n.element(),"colspan",n.colspan(),1),lo(n.element(),"rowspan",n.rowspan(),1),Xt.append(t,n.element())})),t}));Yt.append(i,u)}(t,o):Tt.child(n,o).bind(Jt.remove)},i=[],u=[],a=[];return S(t,(function(n){switch(n.section()){case"thead":i.push(n);break;case"tbody":u.push(n);break;case"tfoot":a.push(n)}})),o(i,"thead"),o(u,"tbody"),o(a,"tfoot"),{newRows:c.constant(e),newCells:c.constant(r)}}(u,n.grid());return e(u,n.grid(),s),r(u),Ao(i,u,kr.height,s),g.some({cursor:n.cursor,newRows:t.newRows,newCells:t.newCells})}))}},Wo=Bo,Mo=function(n,t){return kt(t.element()).bind((function(t){return Eo(n,t)}))},qo=function(n,t){var e=C(t.selection(),(function(t){return kt(t).bind((function(t){return Eo(n,t)}))})),r=Jr(e);return r.length>0?g.some(r):g.none()},_o=function(n,t){var e=C(t.selection(),(function(t){return kt(t).bind((function(t){return Eo(n,t)}))})),r=Jr(e);return r.length>0?g.some(Kr.merge({cells:r},{generators:t.generators,clipboard:t.clipboard})):g.none()},jo=function(n){return{is:function(t){return n===t},isValue:c.always,isError:c.never,getOr:c.constant(n),getOrThunk:c.constant(n),getOrDie:c.constant(n),or:function(t){return jo(n)},orThunk:function(t){return jo(n)},fold:function(t,e){return e(n)},map:function(t){return jo(t(n))},each:function(t){t(n)},bind:function(t){return t(n)},exists:function(t){return t(n)},forall:function(t){return t(n)},toOption:function(){return g.some(n)}}},zo=function(n){return{is:c.never,isValue:c.never,isError:c.always,getOr:c.identity,getOrThunk:function(n){return n()},getOrDie:function(){return c.die(n)()},or:function(n){return n},orThunk:function(n){return n()},fold:function(t,e){return t(n)},map:function(t){return zo(n)},each:c.noop,bind:function(t){return zo(n)},exists:c.never,forall:c.always,toOption:g.none}},Lo={value:jo,error:zo},Ho=function(n,t){return C(n,(function(){return en.elementnew(t.cell(),!0)}))},Fo=function(n,t,e){return n.concat(function(n,t){for(var e=[],r=0;r<n;r++)e.push(t());return e}(t,(function(t){return to(n[n.length-1],Ho(n[n.length-1].cells(),e))})))},Vo=function(n,t,e){return C(n,(function(n){return to(n,n.cells().concat(Ho(so(0,t),e)))}))},Uo=function(n,t){var e=uo(n[0]),r=uo(t[0]);return{rowDelta:c.constant(0),colDelta:c.constant(e-r)}},Go=function(n,t,e){var r=t.colDelta()<0?Vo:c.identity;return(t.rowDelta()<0?Fo:c.identity)(r(n,Math.abs(t.colDelta()),e),Math.abs(t.rowDelta()),e)},Xo=function(n,t,e,r){for(var o=!0,i=0;i<n.length;i++)for(var u=0;u<uo(n[0]);u++){var a=e(oo(n[i],u),t);!0===a&&!1===o?eo(n[i],u,en.elementnew(r(),!0)):!0===a&&(o=!1)}return n},Yo=function(n,t,e,r,o){return function(n,t,e){if(n.row()>=t.length||n.column()>uo(t[0]))return Lo.error("invalid start address out of table bounds, row: "+n.row()+", column: "+n.column());var r=t.slice(n.row()),o=r[0].cells().slice(n.column()),i=uo(e[0]),u=e.length;return Lo.value({rowDelta:c.constant(r.length-u),colDelta:c.constant(o.length-i)})}(n,t,e).map((function(i){var u=Go(t,i,r);return function(n,t,e,r,o){for(var i,u,a,l,s,f,d,m=n.row(),g=n.column(),p=m+e.length,h=g+uo(e[0]),v=m;v<p;v++)for(var b=g;b<h;b++){a=b,l=o,s=void 0,f=void 0,s=ro((i=t)[u=v],a),f=c.curry(l,s.element()),d=i[u],i.length>1&&uo(d)>1&&(a>0&&f(oo(d,a-1))||a<d.length-1&&f(oo(d,a+1))||u>0&&f(oo(i[u-1],a))||u<i.length-1&&f(oo(i[u+1],a)))&&Xo(t,oo(t[v],b),o,r.cell);var w=oo(e[v-m],b-g),y=r.replace(w);eo(t[v],b,en.elementnew(y,!0))}return t}(n,u,e,r,o)}))},Ko=function(n,t,e,r,o){!function(n,t,e,r){if(t>0&&t<n.length){var o=n[t-1].cells(),i=(u=e,k(o,(function(n,t){return E(n,(function(n){return u(n.element(),t.element())}))?n:n.concat([t])}),[]));S(i,(function(o){for(var i=g.none(),u=t;u<n.length;u++)for(var a=0;a<uo(n[0]);a++){var c=n[u].cells()[a];e(c.element(),o.element())&&(i.isNone()&&(i=g.some(r())),i.each((function(t){eo(n[u],a,en.elementnew(t,!0))})))}}))}var u}(t,n,o,r.cell);var i=Uo(e,t),u=Go(e,i,r),a=Uo(t,u),c=Go(t,a,r);return c.slice(0,n).concat(u).concat(c.slice(n,c.length))},Jo=function(n,t,e,r,o){var i=n.slice(0,t),u=n.slice(t),a=io(n[e],(function(e,i){return t>0&&t<n.length&&r(oo(n[t-1],i),oo(n[t],i))?ro(n[t],i):en.elementnew(o(e.element(),r),!0)}));return i.concat([a]).concat(u)},$o=function(n,t,e,r,o){return C(n,(function(n){var i=t>0&&t<uo(n)&&r(oo(n,t-1),oo(n,t))?ro(n,t):en.elementnew(o(oo(n,e),r),!0);return no(n,t,i)}))},Qo=function(n,t,e,r){return C(n,(function(n){return io(n,(function(n){return o=n,E(t,(function(n){return e(o.element(),n.element())}))?en.elementnew(r(n.element(),e),!0):n;var o}))}))},Zo=function(n,t,e,r){return void 0!==oo(n[t],e)&&t>0&&r(oo(n[t-1],e),oo(n[t],e))},ni=function(n,t,e){return t>0&&e(oo(n,t-1),oo(n,t))},ti=function(n,t,e,r){var o=P(n,(function(r,o){return Zo(n,o,t,e)||ni(r,t,e)?[]:[ro(r,t)]}));return Qo(n,o,e,r)},ei=function(n,t,e,r){var o=n[t],i=P(o.cells(),(function(r,i){return Zo(n,t,i,e)||ni(o,i,e)?[]:[r]}));return Qo(n,i,e,r)},ri=function(n){return{fold:n}},oi=function(){return ri((function(n,t,e,r,o){return n()}))},ii=function(n,t,e,r){var o,i,u=n.slice(0),a=(i=t,0===(o=n).length?oi():1===o.length?ri((function(n,t,e,r,o){return t(0)})):0===i?ri((function(n,t,e,r,o){return e(0,1)})):i===o.length-1?function(n,t){return ri((function(e,r,o,i,u){return u(n,t)}))}(i-1,i):i>0&&i<o.length-1?function(n,t,e){return ri((function(r,o,i,u,a){return u(n,t,e)}))}(i-1,i,i+1):oi()),l=function(n){return C(n,c.constant(0))},s=c.constant(l(u)),f=function(n,t){if(e>=0){var o=Math.max(r.minCellWidth(),u[t]-e);return l(u.slice(0,n)).concat([e,o-u[t]]).concat(l(u.slice(t+1)))}var i=Math.max(r.minCellWidth(),u[n]+e),a=u[n]-i;return l(u.slice(0,n)).concat([i-u[n],a]).concat(l(u.slice(t+1)))},d=f;return a.fold(s,(function(n){return r.singleColumnWidth(u[n],e)}),d,(function(n,t,e){return f(t,e)}),(function(n,t){if(e>=0)return l(u.slice(0,t)).concat([e]);var o=Math.max(r.minCellWidth(),u[t]+e);return l(u.slice(0,t)).concat([o-u[t]])}))},ui=function(n,t){return ct.has(n,t)&&parseInt(ct.get(n,t),10)>1},ai={hasColspan:function(n){return ui(n,"colspan")},hasRowspan:function(n){return ui(n,"rowspan")},minWidth:c.constant(10),minHeight:c.constant(10),getInt:function(n,t){return parseInt(Vt.get(n,t),10)}},ci=function(n,t,e){return Vt.getRaw(n,t).fold((function(){return e(n)+"px"}),(function(n){return n}))},li=function(n){return ci(n,"width",fr.getPixelWidth)},si=function(n){return ci(n,"height",fr.getHeight)},fi=function(n,t,e,r,o){var i=go(n),u=C(i,(function(n){return n.map(t.edge)}));return C(i,(function(n,t){return n.filter(c.not(ai.hasColspan)).fold((function(){var n=fo(u,t);return r(n)}),(function(n){return e(n,o)}))}))},di=function(n){return n.map((function(n){return n+"px"})).getOr("")},mi=function(n,t,e,r){var o=po(n),i=C(o,(function(n){return n.map(t.edge)}));return C(o,(function(n,t){return n.filter(c.not(ai.hasRowspan)).fold((function(){var n=fo(i,t);return r(n)}),(function(n){return e(n)}))}))},gi={getRawWidths:function(n,t){return fi(n,t,li,di)},getPixelWidths:function(n,t,e){return fi(n,t,fr.getPixelWidth,(function(n){return n.getOrThunk(e.minCellWidth)}),e)},getPercentageWidths:function(n,t,e){return fi(n,t,fr.getPercentageWidth,(function(n){return n.fold((function(){return e.minCellWidth()}),(function(n){return n/e.pixelWidth()*100}))}),e)},getPixelHeights:function(n,t){return mi(n,t,fr.getHeight,(function(n){return n.getOrThunk(ai.minHeight)}))},getRawHeights:function(n,t){return mi(n,t,si,di)}},pi=function(n,t,e){for(var r=0,o=n;o<t;o++)r+=void 0!==e[o]?e[o]:0;return r},hi=function(n,t){var e=qt(n);return C(e,(function(n){var e=pi(n.column(),n.column()+n.colspan(),t);return{element:n.element,width:c.constant(e),colspan:n.colspan}}))},vi=function(n,t){var e=qt(n);return C(e,(function(n){var e=pi(n.row(),n.row()+n.rowspan(),t);return{element:n.element,height:c.constant(e),rowspan:n.rowspan}}))},bi=function(n,t){return C(n.all(),(function(n,e){return{element:n.element,height:c.constant(t[e])}}))},wi=function(n){var t=parseInt(n,10),e=c.identity;return{width:c.constant(t),pixelWidth:c.constant(t),getWidths:gi.getPixelWidths,getCellDelta:e,singleColumnWidth:function(n,t){return[Math.max(ai.minWidth(),n+t)-n]},minCellWidth:ai.minWidth,setElementWidth:fr.setPixelWidth,setTableWidth:function(n,t,e){var r=D(t,(function(n,t){return n+t}),0);fr.setPixelWidth(n,r)}}},yi=function(n){return fr.getRawWidth(n).fold((function(){var t=tr(n);return wi(t)}),(function(t){return function(n,t){if(fr.percentageBasedSizeRegex().test(t))return r=fr.percentageBasedSizeRegex().exec(t)[1],o=n,i=parseFloat(r),u=tr(o),{width:c.constant(i),pixelWidth:c.constant(u),getWidths:gi.getPercentageWidths,getCellDelta:function(n){return n/u*100},singleColumnWidth:function(n,t){return[100-n]},minCellWidth:function(){return ai.minWidth()/u*100},setElementWidth:fr.setPercentageWidth,setTableWidth:function(n,t,e){var r=i+e;fr.setPercentageWidth(n,r)}};if(fr.pixelBasedSizeRegex().test(t)){var e=fr.pixelBasedSizeRegex().exec(t);return wi(e[1])}var r,o,i,u,a=tr(n);return wi(a)}(n,t)}))},xi=function(n){return Et(n)},Ri=function(n){var t=Nt(n);return xi(t)},Ci=function(n){0===At(n).length&&Jt.remove(n)},Si=K.immutable("grid","cursor"),Ti=function(n,t,e){return Di(n,t,e).orThunk((function(){return Di(n,0,0)}))},Di=function(n,t,e){return g.from(n[t]).bind((function(n){return g.from(n.cells()[e]).bind((function(n){return g.from(n.element())}))}))},ki=function(n,t,e){return Si(n,Di(n,t,e))},Ai=function(n){return k(n,(function(n,t){return E(n,(function(n){return n.row()===t.row()}))?n:n.concat([t])}),[]).sort((function(n,t){return n.row()-t.row()}))},Oi=function(n){return k(n,(function(n,t){return E(n,(function(n){return n.column()===t.column()}))?n:n.concat([t])}),[]).sort((function(n,t){return n.column()-t.column()}))},Ni=function(n,t,e){var r=function(n,t){return C(n,(function(n){var e=C(At(n),(function(n){var t=ct.has(n,"rowspan")?parseInt(ct.get(n,"rowspan"),10):1,e=ct.has(n,"colspan")?parseInt(ct.get(n,"colspan"),10):1;return en.detail(n,t,e)}));return en.rowdata(n,e,t.section())}))}(n,e),o=Et(r);return co(o,t,!0)},Pi=function(n,t,e){var r=yi(n),o=xi(t),i=r.getWidths(o,e,r),u=hi(o,i);S(u,(function(n){r.setElementWidth(n.element(),n.width())}));var a=D(i,(function(n,t){return t+n}),0);u.length>0&&r.setElementWidth(n,a)},Bi={insertRowBefore:Io((function(n,t,e,r){var o=t.row(),i=t.row(),u=Jo(n,i,o,e,r.getOrInit);return ki(u,i,t.column())}),Mo,c.noop,c.noop,_r),insertRowsBefore:Io((function(n,t,e,r){var o=t[0].row(),i=t[0].row(),u=Ai(t),a=k(u,(function(n,t){return Jo(n,i,o,e,r.getOrInit)}),n);return ki(a,i,t[0].column())}),qo,c.noop,c.noop,_r),insertRowAfter:Io((function(n,t,e,r){var o=t.row(),i=t.row()+t.rowspan(),u=Jo(n,i,o,e,r.getOrInit);return ki(u,i,t.column())}),Mo,c.noop,c.noop,_r),insertRowsAfter:Io((function(n,t,e,r){var o=Ai(t),i=o[o.length-1].row(),u=o[o.length-1].row()+o[o.length-1].rowspan(),a=k(o,(function(n,t){return Jo(n,u,i,e,r.getOrInit)}),n);return ki(a,u,t[0].column())}),qo,c.noop,c.noop,_r),insertColumnBefore:Io((function(n,t,e,r){var o=t.column(),i=t.column(),u=$o(n,i,o,e,r.getOrInit);return ki(u,t.row(),i)}),Mo,Pi,c.noop,_r),insertColumnsBefore:Io((function(n,t,e,r){var o=Oi(t),i=o[0].column(),u=o[0].column(),a=k(o,(function(n,t){return $o(n,u,i,e,r.getOrInit)}),n);return ki(a,t[0].row(),u)}),qo,Pi,c.noop,_r),insertColumnAfter:Io((function(n,t,e,r){var o=t.column(),i=t.column()+t.colspan(),u=$o(n,i,o,e,r.getOrInit);return ki(u,t.row(),i)}),Mo,Pi,c.noop,_r),insertColumnsAfter:Io((function(n,t,e,r){var o=t[t.length-1].column(),i=t[t.length-1].column()+t[t.length-1].colspan(),u=Oi(t),a=k(u,(function(n,t){return $o(n,i,o,e,r.getOrInit)}),n);return ki(a,t[0].row(),i)}),qo,Pi,c.noop,_r),splitCellIntoColumns:Io((function(n,t,e,r){var o=function(n,t,e,r,o){var i=e+1;return C(n,(function(n,u){var a=u===t?en.elementnew(o(oo(n,e),r),!0):ro(n,e);return no(n,i,a)}))}(n,t.row(),t.column(),e,r.getOrInit);return ki(o,t.row(),t.column())}),Mo,Pi,c.noop,_r),splitCellIntoRows:Io((function(n,t,e,r){var o=function(n,t,e,r,o){var i=t+1,u=n.slice(0,i),a=n.slice(i),c=io(n[t],(function(n,t){return t===e?en.elementnew(o(n.element(),r),!0):n}));return u.concat([c]).concat(a)}(n,t.row(),t.column(),e,r.getOrInit);return ki(o,t.row(),t.column())}),Mo,c.noop,c.noop,_r),eraseColumns:Io((function(n,t,e,r){var o=Oi(t),i=function(n,t,e){var r=C(n,(function(n){var r=n.cells().slice(0,t).concat(n.cells().slice(e+1));return en.rowcells(r,n.section())}));return T(r,(function(n){return n.cells().length>0}))}(n,o[0].column(),o[o.length-1].column()),u=Ti(i,t[0].row(),t[0].column());return Si(i,u)}),qo,Pi,Ci,_r),eraseRows:Io((function(n,t,e,r){var o=Ai(t),i=function(n,t,e){return n.slice(0,t).concat(n.slice(e+1))}(n,o[0].row(),o[o.length-1].row()),u=Ti(i,t[0].row(),t[0].column());return Si(i,u)}),qo,c.noop,Ci,_r),makeColumnHeader:Io((function(n,t,e,r){var o=ti(n,t.column(),e,r.replaceOrInit);return ki(o,t.row(),t.column())}),Mo,c.noop,c.noop,jr("row","th")),unmakeColumnHeader:Io((function(n,t,e,r){var o=ti(n,t.column(),e,r.replaceOrInit);return ki(o,t.row(),t.column())}),Mo,c.noop,c.noop,jr(null,"td")),makeRowHeader:Io((function(n,t,e,r){var o=ei(n,t.row(),e,r.replaceOrInit);return ki(o,t.row(),t.column())}),Mo,c.noop,c.noop,jr("col","th")),unmakeRowHeader:Io((function(n,t,e,r){var o=ei(n,t.row(),e,r.replaceOrInit);return ki(o,t.row(),t.column())}),Mo,c.noop,c.noop,jr(null,"td")),mergeCells:Io((function(n,t,e,r){var o=t.cells();Ur(o);var i=function(n,t,e,r){if(0===n.length)return n;for(var o=t.startRow();o<=t.finishRow();o++)for(var i=t.startCol();i<=t.finishCol();i++)eo(n[o],i,en.elementnew(r(),!1));return n}(n,t.bounds(),0,c.constant(o[0]));return Si(i,g.from(o[0]))}),(function(n,t){return t.mergable()}),c.noop,c.noop,zr),unmergeCells:Io((function(n,t,e,r){var o=D(t,(function(n,t){return Xo(n,t,e,r.combine(t))}),n);return Si(o,g.from(t[0]))}),(function(n,t){return t.unmergable()}),Pi,c.noop,zr),pasteCells:Io((function(n,t,e,r){var o,i,u,a,c=(o=t.clipboard(),i=t.generators(),u=Nt(o),a=Et(u),co(a,i,!0)),l=en.address(t.row(),t.column());return Yo(l,n,c,t.generators(),e).fold((function(){return Si(n,g.some(t.element()))}),(function(n){var e=Ti(n,t.row(),t.column());return Si(n,e)}))}),(function(n,t){return kt(t.element()).bind((function(e){return Eo(n,e).map((function(n){return Kr.merge(n,{generators:t.generators,clipboard:t.clipboard})}))}))}),Pi,c.noop,_r),pasteRowsBefore:Io((function(n,t,e,r){var o=n[t.cells[0].row()],i=t.cells[0].row(),u=Ni(t.clipboard(),t.generators(),o),a=Ko(i,n,u,t.generators(),e),c=Ti(a,t.cells[0].row(),t.cells[0].column());return Si(a,c)}),_o,c.noop,c.noop,_r),pasteRowsAfter:Io((function(n,t,e,r){var o=n[t.cells[0].row()],i=t.cells[t.cells.length-1].row()+t.cells[t.cells.length-1].rowspan(),u=Ni(t.clipboard(),t.generators(),o),a=Ko(i,n,u,t.generators(),e),c=Ti(a,t.cells[0].row(),t.cells[0].column());return Si(a,c)}),_o,c.noop,c.noop,_r)},Ei=function(n){return on.fromDom(n.getBody())},Ii=Ei,Wi=function(n){return function(t){return zn.eq(t,Ei(n))}},Mi=function(n){return/^[0-9]+$/.test(n)&&(n+="px"),n},qi=function(n){return"rtl"===Vt.get(n,"direction")?"rtl":"ltr"},_i={isRtl:c.constant(!1)},ji={isRtl:c.constant(!0)},zi=function(n){return"rtl"===qi(n)?ji:_i},Li=["tableprops","tabledelete","|","tableinsertrowbefore","tableinsertrowafter","tabledeleterow","|","tableinsertcolbefore","tableinsertcolafter","tabledeletecol"],Hi={"border-collapse":"collapse",width:"100%"},Fi={border:"1"},Vi=function(n){return n.getParam("forced_root_block","p","string")},Ui=function(n){return n.getParam("table_cell_advtab",!0,"boolean")},Gi=function(n){return n.getParam("table_row_advtab",!0,"boolean")},Xi=function(n){return n.getParam("table_advtab",!0,"boolean")},Yi=function(n){return n.getParam("table_style_by_css",!1,"boolean")},Ki=function(n){return n.getParam("table_cell_class_list",[],"array")},Ji=function(n){return n.getParam("table_row_class_list",[],"array")},$i=function(n){return n.getParam("table_class_list",[],"array")},Qi=function(n){return!1===n.getParam("table_responsive_width")},Zi=function(n,t){return n.fire("newrow",{node:t})},nu=function(n,t){return n.fire("newcell",{node:t})},tu=tinymce.util.Tools.resolve("tinymce.util.Tools"),eu=function(n,t,e){e&&n.formatter.apply("align"+e,{},t)},ru=function(n,t){tu.each("left center right".split(" "),(function(e){n.formatter.remove("align"+e,{},t)}))},ou=function(n,t,e){return function(t,r){for(var o=0;o<r.length;o++){var i=n.getStyle(r[o],e);if(void 0===t&&(t=i),t!==i)return""}return t}(undefined,n.select("td,th",t))},iu=function(n,t){var e=n.dom,r=t.control.rootControl,o=r.toJSON(),i=e.parseStyle(o.style);"style"===t.control.name()?(r.find("#borderStyle").value(i["border-style"]||"")[0].fire("select"),r.find("#borderColor").value(i["border-color"]||"")[0].fire("change"),r.find("#backgroundColor").value(i["background-color"]||"")[0].fire("change"),r.find("#width").value(i.width||"").fire("change"),r.find("#height").value(i.height||"").fire("change")):(i["border-style"]=o.borderStyle,i["border-color"]=o.borderColor,i["background-color"]=o.backgroundColor,i.width=o.width?Mi(o.width):"",i.height=o.height?Mi(o.height):""),r.find("#style").value(e.serializeStyle(e.parseStyle(e.serializeStyle(i))))},uu=function(n){var t=function(){var t=n.getParam("color_picker_callback");if(t)return function(e){return t.call(n,(function(n){e.control.value(n).fire("change")}),e.control.value())}};return{title:"Advanced",type:"form",defaults:{onchange:c.curry(iu,n)},items:[{label:"Style",name:"style",type:"textbox"},{type:"form",padding:0,formItemDefaults:{layout:"grid",alignH:["start","right"]},defaults:{size:7},items:[{label:"Border style",type:"listbox",name:"borderStyle",width:90,onselect:c.curry(iu,n),values:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]},{label:"Border color",type:"colorbox",name:"borderColor",onaction:t()},{label:"Background color",type:"colorbox",name:"backgroundColor",onaction:t()}]}]}},au=function(n,t,e){var r=function(n,e){return e=e||[],tu.each(n,(function(n){var o={text:n.text||n.title};n.menu?o.menu=r(n.menu):(o.value=n.value,t&&t(o)),e.push(o)})),e};return r(n,e||[])},cu=iu,lu=function(n,t){var e=n.parseStyle(n.getAttrib(t,"style")),r={};return e["border-style"]&&(r.borderStyle=e["border-style"]),e["border-color"]&&(r.borderColor=e["border-color"]),e["background-color"]&&(r.backgroundColor=e["background-color"]),r.style=n.serializeStyle(e),r},su=function(n,t,e){var r,o=n.dom;function i(n,t,e){e&&o.setAttrib(n,t,e)}function u(n,t,e){e&&o.setStyle(n,t,e)}cu(n,e),r=e.control.rootControl.toJSON(),n.undoManager.transact((function(){tu.each(t,(function(e){var a,c;i(e,"scope",r.scope),1===t.length?i(e,"style",r.style):(a=e,c=r.style,a.style.cssText+=";"+c),i(e,"class",r.class),u(e,"width",Mi(r.width)),u(e,"height",Mi(r.height)),r.type&&e.nodeName.toLowerCase()!==r.type&&(e=o.rename(e,r.type)),1===t.length&&(ru(n,e),function(n,t){tu.each("top middle bottom".split(" "),(function(e){n.formatter.remove("valign"+e,{},t)}))}(n,e)),r.align&&eu(n,e,r.align),r.valign&&function(n,t,e){e&&n.formatter.apply("valign"+e,{},t)}(n,e,r.valign)})),n.focus()}))},fu=function(n){var t,e,r,o=[];if(o=n.dom.select("td[data-mce-selected],th[data-mce-selected]"),t=n.dom.getParent(n.selection.getStart(),"td,th"),!o.length&&t&&o.push(t),t=t||o[0]){var i,u,a,l;o.length>1?e={width:"",height:"",scope:"",class:"",align:"",style:"",type:t.nodeName.toLowerCase()}:(u=t,a=(i=n).dom,(l={width:a.getStyle(u,"width")||a.getAttrib(u,"width"),height:a.getStyle(u,"height")||a.getAttrib(u,"height"),scope:a.getAttrib(u,"scope"),class:a.getAttrib(u,"class")}).type=u.nodeName.toLowerCase(),tu.each("left center right".split(" "),(function(n){i.formatter.matchNode(u,"align"+n)&&(l.align=n)})),tu.each("top middle bottom".split(" "),(function(n){i.formatter.matchNode(u,"valign"+n)&&(l.valign=n)})),Ui(i)&&tu.extend(l,lu(a,u)),e=l),Ki(n).length>0&&(r={name:"class",type:"listbox",label:"Class",values:au(Ki(n),(function(t){t.value&&(t.textStyle=function(){return n.formatter.getCssText({block:"td",classes:[t.value]})})}))});var s={type:"form",layout:"flex",direction:"column",labelGapCalc:"children",padding:0,items:[{type:"form",layout:"grid",columns:2,labelGapCalc:!1,padding:0,defaults:{type:"textbox",maxWidth:50},items:[{label:"Width",name:"width",onchange:c.curry(cu,n)},{label:"Height",name:"height",onchange:c.curry(cu,n)},{label:"Cell type",name:"type",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]},{label:"Scope",name:"scope",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Row",value:"row"},{text:"Column",value:"col"},{text:"Row group",value:"rowgroup"},{text:"Column group",value:"colgroup"}]},{label:"H Align",name:"align",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"V Align",name:"valign",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Top",value:"top"},{text:"Middle",value:"middle"},{text:"Bottom",value:"bottom"}]}]},r]};Ui(n)?n.windowManager.open({title:"Cell properties",bodyType:"tabpanel",data:e,body:[{title:"General",type:"form",items:s},uu(n)],onsubmit:c.curry(su,n,o)}):n.windowManager.open({title:"Cell properties",data:e,body:s,onsubmit:c.curry(su,n,o)})}};function du(n,t,e){var r,o=n.dom;function i(n,t,e){e&&o.setAttrib(n,t,e)}cu(n,e),r=e.control.rootControl.toJSON(),n.undoManager.transact((function(){tu.each(t,(function(e){var u,a;i(e,"scope",r.scope),i(e,"style",r.style),i(e,"class",r.class),u=e,(a=Mi(r.height))&&o.setStyle(u,"height",a),r.type!==e.parentNode.nodeName.toLowerCase()&&function(n,t,e){var r=n.getParent(t,"table"),o=t.parentNode,i=n.select(e,r)[0];i||(i=n.create(e),r.firstChild?"CAPTION"===r.firstChild.nodeName?n.insertAfter(i,r.firstChild):r.insertBefore(i,r.firstChild):r.appendChild(i)),i.appendChild(t),o.hasChildNodes()||n.remove(o)}(n.dom,e,r.type),1===t.length&&ru(n,e),r.align&&eu(n,e,r.align)})),n.focus()}))}var mu=function(n){var t,e,r,o,i,u,a,l,s,f,d=n.dom,m=[];t=d.getParent(n.selection.getStart(),"table"),e=d.getParent(n.selection.getStart(),"td,th"),tu.each(t.rows,(function(n){tu.each(n.cells,(function(t){if(d.getAttrib(t,"data-mce-selected")||t===e)return m.push(n),!1}))})),(r=m[0])&&(m.length>1?i={height:"",scope:"",class:"",align:"",type:r.parentNode.nodeName.toLowerCase()}:(l=r,s=(a=n).dom,(f={height:s.getStyle(l,"height")||s.getAttrib(l,"height"),scope:s.getAttrib(l,"scope"),class:s.getAttrib(l,"class")}).type=l.parentNode.nodeName.toLowerCase(),tu.each("left center right".split(" "),(function(n){a.formatter.matchNode(l,"align"+n)&&(f.align=n)})),Gi(a)&&tu.extend(f,lu(s,l)),i=f),Ji(n).length>0&&(o={name:"class",type:"listbox",label:"Class",values:au(Ji(n),(function(t){t.value&&(t.textStyle=function(){return n.formatter.getCssText({block:"tr",classes:[t.value]})})}))}),u={type:"form",columns:2,padding:0,defaults:{type:"textbox"},items:[{type:"listbox",name:"type",label:"Row type",text:"Header",maxWidth:null,values:[{text:"Header",value:"thead"},{text:"Body",value:"tbody"},{text:"Footer",value:"tfoot"}]},{type:"listbox",name:"align",label:"Alignment",text:"None",maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height"},o]},Gi(n)?n.windowManager.open({title:"Row properties",data:i,bodyType:"tabpanel",body:[{title:"General",type:"form",items:u},uu(n)],onsubmit:c.curry(du,n,m)}):n.windowManager.open({title:"Row properties",data:i,body:u,onsubmit:c.curry(du,n,m)}))},gu=tinymce.util.Tools.resolve("tinymce.Env"),pu={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"},percentages:!0},hu=function(n,t){n.selection.select(t.dom(),!0),n.selection.collapse(!0)},vu=function(n,t,e){var r,o,i=n.getParam("table_default_styles",Hi,"object"),u=function(n,t,e,r,o){void 0===o&&(o=pu);var i=on.fromTag("table");Vt.setAll(i,o.styles),ct.setAll(i,o.attributes);var u=on.fromTag("tbody");Xt.append(i,u);for(var a=[],c=0;c<n;c++){for(var l=on.fromTag("tr"),s=0;s<t;s++){var f=on.fromTag(c<0||s<0?"th":"td");s<0&&ct.set(f,"scope","row"),c<0&&ct.set(f,"scope","col"),Xt.append(f,on.fromTag("br")),o.percentages&&Vt.set(f,"width",100/t+"%"),Xt.append(l,f)}a.push(l)}return Yt.append(u,a),i}(e,t,0,0,{styles:i,attributes:(o=n,o.getParam("table_default_attributes",Fi,"object")),percentages:(r=i.width,F.isString(r)&&-1!==r.indexOf("%")&&!Qi(n))});ct.set(u,"data-mce-id","__mce");var a=function(n){var t=on.fromTag("div"),e=on.fromDom(n.dom().cloneNode(!0));return Xt.append(t,e),function(n){return n.dom().innerHTML}(t)}(u);return n.insertContent(a),Tt.descendant(Ii(n),'table[data-mce-id="__mce"]').map((function(t){var e,r;return Qi(n)&&Vt.set(t,"width",Vt.get(t,"width")),ct.remove(t,"data-mce-id"),e=n,S(gt.descendants(t,"tr"),(function(n){Zi(e,n.dom()),S(gt.descendants(n,"th,td"),(function(n){nu(e,n.dom())}))})),r=n,Tt.descendant(t,"td,th").each(c.curry(hu,r)),t.dom()})).getOr(null)};function bu(n,t,e,r){if("TD"===t.tagName||"TH"===t.tagName)n.setStyle(t,e,r);else if(t.children)for(var o=0;o<t.children.length;o++)bu(n,t.children[o],e,r)}var wu=function(n,t,e){var r,o,i=n.dom;cu(n,e),!1===(o=e.control.rootControl.toJSON()).class&&delete o.class,n.undoManager.transact((function(){t||(t=vu(n,o.cols||1,o.rows||1)),function(n,t,e){var r=n.dom,o={},i={};if(o.class=e.class,i.height=Mi(e.height),r.getAttrib(t,"width")&&!Yi(n)?o.width=function(n){return n?n.replace(/px$/,""):""}(e.width):i.width=Mi(e.width),Yi(n)?(i["border-width"]=Mi(e.border),i["border-spacing"]=Mi(e.cellspacing),tu.extend(o,{"data-mce-border-color":e.borderColor,"data-mce-cell-padding":e.cellpadding,"data-mce-border":e.border})):tu.extend(o,{border:e.border,cellpadding:e.cellpadding,cellspacing:e.cellspacing}),Yi(n)&&t.children)for(var u=0;u<t.children.length;u++)bu(r,t.children[u],{"border-width":Mi(e.border),"border-color":e.borderColor,padding:Mi(e.cellpadding)});e.style?tu.extend(i,r.parseStyle(e.style)):i=tu.extend({},r.parseStyle(r.getAttrib(t,"style")),i),o.style=r.serializeStyle(i),r.setAttribs(t,o)}(n,t,o),(r=i.select("caption",t)[0])&&!o.caption&&i.remove(r),!r&&o.caption&&((r=i.create("caption")).innerHTML=gu.ie?" ":'<br data-mce-bogus="1"/>',t.insertBefore(r,t.firstChild)),ru(n,t),o.align&&eu(n,t,o.align),n.focus(),n.addVisual()}))},yu=function(n,t){var e,r,o,i,u,a,l,s,f,d,m=n.dom,g={};!0===t?(e=m.getParent(n.selection.getStart(),"table"))&&(l=e,s=(a=n).dom,f={width:s.getStyle(l,"width")||s.getAttrib(l,"width"),height:s.getStyle(l,"height")||s.getAttrib(l,"height"),cellspacing:s.getStyle(l,"border-spacing")||s.getAttrib(l,"cellspacing"),cellpadding:s.getAttrib(l,"data-mce-cell-padding")||s.getAttrib(l,"cellpadding")||ou(a.dom,l,"padding"),border:s.getAttrib(l,"data-mce-border")||s.getAttrib(l,"border")||ou(a.dom,l,"border"),borderColor:s.getAttrib(l,"data-mce-border-color"),caption:!!s.select("caption",l)[0],class:s.getAttrib(l,"class")},tu.each("left center right".split(" "),(function(n){a.formatter.matchNode(l,"align"+n)&&(f.align=n)})),Xi(a)&&tu.extend(f,lu(s,l)),g=f):(r={label:"Cols",name:"cols"},o={label:"Rows",name:"rows"}),$i(n).length>0&&(g.class&&(g.class=g.class.replace(/\s*mce\-item\-table\s*/g,"")),i={name:"class",type:"listbox",label:"Class",values:au($i(n),(function(t){t.value&&(t.textStyle=function(){return n.formatter.getCssText({block:"table",classes:[t.value]})})}))}),u={type:"form",layout:"flex",direction:"column",labelGapCalc:"children",padding:0,items:[{type:"form",labelGapCalc:!1,padding:0,layout:"grid",columns:2,defaults:{type:"textbox",maxWidth:50},items:(d=n,d.getParam("table_appearance_options",!0,"boolean")?[r,o,{label:"Width",name:"width",onchange:c.curry(cu,n)},{label:"Height",name:"height",onchange:c.curry(cu,n)},{label:"Cell spacing",name:"cellspacing"},{label:"Cell padding",name:"cellpadding"},{label:"Border",name:"border"},{label:"Caption",name:"caption",type:"checkbox"}]:[r,o,{label:"Width",name:"width",onchange:c.curry(cu,n)},{label:"Height",name:"height",onchange:c.curry(cu,n)}])},{label:"Alignment",name:"align",type:"listbox",text:"None",values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},i]},Xi(n)?n.windowManager.open({title:"Table properties",data:g,bodyType:"tabpanel",body:[{title:"General",type:"form",items:u},uu(n)],onsubmit:c.curry(wu,n,e)}):n.windowManager.open({title:"Table properties",data:g,body:u,onsubmit:c.curry(wu,n,e)})},xu=tu.each,Ru=function(n,t,e,r,o){var i=Wi(n),u=function(){return on.fromDom(n.dom.getParent(n.selection.getStart(),"th,td"))},a=function(n){return Ot(n,i)},l=function(t){var o=u();a(o).each((function(i){var u=Ke.forMenu(r,i,o);t(i,u).each((function(t){n.selection.setRng(t),n.focus(),e.clear(i)}))}))},s=function(t){var e=u();return a(e).bind((function(t){var o=on.fromDom(n.getDoc());return function(n,t,e){var r=Nt(n),o=Et(r);return qo(o,t).map((function(n){var t=co(o,e,!1).slice(n[0].row(),n[n.length-1].row()+n[n.length-1].rowspan());return function(n){return C(n,(function(n){var t=te(n.element());return S(n.cells(),(function(n){var e=ee(n.element());lo(e,"colspan",n.colspan(),1),lo(e,"rowspan",n.rowspan(),1),Xt.append(t,e)})),t}))}(Wo(t,e))}))}(t,Ke.forMenu(r,t,e),ge(c.noop,o,g.none()))}))},f=function(t){o.get().each((function(o){var i=C(o,(function(n){return ee(n)})),c=u();a(c).bind((function(o){var u=on.fromDom(n.getDoc()),a=pe(u),l=Ke.pasteRows(r,o,c,i,a);t(o,l).each((function(t){n.selection.setRng(t),n.focus(),e.clear(o)}))}))}))};xu({mceTableSplitCells:function(){l(t.unmergeCells)},mceTableMergeCells:function(){l(t.mergeCells)},mceTableInsertRowBefore:function(){l(t.insertRowsBefore)},mceTableInsertRowAfter:function(){l(t.insertRowsAfter)},mceTableInsertColBefore:function(){l(t.insertColumnsBefore)},mceTableInsertColAfter:function(){l(t.insertColumnsAfter)},mceTableDeleteCol:function(){l(t.deleteColumn)},mceTableDeleteRow:function(){l(t.deleteRow)},mceTableCutRow:function(n){o.set(s()),l(t.deleteRow)},mceTableCopyRow:function(n){o.set(s())},mceTablePasteRowBefore:function(n){f(t.pasteRowsBefore)},mceTablePasteRowAfter:function(n){f(t.pasteRowsAfter)},mceTableDelete:function(){var t=on.fromDom(n.dom.getParent(n.selection.getStart(),"th,td"));Ot(t,i).filter(c.not(i)).each((function(t){var e=on.fromText("");Xt.after(t,e),Jt.remove(t);var r=n.dom.createRng();r.setStart(e.dom(),0),r.setEnd(e.dom(),0),n.selection.setRng(r)}))}},(function(t,e){n.addCommand(e,t)})),xu({mceInsertTable:c.curry(yu,n),mceTableProps:c.curry(yu,n,!0),mceTableRowProps:c.curry(mu,n),mceTableCellProps:c.curry(fu,n)},(function(t,e){n.addCommand(e,(function(n,e){t(e)}))}))},Cu=function(n){var t=g.from(n.dom().documentElement).map(on.fromDom).getOr(n);return{parent:c.constant(t),view:c.constant(n),origin:c.constant(mr(0,0))}};function Su(n){var t=K.immutable.apply(null,n),e=[];return{bind:function(n){if(void 0===n)throw"Event bind error: undefined handler";e.push(n)},unbind:function(n){e=T(e,(function(t){return t!==n}))},trigger:function(){var n=t.apply(null,arguments);S(e,(function(t){t(n)}))}}}var Tu=function(n){return{registry:L.map(n,(function(n){return{bind:n.bind,unbind:n.unbind}})),trigger:L.map(n,(function(n){return n.trigger}))}},Du={mode:Wr.exactly(["compare","extract","mutate","sink"]),sink:Wr.exactly(["element","start","stop","destroy"]),api:Wr.exactly(["forceDrop","drop","move","delayDrop"])},ku={resolve:ho("ephox-dragster").resolve},Au=function(n,t,e,r){n.dom().removeEventListener(t,e,r)},Ou=c.constant(!0),Nu=function(n,t,e){return function(n,t,e,r){return function(n,t,e,r,o){var i=function(n,t){return function(e){if(n(e)){var r,o,i,u,a,l,s,f=on.fromDom(e.target),d=function(){e.stopPropagation()},m=function(){e.preventDefault()},g=c.compose(m,d),p=(r=f,o=e.clientX,i=e.clientY,u=d,a=m,l=g,s=e,{target:c.constant(r),x:c.constant(o),y:c.constant(i),stop:u,prevent:a,kill:l,raw:c.constant(s)});t(p)}}}(e,r);return n.dom().addEventListener(t,i,o),{unbind:c.curry(Au,n,t,i,o)}}(n,t,e,r,!1)}(n,t,Ou,e)},Pu=Du.mode({compare:function(n,t){return mr(t.left()-n.left(),t.top()-n.top())},extract:function(n){return g.some(mr(n.x(),n.y()))},sink:function(n,t){var e,r,o,i=(e=t,r=Kr.merge({layerClass:ku.resolve("blocker")},e),o=on.fromTag("div"),ct.set(o,"role","presentation"),Vt.setAll(o,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"}),yo(o,ku.resolve("blocker")),yo(o,r.layerClass),{element:function(){return o},destroy:function(){Jt.remove(o)}}),u=Nu(i.element(),"mousedown",n.forceDrop),a=Nu(i.element(),"mouseup",n.drop),c=Nu(i.element(),"mousemove",n.move),l=Nu(i.element(),"mouseout",n.delayDrop);return Du.sink({element:i.element,start:function(n){Xt.append(n,i.element())},stop:function(){Jt.remove(i.element())},destroy:function(){i.destroy(),a.unbind(),c.unbind(),l.unbind(),u.unbind()}})},mutate:function(n,t){n.mutate(t.left(),t.top())}});function Bu(){var n={onEvent:function(n,t){},reset:c.noop},t=function(){var n=g.none(),t=Tu({move:Su(["info"])});return{onEvent:function(e,r){r.extract(e).each((function(e){var o,i,u;(o=r,i=e,u=n.map((function(n){return o.compare(n,i)})),n=g.some(i),u).each((function(n){t.trigger.move(n)}))}))},reset:function(){n=g.none()},events:t.registry}}(),e=n;return{on:function(){e.reset(),e=t},off:function(){e.reset(),e=n},isOn:function(){return e===t},onEvent:function(n,t){e.onEvent(n,t)},events:t.events}}var Eu=function(n,t){var e=void 0!==t?t:{};return function(n,t,e){var r=!1,o=Tu({start:Su([]),stop:Su([])}),i=Bu(),u=function(){l.stop(),i.isOn()&&(i.off(),o.trigger.stop())},a=function(n,t){var e=null;return{cancel:function(){null!==e&&(clearTimeout(e),e=null)},throttle:function(){var t=arguments;null!==e&&clearTimeout(e),e=setTimeout((function(){n.apply(null,t),e=null,t=null}),200)}}}(u);i.events.move.bind((function(e){t.mutate(n,e.info())}));var c=function(n){return function(){var t=Array.prototype.slice.call(arguments,0);if(r)return n.apply(null,t)}},l=t.sink(Du.api({forceDrop:u,drop:c(u),move:c((function(n,e){a.cancel(),i.onEvent(n,t)})),delayDrop:c(a.throttle)}),e);return{element:l.element,go:function(n){l.start(n),i.on(),o.trigger.start()},on:function(){r=!0},off:function(){r=!1},destroy:function(){l.destroy()},events:o.registry}}(n,void 0!==e.mode?e.mode:Pu,t)},Iu=vo.resolve("resizer-bar-dragging");function Wu(n,t){var e=kr.height,r=function(n,t,e){var r=function(){var n,t=Tu({drag:Su(["xDelta","yDelta","target"])}),e=g.none(),r={mutate:function(t,e){n.trigger.drag(t,e)},events:(n=Tu({drag:Su(["xDelta","yDelta"])})).registry};return r.events.drag.bind((function(n){e.each((function(e){t.trigger.drag(n.xDelta(),n.yDelta(),e)}))})),{assign:function(n){e=g.some(n)},get:function(){return e},mutate:r.mutate,events:t.registry}}(),o=Eu(r,{}),i=g.none(),u=function(n,t){return g.from(ct.get(n,t))};r.events.drag.bind((function(n){u(n.target(),"data-row").each((function(t){var e=ai.getInt(n.target(),"top");Vt.set(n.target(),"top",e+n.yDelta()+"px")})),u(n.target(),"data-column").each((function(t){var e=ai.getInt(n.target(),"left");Vt.set(n.target(),"left",e+n.xDelta()+"px")}))}));var a=function(n,t){return ai.getInt(n,t)-parseInt(ct.get(n,"data-initial-"+t),10)};o.events.stop.bind((function(){r.get().each((function(r){i.each((function(o){u(r,"data-row").each((function(n){var t=a(r,"top");ct.remove(r,"data-initial-top"),m.trigger.adjustHeight(o,t,parseInt(n,10))})),u(r,"data-column").each((function(n){var t=a(r,"left");ct.remove(r,"data-initial-left"),m.trigger.adjustWidth(o,t,parseInt(n,10))})),Ao(n,o,e,t)}))}))}));var l=function(t,e){m.trigger.startAdjust(),r.assign(t),ct.set(t,"data-initial-"+e,parseInt(Vt.get(t,e),10)),yo(t,Iu),Vt.set(t,"opacity","0.2"),o.go(n.parent())},s=Nu(n.parent(),"mousedown",(function(n){(function(n){return xo(n,Co)})(n.target())&&l(n.target(),"top"),function(n){return xo(n,So)}(n.target())&&l(n.target(),"left")})),f=function(t){return zn.eq(t,n.view())},d=Nu(n.view(),"mouseover",(function(r){"table"===rt.name(r.target())||function(n,t,e){return Tt.ancestor(n,t,e).isSome()}(r.target(),"table",f)?(i="table"===rt.name(r.target())?g.some(r.target()):Tt.ancestor(r.target(),"table",f)).each((function(r){Ao(n,r,e,t)})):ft.inBody(r.target())&&Po(n)})),m=Tu({adjustHeight:Su(["table","delta","row"]),adjustWidth:Su(["table","delta","column"]),startAdjust:Su([])});return{destroy:function(){s.unbind(),d.unbind(),o.destroy(),Po(n)},refresh:function(r){Ao(n,r,e,t)},on:o.on,off:o.off,hideBars:c.curry(Oo,n),showBars:c.curry(No,n),events:m.registry}}(n,t,e),o=Tu({beforeResize:Su(["table"]),afterResize:Su(["table"]),startDrag:Su([])});return r.events.adjustHeight.bind((function(n){o.trigger.beforeResize(n.table());var t=e.delta(n.delta(),n.table());(function(n,t,e,r){var o=Ri(n),i=gi.getPixelHeights(o,r),u=C(i,(function(n,r){return e===r?Math.max(t+n,ai.minHeight()):n})),a=vi(o,u),c=bi(o,u);S(c,(function(n){fr.setHeight(n.element(),n.height())})),S(a,(function(n){fr.setHeight(n.element(),n.height())}));var l=D(u,(function(n,t){return n+t}),0);fr.setHeight(n,l)})(n.table(),t,n.row(),e),o.trigger.afterResize(n.table())})),r.events.startAdjust.bind((function(n){o.trigger.startDrag()})),r.events.adjustWidth.bind((function(n){o.trigger.beforeResize(n.table());var e=t.delta(n.delta(),n.table());(function(n,t,e,r){var o=yi(n),i=o.getCellDelta(t),u=Ri(n),a=o.getWidths(u,r,o),c=ii(a,e,i,o),l=C(c,(function(n,t){return n+a[t]})),s=hi(u,l);S(s,(function(n){o.setElementWidth(n.element(),n.width())})),e===u.grid().columns()-1&&o.setTableWidth(n,l,i)})(n.table(),e,n.column(),t),o.trigger.afterResize(n.table())})),{on:r.on,off:r.off,hideBars:r.hideBars,showBars:r.showBars,destroy:r.destroy,events:o.registry}}var Mu=function(n,t){return n.inline?function(n,t){return{parent:c.constant(t),view:c.constant(n),origin:c.constant(mr(0,0))}}(Ii(n),(e=on.fromTag("div"),Vt.setAll(e,{position:"static",height:"0",width:"0",padding:"0",margin:"0",border:"0"}),Xt.append(ft.body(),e),e)):Cu(on.fromDom(n.getDoc()));var e},qu=function(n){return{fold:n}},_u=function(n){return qu((function(t,e,r,o){return t(n)}))},ju=function(n,t){return qu((function(e,r,o,i){return o(n,t)}))},zu=function(n,t){return Ot(n,t).bind((function(t){var e=At(t);return O(e,(function(t){return zn.eq(n,t)})).map((function(n){return{index:c.constant(n),all:c.constant(e)}}))}))},Lu=ze([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Hu={before:Lu.before,on:Lu.on,after:Lu.after,cata:function(n,t,e,r){return n.fold(t,e,r)},getStart:function(n){return n.fold(c.identity,c.identity,c.identity)}},Fu=ze([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Vu=K.immutable("start","soffset","finish","foffset"),Uu={domRange:Fu.domRange,relative:Fu.relative,exact:Fu.exact,exactFromRange:function(n){return Fu.exact(n.start(),n.soffset(),n.finish(),n.foffset())},range:Vu,getWin:function(n){var t=n.match({domRange:function(n){return on.fromDom(n.startContainer)},relative:function(n,t){return Hu.getStart(n)},exact:function(n,t,e,r){return n}});return Yn.defaultView(t)}},Gu=function(n){return{left:c.constant(n.left),top:c.constant(n.top),right:c.constant(n.right),bottom:c.constant(n.bottom),width:c.constant(n.width),height:c.constant(n.height)}},Xu=function(n,t,e){var r,o,i=n.document.createRange();return r=i,t.fold((function(n){r.setStartBefore(n.dom())}),(function(n,t){r.setStart(n.dom(),t)}),(function(n){r.setStartAfter(n.dom())})),o=i,e.fold((function(n){o.setEndBefore(n.dom())}),(function(n,t){o.setEnd(n.dom(),t)}),(function(n){o.setEndAfter(n.dom())})),i},Yu=function(n,t,e,r,o){var i=n.document.createRange();return i.setStart(t.dom(),e),i.setEnd(r.dom(),o),i},Ku=ze([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),Ju=function(n,t,e){return t(on.fromDom(e.startContainer),e.startOffset,on.fromDom(e.endContainer),e.endOffset)},$u=function(n,t){var e,r,o,i=(e=n,t.match({domRange:function(n){return{ltr:c.constant(n),rtl:g.none}},relative:function(n,t){return{ltr:fn((function(){return Xu(e,n,t)})),rtl:fn((function(){return g.some(Xu(e,t,n))}))}},exact:function(n,t,r,o){return{ltr:fn((function(){return Yu(e,n,t,r,o)})),rtl:fn((function(){return g.some(Yu(e,r,o,n,t))}))}}}));return(o=(r=i).ltr()).collapsed?r.rtl().filter((function(n){return!1===n.collapsed})).map((function(n){return Ku.rtl(on.fromDom(n.endContainer),n.endOffset,on.fromDom(n.startContainer),n.startOffset)})).getOrThunk((function(){return Ju(0,Ku.ltr,o)})):Ju(0,Ku.ltr,o)},Qu=(Ku.ltr,Ku.rtl,$u),Zu=function(n,t){return $u(n,t).match({ltr:function(t,e,r,o){var i=n.document.createRange();return i.setStart(t.dom(),e),i.setEnd(r.dom(),o),i},rtl:function(t,e,r,o){var i=n.document.createRange();return i.setStart(r.dom(),o),i.setEnd(t.dom(),e),i}})},na=function(n,t,e){return t>=n.left&&t<=n.right&&e>=n.top&&e<=n.bottom},ta=function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var i=o.getClientRects();return $r(i,(function(n){return na(n,e,r)?g.some(n):g.none()})).map((function(o){return i=n,a=e,c=r,l=o,s=function(n){var t=i.dom().createRange();return t.setStart(u.dom(),n),t.collapse(!0),t},f=oe.get(u=t).length,d=function(n,t,e,r,o){if(0===o)return 0;if(t===r)return o-1;for(var i=r,u=1;u<o;u++){var a=n(u),c=Math.abs(t-a.left);if(e>a.bottom);else{if(e<a.top||c>i)return u-1;i=c}}return 0}((function(n){return s(n).getBoundingClientRect()}),a,c,l.right,f),s(d);var i,u,a,c,l,s,f,d}))},ea=function(n,t,e,r){var o=n.dom().createRange(),i=Yn.children(t);return $r(i,(function(t){return o.selectNode(t.dom()),na(o.getBoundingClientRect(),e,r)?ra(n,t,e,r):g.none()}))},ra=function(n,t,e,r){return(rt.isText(t)?ta:ea)(n,t,e,r)},oa=function(n,t){return t-n.left<n.right-t},ia=function(n,t,e){var r=n.dom().createRange();return r.selectNode(t.dom()),r.collapse(e),r},ua=function(n,t,e){var r=n.dom().createRange();r.selectNode(t.dom());var o=r.getBoundingClientRect(),i=oa(o,e);return(!0===i?ce:le)(t).map((function(t){return ia(n,t,i)}))},aa=function(n,t,e){var r=t.dom().getBoundingClientRect(),o=oa(r,e);return g.some(ia(n,t,o))},ca=function(n,t,e){return(0===Yn.children(t).length?aa:ua)(n,t,e)},la=document.caretPositionFromPoint?function(n,t,e){return g.from(n.dom().caretPositionFromPoint(t,e)).bind((function(t){if(null===t.offsetNode)return g.none();var e=n.dom().createRange();return e.setStart(t.offsetNode,t.offset),e.collapse(),g.some(e)}))}:document.caretRangeFromPoint?function(n,t,e){return g.from(n.dom().caretRangeFromPoint(t,e))}:function(n,t,e){return on.fromPoint(n,t,e).bind((function(r){var o=function(){return ca(n,r,t)};return 0===Yn.children(r).length?o():function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var i=o.getBoundingClientRect();return function(n,t,e,r){var o=n.dom().createRange();o.selectNode(t.dom());var i=o.getBoundingClientRect(),u=Math.max(i.left,Math.min(i.right,e)),a=Math.max(i.top,Math.min(i.bottom,r));return ra(n,t,u,a)}(n,t,Math.max(i.left,Math.min(i.right,e)),Math.max(i.top,Math.min(i.bottom,r)))}(n,r,t,e).orThunk(o)}))},sa=function(n,t){var e=rt.name(n);return"input"===e?Hu.after(n):I(["br","img"],e)?0===t?Hu.before(n):Hu.after(n):Hu.on(n,t)},fa=function(n,t){var e=n.fold(Hu.before,sa,Hu.after),r=t.fold(Hu.before,sa,Hu.after);return Uu.relative(e,r)},da=function(n,t,e,r){var o=sa(n,t),i=sa(e,r);return Uu.relative(o,i)},ma=fa,ga=da,pa=function(n,t){g.from(n.getSelection()).each((function(n){n.removeAllRanges(),n.addRange(t)}))},ha=function(n,t,e,r,o){var i=Yu(n,t,e,r,o);pa(n,i)},va=function(n,t){return Qu(n,t).match({ltr:function(t,e,r,o){ha(n,t,e,r,o)},rtl:function(t,e,r,o){var i=n.getSelection();i.setBaseAndExtent?i.setBaseAndExtent(t.dom(),e,r.dom(),o):i.extend?(i.collapse(t.dom(),e),i.extend(r.dom(),o)):ha(n,r,o,t,e)}})},ba=function(n){var t=n.getSelection();return t.rangeCount>0?function(n){var t=on.fromDom(n.anchorNode),e=on.fromDom(n.focusNode);return function(n,t,e,r){var o=function(n,t,e,r){var o=Yn.owner(n).dom().createRange();return o.setStart(n.dom(),t),o.setEnd(e.dom(),r),o}(n,t,e,r),i=zn.eq(n,e)&&t===r;return o.collapsed&&!i}(t,n.anchorOffset,e,n.focusOffset)?g.some(Uu.range(on.fromDom(n.anchorNode),n.anchorOffset,on.fromDom(n.focusNode),n.focusOffset)):function(n){if(n.rangeCount>0){var t=n.getRangeAt(0),e=n.getRangeAt(n.rangeCount-1);return g.some(Uu.range(on.fromDom(t.startContainer),t.startOffset,on.fromDom(e.endContainer),e.endOffset))}return g.none()}(n)}(t):g.none()},wa=function(n,t){return function(n){var t=n.getClientRects(),e=t.length>0?t[0]:n.getBoundingClientRect();return e.width>0||e.height>0?g.some(e).map(Gu):g.none()}(Zu(n,t))},ya=tinymce.util.Tools.resolve("tinymce.util.VK"),xa=function(n,t,e,r){return Sa(n,t,function(n,t){return zu(n,t).fold((function(){return _u(n)}),(function(t){return t.index()+1<t.all().length?ju(n,t.all()[t.index()+1]):function(n){return qu((function(t,e,r,o){return o(n)}))}(n)}))}(e),r)},Ra=function(n,t,e,r){return Sa(n,t,function(n,t){return zu(n,t).fold((function(){return _u()}),(function(t){return t.index()-1>=0?ju(n,t.all()[t.index()-1]):function(n){return qu((function(t,e,r,o){return e(n)}))}(n)}))}(e),r)},Ca=function(n,t){return function(n){var t=Uu.getWin(n).dom(),e=function(n,e,r,o){return Yu(t,n,e,r,o)},r=function(n){return n.match({domRange:function(n){var t=on.fromDom(n.startContainer),e=on.fromDom(n.endContainer);return da(t,n.startOffset,e,n.endOffset)},relative:fa,exact:da})}(n);return Qu(t,r).match({ltr:e,rtl:e})}(Uu.exact(t,0,t,0))},Sa=function(n,t,e,r,o){return e.fold(g.none,g.none,(function(n,t){return ce(t).map((function(n){return Ca(0,n)}))}),(function(e){return Ot(e,t).bind((function(t){var o=Ke.noMenu(e);return n.undoManager.transact((function(){r.insertRowsAfter(t,o)})),function(n){return 0===n.length?g.none():g.some(n[n.length-1])}(gt.descendants(t,"tr")).bind((function(n){return Tt.descendant(n,"td,th").map((function(n){return Ca(0,n)}))}))}))}))},Ta=["table","li","dl"],Da={response:K.immutable("selection","kill")},ka=function(n){return function(t){return t===n}},Aa=ka(38),Oa=ka(40),Na={ltr:{isBackward:ka(37),isForward:ka(39)},rtl:{isBackward:ka(39),isForward:ka(37)},isUp:Aa,isDown:Oa,isNavigation:function(n){return n>=37&&n<=40}},Pa=function(n,t){var e=Zu(n,t);return{start:c.constant(on.fromDom(e.startContainer)),soffset:c.constant(e.startOffset),finish:c.constant(on.fromDom(e.endContainer)),foffset:c.constant(e.endOffset)}},Ba=function(n,t,e,r){return{start:c.constant(Hu.on(n,t)),finish:c.constant(Hu.on(e,r))}},Ea=(qn.detect().browser.isSafari(),function(n){var t=void 0!==n?n.dom():document,e=t.body.scrollLeft||t.documentElement.scrollLeft,r=t.body.scrollTop||t.documentElement.scrollTop;return mr(e,r)}),Ia=Ea;function Wa(n){return{elementFromPoint:function(t,e){return g.from(n.document.elementFromPoint(t,e)).map(on.fromDom)},getRect:function(n){return n.dom().getBoundingClientRect()},getRangedRect:function(t,e,r,o){var i=Uu.exact(t,e,r,o);return wa(n,i).map((function(n){return L.map(n,c.apply)}))},getSelection:function(){return function(n){return ba(n).map((function(n){return Uu.exact(n.start(),n.soffset(),n.finish(),n.foffset())}))}(n).map((function(t){return Pa(n,t)}))},fromSitus:function(t){var e=Uu.relative(t.start(),t.finish());return Pa(n,e)},situsFromPoint:function(t,e){return function(n,t,e){return function(n,t,e){var r=on.fromDom(n.document);return la(r,t,e).map((function(n){return Uu.range(on.fromDom(n.startContainer),n.startOffset,on.fromDom(n.endContainer),n.endOffset)}))}(n,t,e)}(n,t,e).map((function(n){return{start:c.constant(Hu.on(n.start(),n.soffset())),finish:c.constant(Hu.on(n.finish(),n.foffset()))}}))},clearSelection:function(){!function(n){n.getSelection().removeAllRanges()}(n)},setSelection:function(t){!function(n,t,e,r,o){var i=ga(t,e,r,o);va(n,i)}(n,t.start(),t.soffset(),t.finish(),t.foffset())},setRelativeSelection:function(t,e){!function(n,t,e){var r=ma(t,e);va(n,r)}(n,t,e)},selectContents:function(t){!function(n,t){var e=function(n,t){var e=n.document.createRange();return function(n,t){n.selectNodeContents(t.dom())}(e,t),e}(n,t);pa(n,e)}(n,t)},getInnerHeight:function(){return n.innerHeight},getScrollY:function(){return Ia(on.fromDom(n.document)).top()},scrollBy:function(t,e){!function(n,t,e){(void 0!==e?e.dom():document).defaultView.scrollBy(n,t)}(t,e,on.fromDom(n.document))}}}var Ma=function(n,t,e,r,o){return zn.eq(e,r)?g.none():Ie(e,r,t).bind((function(t){var r=t.boxes().getOr([]);return r.length>0?(o(n,r,t.start(),t.finish()),g.some(Da.response(g.some(Ba(e,0,e,ue(e))),!0))):g.none()}))},qa=Ma,_a=K.immutableBag(["left","top","right","bottom"],[]),ja={nu:_a,moveUp:function(n,t){return _a({left:n.left(),top:n.top()-t,right:n.right(),bottom:n.bottom()-t})},moveDown:function(n,t){return _a({left:n.left(),top:n.top()+t,right:n.right(),bottom:n.bottom()+t})},moveBottomTo:function(n,t){var e=n.bottom()-n.top();return _a({left:n.left(),top:t-e,right:n.right(),bottom:t})},moveTopTo:function(n,t){var e=n.bottom()-n.top();return _a({left:n.left(),top:t,right:n.right(),bottom:t+e})},getTop:function(n){return n.top()},getBottom:function(n){return n.bottom()},translate:function(n,t,e){return _a({left:n.left()+t,top:n.top()+e,right:n.right()+t,bottom:n.bottom()+e})},toString:function(n){return"("+n.left()+", "+n.top()+") -> ("+n.right()+", "+n.bottom()+")"}},za=function(n){return ja.nu({left:n.left,top:n.top,right:n.right,bottom:n.bottom})},La=function(n,t){return g.some(n.getRect(t))},Ha=function(n,t,e){return rt.isElement(t)?La(n,t).map(za):rt.isText(t)?(r=n,o=t,i=e,i>=0&&i<ue(o)?r.getRangedRect(o,i,o,i+1):i>0?r.getRangedRect(o,i-1,o,i):g.none()).map(za):g.none();var r,o,i},Fa=function(n,t){return rt.isElement(t)?La(n,t).map(za):rt.isText(t)?n.getRangedRect(t,0,t,ue(t)).map(za):g.none()},Va=K.immutable("item","mode"),Ua=function(n,t,e,r){var o=void 0!==r?r:Ga;return n.property().parent(t).map((function(n){return Va(n,o)}))},Ga=function(n,t,e,r){var o=void 0!==r?r:Xa;return e.sibling(n,t).map((function(n){return Va(n,o)}))},Xa=function(n,t,e,r){var o=void 0!==r?r:Xa,i=n.property().children(t);return e.first(i).map((function(n){return Va(n,o)}))},Ya=[{current:Ua,next:Ga,fallback:g.none()},{current:Ga,next:Xa,fallback:g.some(Ua)},{current:Xa,next:Xa,fallback:g.some(Ga)}],Ka=function(n,t,e,r,o){return A(o=void 0!==o?o:Ya,(function(n){return n.current===e})).bind((function(e){return e.current(n,t,r,e.next).orThunk((function(){return e.fallback.bind((function(e){return Ka(n,t,e,r)}))}))}))},Ja={backtrack:Ua,sidestep:Ga,advance:Xa,go:Ka},$a={left:function(){return{sibling:function(n,t){return n.query().prevSibling(t)},first:function(n){return n.length>0?g.some(n[n.length-1]):g.none()}}},right:function(){return{sibling:function(n,t){return n.query().nextSibling(t)},first:function(n){return n.length>0?g.some(n[0]):g.none()}}}},Qa=function(n,t,e,r,o,i){return Ja.go(n,t,r,o).bind((function(t){return i(t.item())?g.none():e(t.item())?g.some(t.item()):Qa(n,t.item(),e,t.mode(),o,i)}))},Za=function(n,t){return 0===n.property().children(t).length},nc=function(n,t,e,r){return function(n,t,e,r){return Qa(n,t,e,Ja.sidestep,$a.left(),r)}(n,t,e,r)},tc=function(n,t,e,r){return function(n,t,e,r){return Qa(n,t,e,Ja.sidestep,$a.right(),r)}(n,t,e,r)},ec={before:function(n,t,e){return nc(n,t,c.curry(Za,n),e)},after:function(n,t,e){return tc(n,t,c.curry(Za,n),e)},seekLeft:nc,seekRight:tc,walkers:function(){return{left:$a.left,right:$a.right}},walk:function(n,t,e,r,o){return Ja.go(n,t,e,r,o)},backtrack:Ja.backtrack,sidestep:Ja.sidestep,advance:Ja.advance},rc=ve(),oc={gather:function(n,t,e){return ec.gather(rc,n,t,e)},before:function(n,t){return ec.before(rc,n,t)},after:function(n,t){return ec.after(rc,n,t)},seekLeft:function(n,t,e){return ec.seekLeft(rc,n,t,e)},seekRight:function(n,t,e){return ec.seekRight(rc,n,t,e)},walkers:function(){return ec.walkers()},walk:function(n,t,e,r){return ec.walk(rc,n,t,e,r)}},ic=ze([{none:[]},{retry:["caret"]}]),uc=function(n,t,e){return Ct.closest(t,Fr).fold(c.constant(!1),(function(t){return Fa(n,t).exists((function(n){return r=n,(t=e).left()<r.left()||Math.abs(r.right()-t.left())<1||t.left()>r.right();var t,r}))}))},ac={point:ja.getTop,adjuster:function(n,t,e,r,o){var i=ja.moveUp(o,5);return Math.abs(e.top()-r.top())<1||e.bottom()<o.top()?ic.retry(i):e.bottom()===o.top()?ic.retry(ja.moveUp(o,1)):uc(n,t,o)?ic.retry(ja.translate(i,5,0)):ic.none()},move:ja.moveUp,gather:oc.before},cc={point:ja.getBottom,adjuster:function(n,t,e,r,o){var i=ja.moveDown(o,5);return Math.abs(e.bottom()-r.bottom())<1||e.top()>o.bottom()?ic.retry(i):e.top()===o.bottom()?ic.retry(ja.moveDown(o,1)):uc(n,t,o)?ic.retry(ja.translate(i,5,0)):ic.none()},move:ja.moveDown,gather:oc.after},lc=function(n,t,e,r,o){return 0===o?g.some(r):(c=n,l=r.left(),s=t.point(r),c.elementFromPoint(l,s).filter((function(n){return"table"===rt.name(n)})).isSome()?(u=r,a=o-1,lc(n,i=t,e,i.move(u,5),a)):n.situsFromPoint(r.left(),t.point(r)).bind((function(i){return i.start().fold(g.none,(function(i,u){return Fa(n,i).bind((function(u){return t.adjuster(n,i,u,e,r).fold(g.none,(function(r){return lc(n,t,e,r,o-1)}))})).orThunk((function(){return g.some(r)}))}),g.none)})));var i,u,a,c,l,s},sc=function(n,t,e){var r,o,i,u=n.move(e,5),a=lc(t,n,e,u,100).getOr(u);return(r=n,o=a,i=t,r.point(o)>i.getInnerHeight()?g.some(r.point(o)-i.getInnerHeight()):r.point(o)<0?g.some(-r.point(o)):g.none()).fold((function(){return t.situsFromPoint(a.left(),n.point(a))}),(function(e){return t.scrollBy(0,e),t.situsFromPoint(a.left(),n.point(a)-e)}))},fc={tryUp:c.curry(sc,ac),tryDown:c.curry(sc,cc),ieTryUp:function(n,t){return n.situsFromPoint(t.left(),t.top()-5)},ieTryDown:function(n,t){return n.situsFromPoint(t.left(),t.bottom()+5)},getJumpSize:c.constant(5)},dc=ze([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),mc=function(n){return Tt.closest(n,"tr")},gc={verify:function(n,t,e,r,o,i,u){return Tt.closest(r,"td,th",u).bind((function(e){return Tt.closest(t,"td,th",u).map((function(t){return zn.eq(e,t)?zn.eq(r,e)&&ue(e)===o?i(t):dc.none("in same cell"):ye(mc,[e,t]).fold((function(){return o=t,u=e,a=(r=n).getRect(o),(c=r.getRect(u)).right>a.left&&c.left<a.right?dc.success():i(t);var r,o,u,a,c}),(function(n){return i(t)}))}))})).getOr(dc.none("default"))},cata:function(n,t,e,r,o){return n.fold(t,e,r,o)},adt:dc},pc={point:K.immutable("element","offset"),delta:K.immutable("element","deltaOffset"),range:K.immutable("element","start","finish"),points:K.immutable("begin","end"),text:K.immutable("element","text")},hc=(K.immutable("ancestor","descendants","element","index"),K.immutable("parent","children","element","index")),vc=function(n){return"br"===rt.name(n)},bc=function(n,t,e){return t(n,e).bind((function(n){return rt.isText(n)&&0===oe.get(n).trim().length?bc(n,t,e):g.some(n)}))},wc=function(n,t,e,r){var o,i,u;return(vc(t)?(o=n,i=t,(u=r).traverse(i).orThunk((function(){return bc(i,u.gather,o)})).map(u.relative)):function(n,t,e,r){return(o=t,i=e,Yn.child(o,i).filter(vc).orThunk((function(){return Yn.child(o,i-1).filter(vc)}))).bind((function(t){return r.traverse(t).fold((function(){return bc(t,r.gather,n).map(r.relative)}),(function(n){return function(n){return Yn.parent(n).bind((function(t){var e=Yn.children(t);return function(n,t){return O(n,c.curry(zn.eq,t))}(e,n).map((function(r){return hc(t,e,n,r)}))}))}(n).map((function(n){return Hu.on(n.parent(),n.index())}))}))}));var o,i}(n,t,e,r)).map((function(n){return{start:c.constant(n),finish:c.constant(n)}}))},yc=qn.detect(),xc=function(n,t,e,r,o,i){return 0===i?g.none():Sc(n,t,e,r,o).bind((function(u){var a=n.fromSitus(u),c=gc.verify(n,e,r,a.finish(),a.foffset(),o.failure,t);return gc.cata(c,(function(){return g.none()}),(function(){return g.some(u)}),(function(u){return zn.eq(e,u)&&0===r?Rc(n,e,r,ja.moveUp,o):xc(n,t,u,0,o,i-1)}),(function(u){return zn.eq(e,u)&&r===ue(u)?Rc(n,e,r,ja.moveDown,o):xc(n,t,u,ue(u),o,i-1)}))}))},Rc=function(n,t,e,r,o){return Ha(n,t,e).bind((function(t){return Cc(n,o,r(t,fc.getJumpSize()))}))},Cc=function(n,t,e){return yc.browser.isChrome()||yc.browser.isSafari()||yc.browser.isFirefox()||yc.browser.isEdge()?t.otherRetry(n,e):yc.browser.isIE()?t.ieRetry(n,e):g.none()},Sc=function(n,t,e,r,o){return Ha(n,e,r).bind((function(t){return Cc(n,o,t)}))},Tc=qn.detect(),Dc=function(n,t,e,r,o){return Tt.closest(r,"td,th",t).bind((function(r){return Tt.closest(r,"table",t).bind((function(i){return u=i,function(n,t,e){return Ct.ancestor(n,(function(n){return Yn.parent(n).exists((function(n){return zn.eq(n,u)}))}),void 0).isSome()}(o)?function(n,t,e){return(r=n,o=t,i=e,r.getSelection().bind((function(n){return wc(o,n.finish(),n.foffset(),i).fold((function(){return g.some(pc.point(n.finish(),n.foffset()))}),(function(t){var e=r.fromSitus(t);return function(n){return gc.cata(n,(function(n){return g.none()}),(function(){return g.none()}),(function(n){return g.some(pc.point(n,0))}),(function(n){return g.some(pc.point(n,ue(n)))}))}(gc.verify(r,n.finish(),n.foffset(),e.finish(),e.foffset(),i.failure,o))}))}))).bind((function(r){return xc(n,t,r.element(),r.offset(),e,20).map(n.fromSitus)}));var r,o,i}(n,t,e).bind((function(n){return Tt.closest(n.finish(),"td,th",t).map((function(t){return{start:c.constant(r),finish:c.constant(t),range:c.constant(n)}}))})):g.none();var u}))}))},kc=function(n,t,e,r,o,i){return Tc.browser.isIE()?g.none():i(r,t).orThunk((function(){return Dc(n,t,e,r,o).map((function(n){var t=n.range();return Da.response(g.some(Ba(t.start(),t.soffset(),t.finish(),t.foffset())),!0)}))}))},Ac=function(n,t,e,r,o,i,u){return Dc(n,e,r,o,i).bind((function(n){return qa(t,e,n.start(),n.finish(),u)}))},Oc=function(n,t){return Tt.closest(n,"tr",t).bind((function(n){return Tt.closest(n,"table",t).bind((function(e){var r=gt.descendants(e,"tr");return zn.eq(n,r[0])?oc.seekLeft(e,(function(n){return le(n).isSome()}),t).map((function(n){var t=ue(n);return Da.response(g.some(Ba(n,t,n,t)),!0)})):g.none()}))}))},Nc=function(n,t){return Tt.closest(n,"tr",t).bind((function(n){return Tt.closest(n,"table",t).bind((function(e){var r=gt.descendants(e,"tr");return zn.eq(n,r[r.length-1])?oc.seekRight(e,(function(n){return ce(n).isSome()}),t).map((function(n){return Da.response(g.some(Ba(n,0,n,0)),!0)})):g.none()}))}))},Pc=function(n,t){return Tt.closest(n,"td,th",t)},Bc={down:{traverse:Yn.nextSibling,gather:oc.after,relative:Hu.before,otherRetry:fc.tryDown,ieRetry:fc.ieTryDown,failure:gc.adt.failedDown},up:{traverse:Yn.prevSibling,gather:oc.before,relative:Hu.before,otherRetry:fc.tryUp,ieRetry:fc.ieTryUp,failure:gc.adt.failedUp}},Ec=K.immutable("rows","cols"),Ic=function(n,t,e,r){var o=Wa(n),i=function(){return r.clear(t),g.none()};return{keydown:function(n,u,a,l,s,f){var d=n.raw().which,m=!0===n.raw().shiftKey;return We(t,r.selectedSelector()).fold((function(){return Na.isDown(d)&&m?c.curry(Ac,o,t,e,Bc.down,l,u,r.selectRange):Na.isUp(d)&&m?c.curry(Ac,o,t,e,Bc.up,l,u,r.selectRange):Na.isDown(d)?c.curry(kc,o,e,Bc.down,l,u,Nc):Na.isUp(d)?c.curry(kc,o,e,Bc.up,l,u,Oc):g.none}),(function(n){var e=function(e){return function(){return $r(e,(function(e){return function(n,t,e,r,o){return Me(r,n,t,o.firstSelectedSelector(),o.lastSelectedSelector()).map((function(n){return o.clear(e),o.selectRange(e,n.boxes(),n.start(),n.finish()),n.boxes()}))}(e.rows(),e.cols(),t,n,r)})).fold((function(){return qe(t,r.firstSelectedSelector(),r.lastSelectedSelector()).map((function(n){var e=Na.isDown(d)||f.isForward(d)?Hu.after:Hu.before;return o.setRelativeSelection(Hu.on(n.first(),0),e(n.table())),r.clear(t),Da.response(g.none(),!0)}))}),(function(n){return g.some(Da.response(g.none(),!0))}))}};return Na.isDown(d)&&m?e([Ec(1,0)]):Na.isUp(d)&&m?e([Ec(-1,0)]):f.isBackward(d)&&m?e([Ec(0,-1),Ec(-1,0)]):f.isForward(d)&&m?e([Ec(0,1),Ec(1,0)]):Na.isNavigation(d)&&!1===m?i:g.none}))()},keyup:function(n,o,i,u,a){return We(t,r.selectedSelector()).fold((function(){var c=n.raw().which;return 0==(!0===n.raw().shiftKey)?g.none():Na.isNavigation(c)?function(n,t,e,r,o,i,u){return zn.eq(e,o)&&r===i?g.none():Tt.closest(e,"td,th",t).bind((function(e){return Tt.closest(o,"td,th",t).bind((function(r){return Ma(n,t,e,r,u)}))}))}(t,e,o,i,u,a,r.selectRange):g.none()}),g.none)}}},Wc=tu.each;u.add("table",(function(n){var t,e,r,o,i,u,a=function(n){var t,e,r=g.none(),o=g.none(),i=g.none(),u=/(\d+(\.\d+)?)%/,a=function(n){return"TABLE"===n.nodeName};return n.on("init",(function(){var t=Or(zi),e=Mu(n);if(i=g.some(e),function(n){var t=n.getParam("object_resizing",!0);return"table"===t||t}(n)&&function(n){return n.getParam("table_resize_bars",!0,"boolean")}(n)){var u=Wu(e,t);u.on(),u.events.startDrag.bind((function(t){r=g.some(n.selection.getRng())})),u.events.afterResize.bind((function(t){var e=t.table(),o=gt.descendants(e,"td[data-mce-style],th[data-mce-style]");S(o,(function(n){ct.remove(n,"data-mce-style")})),r.each((function(t){n.selection.setRng(t),n.focus()})),n.undoManager.add()})),o=g.some(u)}})),n.on("ObjectResizeStart",(function(r){var o;a(r.target)&&(t=r.width,o=r.target,e=n.dom.getStyle(o,"width")||n.dom.getAttrib(o,"width"))})),n.on("ObjectResized",(function(r){if(a(r.target)){var o=r.target;if(u.test(e)){var i=parseFloat(u.exec(e)[1]),c=r.width*i/t;n.dom.setStyle(o,"width",c+"%")}else{var l=[];tu.each(o.rows,(function(t){tu.each(t.cells,(function(t){var e=n.dom.getStyle(t,"width",!0);l.push({cell:t,width:e})}))})),tu.each(l,(function(t){n.dom.setStyle(t.cell,"width",t.width),n.dom.setAttrib(t.cell,"width",null)}))}}})),{lazyResize:function(){return o},lazyWire:function(){return i.getOr(Cu(on.fromDom(n.getBody())))},destroy:function(){o.each((function(n){n.destroy()})),i.each((function(t){!function(n,t){n.inline&&Jt.remove(t.parent())}(n,t)}))}}}(n),l=function(n,t){var e=K.immutableBag(["mousedown","mouseover","mouseup","keyup","keydown"],[]),r=g.none(),o=function(n){var t=function(t){ct.remove(t,n.selected()),ct.remove(t,n.firstSelected()),ct.remove(t,n.lastSelected())},e=function(t){ct.set(t,n.selected(),"1")},r=function(e){var r=gt.descendants(e,n.selectedSelector());S(r,t)};return{clear:r,selectRange:function(t,o,i,u){r(t),S(o,e),ct.set(i,n.firstSelected(),"1"),ct.set(u,n.lastSelected(),"1")},selectedSelector:n.selectedSelector,firstSelectedSelector:n.firstSelectedSelector,lastSelectedSelector:n.lastSelectedSelector}}(je);return n.on("init",(function(i){var u=n.getWin(),a=Ii(n),l=Wi(n),s=function(n,t,e,r){var o,i,u,a,c,l,s=Wa(n),f=(o=s,i=t,u=e,a=r,c=g.none(),l=function(){c=g.none()},{mousedown:function(n){a.clear(i),c=Pc(n.target(),u)},mouseover:function(n){c.each((function(t){a.clear(i),Pc(n.target(),u).each((function(n){Ie(t,n,u).each((function(e){var r=e.boxes().getOr([]);(r.length>1||1===r.length&&!zn.eq(t,n))&&(a.selectRange(i,r,e.start(),e.finish()),o.selectContents(n))}))}))}))},mouseup:function(){c.each(l)}});return{mousedown:f.mousedown,mouseover:f.mouseover,mouseup:f.mouseup}}(u,a,l,o),f=Ic(u,a,l,o),d=function(t,e){!0===t.raw().shiftKey&&(e.kill()&&t.kill(),e.selection().each((function(t){var e=Uu.relative(t.start(),t.finish()),r=Zu(u,e);n.selection.setRng(r)})))},m=function(t){var e=v(t);if(e.raw().shiftKey&&Na.isNavigation(e.raw().which)){var r=n.selection.getRng(),o=on.fromDom(r.startContainer),i=on.fromDom(r.endContainer);f.keyup(e,o,r.startOffset,i,r.endOffset).each((function(n){d(e,n)}))}},p=function(n){return!(ct.has(n,"data-mce-bogus")||"br"===rt.name(n)||rt.isText(n)&&0===oe.get(n).length)},h=function(e){var r,o,i,u=v(e);t().each((function(n){n.hideBars()})),40===e.which&&(r=on.fromDom(n.getBody()),o=Yn.lastChild(r),i=function(n){return Yn.prevSibling(n).bind((function(n){return p(n)?g.some(n):i(n)}))},o.bind((function(n){return p(n)?g.some(n):i(n)}))).each((function(t){"table"===rt.name(t)&&(Vi(n)?n.dom.add(n.getBody(),Vi(n),function(n){return n.getParam("forced_block_attrs",{},"object")}(n),"<br/>"):n.dom.add(n.getBody(),"br"))}));var a=n.selection.getRng(),c=on.fromDom(n.selection.getStart()),l=on.fromDom(a.startContainer),s=on.fromDom(a.endContainer),m=zi(c).isRtl()?Na.rtl:Na.ltr;f.keydown(u,l,a.startOffset,s,a.endOffset,m).each((function(n){d(u,n)})),t().each((function(n){n.showBars()}))},v=function(n){var t=on.fromDom(n.target),e=function(){n.stopPropagation()},r=function(){n.preventDefault()},o=c.compose(r,e);return{target:c.constant(t),x:c.constant(n.x),y:c.constant(n.y),stop:e,prevent:r,kill:o,raw:c.constant(n)}},b=function(n){return 0===n.button},w=function(n){b(n)&&s.mousedown(v(n))},y=function(n){var t;(void 0===(t=n).buttons||0!=(1&t.buttons))&&s.mouseover(v(n))},x=function(n){b&&s.mouseup(v(n))};n.on("mousedown",w),n.on("mouseover",y),n.on("mouseup",x),n.on("keyup",m),n.on("keydown",h),n.on("nodechange",(function(){var t=n.selection,e=on.fromDom(t.getStart()),r=on.fromDom(t.getEnd()),i=Ot(e),u=Ot(r);i.bind((function(n){return u.bind((function(t){return zn.eq(n,t)?g.some(!0):g.none()}))})).fold((function(){o.clear(a)}),c.noop)})),r=g.some(e({mousedown:w,mouseover:y,mouseup:x,keyup:m,keydown:h}))})),{clear:o.clear,destroy:function(){r.each((function(n){}))}}}(n,a.lazyResize),s=(t=n,e=a.lazyWire,r=function(n){return"table"===rt.name(Ii(n))},o=function(n){var t=n.getParam("table_clone_elements");return F.isString(t)?g.some(t.split(/[ ,]/)):Array.isArray(t)?g.some(t):g.none()}(t),{deleteRow:(i=function(n,e,r,i){return function(u,a){var c=gt.descendants(u,"td[data-mce-style],th[data-mce-style]");S(c,(function(n){ct.remove(n,"data-mce-style")}));var l=i(),s=on.fromDom(t.getDoc()),f=Or(zi),d=ge(r,s,o);return e(u)?n(l,u,a,d,f).bind((function(n){return S(n.newRows(),(function(n){Zi(t,n.dom())})),S(n.newCells(),(function(n){nu(t,n.dom())})),n.cursor().map((function(n){var e=t.dom.createRng();return e.setStart(n.dom(),0),e.setEnd(n.dom(),0),e}))})):g.none()}})(Bi.eraseRows,(function(n){var e=Nr(n);return!1===r(t)||e.rows()>1}),c.noop,e),deleteColumn:i(Bi.eraseColumns,(function(n){var e=Nr(n);return!1===r(t)||e.columns()>1}),c.noop,e),insertRowsBefore:i(Bi.insertRowsBefore,c.always,c.noop,e),insertRowsAfter:i(Bi.insertRowsAfter,c.always,c.noop,e),insertColumnsBefore:i(Bi.insertColumnsBefore,c.always,dr,e),insertColumnsAfter:i(Bi.insertColumnsAfter,c.always,dr,e),mergeCells:i(Bi.mergeCells,c.always,c.noop,e),unmergeCells:i(Bi.unmergeCells,c.always,c.noop,e),pasteRowsBefore:i(Bi.pasteRowsBefore,c.always,c.noop,e),pasteRowsAfter:i(Bi.pasteRowsAfter,c.always,c.noop,e),pasteCells:i(Bi.pasteCells,c.always,c.noop,e)}),f=(u=n,{get:function(){return function(n,t){return We(n,t)}(Ii(u),je.selectedSelector()).fold((function(){return void 0===u.selection.getStart()?He.none():He.single(u.selection)}),(function(n){return He.multiple(n)}))}}),d=Pr(g.none());return Ru(n,s,l,f,d),function(n,t,e,r){n.on("BeforeGetContent",(function(e){!0===e.selection&&He.cata(t.get(),c.noop,(function(t){var r;e.preventDefault(),(r=t,Ot(r[0]).map(ee).map((function(n){return[Qt(n,je.attributeSelector())]}))).each((function(t){e.content=C(t,(function(t){return e=t,n.selection.serializer.serialize(e.dom(),{});var e})).join("")}))}),c.noop)})),n.on("BeforeSetContent",(function(t){!0===t.selection&&!0===t.paste&&g.from(n.dom.getParent(n.selection.getStart(),"th,td")).each((function(o){var i=on.fromDom(o);Ot(i).bind((function(o){var u=T(function(n,t){var e=document.createElement("div");return e.innerHTML=n,Yn.children(on.fromDom(e))}(t.content),(function(n){return"meta"!==rt.name(n)}));if(1===u.length&&"table"===rt.name(u[0])){t.preventDefault();var a=on.fromDom(n.getDoc()),c=pe(a),l=Ke.paste(i,u[0],c);e.pasteCells(o,l).each((function(t){n.selection.setRng(t),n.focus(),r.clear(o)}))}}))}))}))}(n,f,s,l),function(n,t){var e=g.none(),r=[],o=[],i=[],u=[],a=function(n){n.disabled(!0)},l=function(n){n.disabled(!1)},s=function(){var n=this;r.push(n),e.fold((function(){a(n)}),(function(t){l(n)}))},f=function(){var n=this;o.push(n),e.fold((function(){a(n)}),(function(t){l(n)}))};n.on("init",(function(){n.on("nodechange",(function(c){var s=g.from(n.dom.getParent(n.selection.getStart(),"th,td"));(e=s.bind((function(n){var e=on.fromDom(n);return Ot(e).map((function(n){return Ke.forMenu(t,n,e)}))}))).fold((function(){S(r,a),S(o,a),S(i,a),S(u,a)}),(function(n){S(r,l),S(o,l),S(i,(function(t){t.disabled(n.mergable().isNone())})),S(u,(function(t){t.disabled(n.unmergable().isNone())}))}))}))}));var d=function(n,t,e,r){var o,i,u,a,c,l=r.getEl().getElementsByTagName("table")[0],s=r.isRtl()||"tl-tr"===r.parent().rel;for(l.nextSibling.innerHTML=t+1+" x "+(e+1),s&&(t=9-t),i=0;i<10;i++)for(o=0;o<10;o++)a=l.rows[i].childNodes[o].firstChild,c=(s?o>=t:o<=t)&&i<=e,n.dom.toggleClass(a,"mce-active",c),c&&(u=a);return u.parentNode},m=!1===n.getParam("table_grid",!0,"boolean")?{text:"Table",icon:"table",context:"table",onclick:c.curry(yu,n)}:{text:"Table",icon:"table",context:"table",ariaHideMenu:!0,onclick:function(t){t.aria&&(this.parent().hideAll(),t.stopImmediatePropagation(),yu(n))},onshow:function(){d(n,0,0,this.menu.items()[0])},onhide:function(){var t=this.menu.items()[0].getEl().getElementsByTagName("a");n.dom.removeClass(t,"mce-active"),n.dom.addClass(t[0],"mce-active")},menu:[{type:"container",html:function(){var n="";n='<table role="grid" class="mce-grid mce-grid-border" aria-readonly="true">';for(var t=0;t<10;t++){n+="<tr>";for(var e=0;e<10;e++)n+='<td role="gridcell" tabindex="-1"><a id="mcegrid'+(10*t+e)+'" href="#" data-mce-x="'+e+'" data-mce-y="'+t+'"></a></td>';n+="</tr>"}return(n+="</table>")+'<div class="mce-text-center" role="presentation">1 x 1</div>'}(),onPostRender:function(){this.lastX=this.lastY=0},onmousemove:function(t){var e,r,o=t.target;"A"===o.tagName.toUpperCase()&&(e=parseInt(o.getAttribute("data-mce-x"),10),r=parseInt(o.getAttribute("data-mce-y"),10),(this.isRtl()||"tl-tr"===this.parent().rel)&&(e=9-e),e===this.lastX&&r===this.lastY||(d(n,e,r,t.control),this.lastX=e,this.lastY=r))},onclick:function(t){var e=this;"A"===t.target.tagName.toUpperCase()&&(t.preventDefault(),t.stopPropagation(),e.parent().cancel(),n.undoManager.transact((function(){vu(n,e.lastX+1,e.lastY+1)})),n.addVisual())}}]};function p(t){return function(){n.execCommand(t)}}var h={text:"Table properties",context:"table",onPostRender:s,onclick:c.curry(yu,n,!0)},v={text:"Delete table",context:"table",onPostRender:s,cmd:"mceTableDelete"},b={text:"Row",context:"table",menu:[{text:"Insert row before",onclick:p("mceTableInsertRowBefore"),onPostRender:f},{text:"Insert row after",onclick:p("mceTableInsertRowAfter"),onPostRender:f},{text:"Delete row",onclick:p("mceTableDeleteRow"),onPostRender:f},{text:"Row properties",onclick:p("mceTableRowProps"),onPostRender:f},{text:"-"},{text:"Cut row",onclick:p("mceTableCutRow"),onPostRender:f},{text:"Copy row",onclick:p("mceTableCopyRow"),onPostRender:f},{text:"Paste row before",onclick:p("mceTablePasteRowBefore"),onPostRender:f},{text:"Paste row after",onclick:p("mceTablePasteRowAfter"),onPostRender:f}]},w={text:"Column",context:"table",menu:[{text:"Insert column before",onclick:p("mceTableInsertColBefore"),onPostRender:f},{text:"Insert column after",onclick:p("mceTableInsertColAfter"),onPostRender:f},{text:"Delete column",onclick:p("mceTableDeleteCol"),onPostRender:f}]},y={separator:"before",text:"Cell",context:"table",menu:[{text:"Cell properties",onclick:p("mceTableCellProps"),onPostRender:f},{text:"Merge cells",onclick:p("mceTableMergeCells"),onPostRender:function(){var n=this;i.push(n),e.fold((function(){a(n)}),(function(t){n.disabled(t.mergable().isNone())}))}},{text:"Split cell",onclick:p("mceTableSplitCells"),onPostRender:function(){var n=this;u.push(n),e.fold((function(){a(n)}),(function(t){n.disabled(t.unmergable().isNone())}))}}]};n.addMenuItem("inserttable",m),n.addMenuItem("tableprops",h),n.addMenuItem("deletetable",v),n.addMenuItem("row",b),n.addMenuItem("column",w),n.addMenuItem("cell",y)}(n,f),function(n){var t=[];function e(t){return function(){n.execCommand(t)}}Wc("inserttable tableprops deletetable | cell row column".split(" "),(function(e){"|"===e?t.push({text:"-"}):t.push(n.menuItems[e])})),n.addButton("table",{type:"menubutton",title:"Table",menu:t}),n.addButton("tableprops",{title:"Table properties",onclick:c.curry(yu,n,!0),icon:"table"}),n.addButton("tabledelete",{title:"Delete table",onclick:e("mceTableDelete")}),n.addButton("tablecellprops",{title:"Cell properties",onclick:e("mceTableCellProps")}),n.addButton("tablemergecells",{title:"Merge cells",onclick:e("mceTableMergeCells")}),n.addButton("tablesplitcells",{title:"Split cell",onclick:e("mceTableSplitCells")}),n.addButton("tableinsertrowbefore",{title:"Insert row before",onclick:e("mceTableInsertRowBefore")}),n.addButton("tableinsertrowafter",{title:"Insert row after",onclick:e("mceTableInsertRowAfter")}),n.addButton("tabledeleterow",{title:"Delete row",onclick:e("mceTableDeleteRow")}),n.addButton("tablerowprops",{title:"Row properties",onclick:e("mceTableRowProps")}),n.addButton("tablecutrow",{title:"Cut row",onclick:e("mceTableCutRow")}),n.addButton("tablecopyrow",{title:"Copy row",onclick:e("mceTableCopyRow")}),n.addButton("tablepasterowbefore",{title:"Paste row before",onclick:e("mceTablePasteRowBefore")}),n.addButton("tablepasterowafter",{title:"Paste row after",onclick:e("mceTablePasteRowAfter")}),n.addButton("tableinsertcolbefore",{title:"Insert column before",onclick:e("mceTableInsertColBefore")}),n.addButton("tableinsertcolafter",{title:"Insert column after",onclick:e("mceTableInsertColAfter")}),n.addButton("tabledeletecol",{title:"Delete column",onclick:e("mceTableDeleteCol")})}(n),function(n){var t,e=""===(t=n.getParam("table_toolbar",Li))||!1===t?[]:F.isString(t)?t.split(/[ ,]/):F.isArray(t)?t:[];e.length>0&&n.addContextToolbar((function(t){return n.dom.is(t,"table")&&n.getBody().contains(t)}),e.join(" "))}(n),n.on("PreInit",(function(){n.serializer.addTempAttr(je.firstSelected()),n.serializer.addTempAttr(je.lastSelected())})),function(n){return n.getParam("table_tab_navigation",!0,"boolean")}(n)&&n.on("keydown",(function(t){!function(n,t,e,r){if(n.keyCode===ya.TAB){var o=Ii(t),i=function(n){var t=rt.name(n);return zn.eq(n,o)||I(Ta,t)},u=t.selection.getRng();if(u.collapsed){var a=on.fromDom(u.startContainer);kt(a,i).each((function(o){n.preventDefault(),(n.shiftKey?Ra:xa)(t,i,o,e,r).each((function(n){t.selection.setRng(n)}))}))}}}(t,n,s,a.lazyWire)})),n.on("remove",(function(){a.destroy(),l.destroy()})),function(n,t){return{insertTable:function(t,e){return vu(n,t,e)},setClipboardRows:function(n){return e=t,r=C(n,on.fromDom),void e.set(g.from(r));var e,r},getClipboardRows:function(){return t.get().fold((function(){}),(function(n){return C(n,(function(n){return n.dom()}))}))}}}(n,d)}))}();