!function(){"use strict";var n,t,e,r,o,i,u,a=function(n){return function(){return n}},c={noop:function(){},noarg:function(n){return function(){return n()}},compose:function(n,t){return function(){return n(t.apply(null,arguments))}},constant:a,identity:function(n){return n},tripleEquals:function(n,t){return n===t},curry:function(n){for(var t=new Array(arguments.length-1),e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var o=t.concat(e);return n.apply(null,o)}},not:function(n){return function(){return!n.apply(null,arguments)}},die:function(n){return function(){throw new Error(n)}},apply:function(n){return n()},call:function(n){n()},never:a(!1),always:a(!0)},s={contextmenu:c.constant("contextmenu"),touchstart:c.constant("touchstart"),touchmove:c.constant("touchmove"),touchend:c.constant("touchend"),gesturestart:c.constant("gesturestart"),mousedown:c.constant("mousedown"),mousemove:c.constant("mousemove"),mouseout:c.constant("mouseout"),mouseup:c.constant("mouseup"),mouseover:c.constant("mouseover"),focusin:c.constant("focusin"),keydown:c.constant("keydown"),input:c.constant("input"),change:c.constant("change"),focus:c.constant("focus"),click:c.constant("click"),transitionend:c.constant("transitionend"),selectstart:c.constant("selectstart")},f=function(n){var t,e=!1;return function(){return e||(e=!0,t=n.apply(null,arguments)),t}},l=function(){return d(0,0)},d=function(n,t){return{major:n,minor:t}},m=function(n,t){var e=String(t).toLowerCase();return 0===n.length?l():function(n,t){var e=function(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(r.test(t))return r}}(n,t);if(!e)return{major:0,minor:0};var r=function(n){return Number(t.replace(e,"$"+n))};return d(r(1),r(2))}(n,e)},g=l,p="Edge",v="Chrome",h="Opera",y="Firefox",b="Safari",S=function(n,t){return function(){return t===n}},x=function(n){var t=n.current;return{current:t,version:n.version,isEdge:S(p,t),isChrome:S(v,t),isIE:S("IE",t),isOpera:S(h,t),isFirefox:S(y,t),isSafari:S(b,t)}},w={unknown:function(){return x({current:void 0,version:g()})},nu:x,edge:c.constant(p),chrome:c.constant(v),ie:c.constant("IE"),opera:c.constant(h),firefox:c.constant(y),safari:c.constant(b)},O="Windows",T="Android",k="Linux",C="Solaris",E="FreeBSD",A=function(n,t){return function(){return t===n}},M=function(n){var t=n.current;return{current:t,version:n.version,isWindows:A(O,t),isiOS:A("iOS",t),isAndroid:A(T,t),isOSX:A("OSX",t),isLinux:A(k,t),isSolaris:A(C,t),isFreeBSD:A(E,t)}},D=function(){return M({current:void 0,version:g()})},R=M,B=(c.constant(O),c.constant("iOS"),c.constant(T),c.constant(k),c.constant("OSX"),c.constant(C),c.constant(E),c.never),F=c.always,I=function(){return H},H=(r={fold:function(n,t){return n()},is:B,isSome:B,isNone:F,getOr:e=function(n){return n},getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},or:e,orThunk:t,map:I,ap:I,each:function(){},bind:I,flatten:I,exists:B,forall:F,filter:I,equals:n=function(n){return n.isNone()},equals_:n,toArray:function(){return[]},toString:c.constant("none()")},Object.freeze&&Object.freeze(r),r),V=function(n){var t=function(){return n},e=function(){return o},r=function(t){return t(n)},o={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:F,isNone:B,getOr:t,getOrThunk:t,getOrDie:t,or:e,orThunk:e,map:function(t){return V(t(n))},ap:function(t){return t.fold(I,(function(t){return V(t(n))}))},each:function(t){t(n)},bind:r,flatten:t,exists:r,forall:r,filter:function(t){return t(n)?o:H},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(B,(function(t){return e(n,t)}))},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},N={some:V,none:I,from:function(n){return null==n?H:V(n)}},j=void 0===(o=Array.prototype.indexOf)?function(n,t){return $(n,t)}:function(n,t){return o.call(n,t)},P=function(n,t){return j(n,t)>-1},L=function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o,n)}return r},W=function(n,t){for(var e=0,r=n.length;e<r;e++)t(n[e],e,n)},z=function(n,t){for(var e=[],r=0,o=n.length;r<o;r++){var i=n[r];t(i,r,n)&&e.push(i)}return e},G=function(n,t){for(var e=0,r=n.length;e<r;e++)if(t(n[e],e,n))return N.some(e);return N.none()},$=function(n,t){for(var e=0,r=n.length;e<r;++e)if(n[e]===t)return e;return-1},U=Array.prototype.push,_=function(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!Array.prototype.isPrototypeOf(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);U.apply(t,n[e])}return t},q=Array.prototype.slice,K=L,X=W,Y=z,J=function(n,t,e){return function(n,t){for(var e=n.length-1;e>=0;e--)t(n[e],e,n)}(n,(function(n){e=t(e,n)})),e},Q=function(n,t,e){return W(n,(function(n){e=t(e,n)})),e},Z=function(n,t){for(var e=0,r=n.length;e<r;e++){var o=n[e];if(t(o,e,n))return N.some(o)}return N.none()},nn=G,tn=_,en=function(n,t){var e=L(n,t);return _(e)},rn=function(n,t){for(var e=0,r=n.length;e<r;++e)if(!0!==t(n[e],e,n))return!1;return!0},on=P,un=function(n){var t=q.call(n,0);return t.reverse(),t},an=function(n){return[n]},cn=function(n,t){var e=String(t).toLowerCase();return Z(n,(function(n){return n.search(e)}))},sn=function(n,t){return-1!==n.indexOf(t)},fn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,ln=function(n){return function(t){return sn(t,n)}},dn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return sn(n,"edge/")&&sn(n,"chrome")&&sn(n,"safari")&&sn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,fn],search:function(n){return sn(n,"chrome")&&!sn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return sn(n,"msie")||sn(n,"trident")}},{name:"Opera",versionRegexes:[fn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:ln("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:ln("firefox")},{name:"Safari",versionRegexes:[fn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(sn(n,"safari")||sn(n,"mobile/"))&&sn(n,"applewebkit")}}],mn=[{name:"Windows",search:ln("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return sn(n,"iphone")||sn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:ln("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:ln("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:ln("linux"),versionRegexes:[]},{name:"Solaris",search:ln("sunos"),versionRegexes:[]},{name:"FreeBSD",search:ln("freebsd"),versionRegexes:[]}],gn={browsers:c.constant(dn),oses:c.constant(mn)},pn=function(n){var t,e,r,o,i,u,a,s,f,l,d,g=gn.browsers(),p=gn.oses(),v=function(n,t){return cn(n,t).map((function(n){var e=m(n.versionRegexes,t);return{current:n.name,version:e}}))}(g,n).fold(w.unknown,w.nu),h=function(n,t){return cn(n,t).map((function(n){var e=m(n.versionRegexes,t);return{current:n.name,version:e}}))}(p,n).fold(D,R);return{browser:v,os:h,deviceType:(e=v,r=n,o=(t=h).isiOS()&&!0===/ipad/i.test(r),i=t.isiOS()&&!o,u=t.isAndroid()&&3===t.version.major,a=t.isAndroid()&&4===t.version.major,s=o||u||a&&!0===/mobile/i.test(r),f=t.isiOS()||t.isAndroid(),l=f&&!s,d=e.isSafari()&&t.isiOS()&&!1===/safari/i.test(r),{isiPad:c.constant(o),isiPhone:c.constant(i),isTablet:c.constant(s),isPhone:c.constant(l),isTouch:c.constant(f),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:c.constant(d)})}},vn={detect:f((function(){var n=navigator.userAgent;return pn(n)}))},hn={tap:c.constant("alloy.tap")},yn={focus:c.constant("alloy.focus"),postBlur:c.constant("alloy.blur.post"),receive:c.constant("alloy.receive"),execute:c.constant("alloy.execute"),focusItem:c.constant("alloy.focus.item"),tap:hn.tap,tapOrClick:vn.detect().deviceType.isTouch()?hn.tap:s.click,longpress:c.constant("alloy.longpress"),sandboxClose:c.constant("alloy.sandbox.close"),systemInit:c.constant("alloy.system.init"),windowScroll:c.constant("alloy.system.scroll"),attachedToDom:c.constant("alloy.system.attached"),detachedFromDom:c.constant("alloy.system.detached"),changeTab:c.constant("alloy.change.tab"),dismissTab:c.constant("alloy.dismiss.tab")},bn=function(n){return function(t){return function(n){if(null===n)return"null";var t=typeof n;return"object"===t&&Array.prototype.isPrototypeOf(n)?"array":"object"===t&&String.prototype.isPrototypeOf(n)?"string":t}(t)===n}},Sn={isString:bn("string"),isObject:bn("object"),isArray:bn("array"),isNull:bn("null"),isBoolean:bn("boolean"),isUndefined:bn("undefined"),isFunction:bn("function"),isNumber:bn("number")},xn=function(n){return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];if(0===t.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<t.length;o++){var i=t[o];for(var u in i)i.hasOwnProperty(u)&&(r[u]=n(r[u],i[u]))}return r}},wn=xn((function(n,t){return Sn.isObject(n)&&Sn.isObject(t)?wn(n,t):t})),On=xn((function(n,t){return t})),Tn={deepMerge:wn,merge:On},kn=void 0===(i=Object.keys)?function(n){var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t}:i,Cn=function(n,t){for(var e=kn(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i,n)}},En=function(n,t){var e={};return Cn(n,(function(r,o){var i=t(r,o,n);e[i.k]=i.v})),e},An=function(n,t){var e=[];return Cn(n,(function(n,r){e.push(t(n,r))})),e},Mn=function(n){return An(n,(function(n){return n}))},Dn={bifilter:function(n,t){var e={},r={};return Cn(n,(function(n,o){(t(n,o)?e:r)[o]=n})),{t:e,f:r}},each:Cn,map:function(n,t){return En(n,(function(n,e,r){return{k:e,v:t(n,e,r)}}))},mapToArray:An,tupleMap:En,find:function(n,t){for(var e=kn(n),r=0,o=e.length;r<o;r++){var i=e[r],u=n[i];if(t(u,i,n))return N.some(u)}return N.none()},keys:kn,values:Mn,size:function(n){return Mn(n).length}},Rn=function(n,t){Bn(n,n.element(),t,{})},Bn=function(n,t,e,r){var o=Tn.deepMerge({target:t},r);n.getSystem().triggerEvent(e,t,Dn.map(o,c.constant))},Fn=Rn,In=function(n,t,e){Bn(n,n.element(),t,e)},Hn=function(n){Rn(n,yn.execute())},Vn=function(n,t,e){Bn(n,t,e,{})},Nn=function(n){return n.slice(0).sort()},jn=function(n,t){throw new Error("All required keys ("+Nn(n).join(", ")+") were not specified. Specified keys were: "+Nn(t).join(", ")+".")},Pn=function(n){throw new Error("Unsupported keys for object: "+Nn(n).join(", "))},Ln=function(n,t){if(!Sn.isArray(t))throw new Error("The "+n+" fields must be an array. Was: "+t+".");X(t,(function(t){if(!Sn.isString(t))throw new Error("The value "+t+" in the "+n+" fields was not a string.")}))},Wn=function(n){var t=Nn(n);Z(t,(function(n,e){return e<t.length-1&&n===t[e+1]})).each((function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+t.join(", ")+"].")}))},zn=function(){var n=arguments;return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];if(n.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+t.length+" arguments");var r={};return X(n,(function(n,e){r[n]=c.constant(t[e])})),r}},Gn=function(n,t){var e=n.concat(t);if(0===e.length)throw new Error("You must specify at least one required or optional field.");return Ln("required",n),Ln("optional",t),Wn(e),function(r){var o=Dn.keys(r);rn(n,(function(n){return on(o,n)}))||jn(n,o);var i=Y(o,(function(n){return!on(e,n)}));i.length>0&&Pn(i);var u={};return X(n,(function(n){u[n]=c.constant(r[n])})),X(t,(function(n){u[n]=c.constant(Object.prototype.hasOwnProperty.call(r,n)?N.some(r[n]):N.none())})),u}},$n="undefined"!=typeof window?window:Function("return this;")(),Un=function(n,t){var e=function(n,t){return function(n,t){for(var e=null!=t?t:$n,r=0;r<n.length&&null!=e;++r)e=e[n[r]];return e}(n.split("."),t)}(n,t);if(null==e)throw n+" not available on this browser";return e},_n=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:c.constant(n)}},qn=function(n,t){var e=(t||document).createElement(n);return _n(e)},Kn=_n,Xn=function(n){return 1!==n.nodeType&&9!==n.nodeType||0===n.childElementCount},Yn=function(n,t){var e=void 0===t?document:t.dom();return Xn(e)?[]:K(e.querySelectorAll(n),Kn)},Jn=function(n,t){var e=n.dom();if(1!==e.nodeType)return!1;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},Qn=function(n,t){var e=void 0===t?document:t.dom();return Xn(e)?N.none():N.from(e.querySelector(n)).map(Kn)},Zn=(vn.detect().browser.isIE(),function(n,t){return n.dom()===t.dom()}),nt=function(n){var t=n.dom();return N.from(t.parentNode).map(Kn)},tt=function(n){var t=n.dom();return K(t.childNodes,Kn)},et=(zn("element","offset"),function(n){return Kn(n.dom().ownerDocument)}),rt=function(n){var t=n.dom().ownerDocument.defaultView;return Kn(t)},ot=nt,it=function(n){var t=n.dom();return N.from(t.nextSibling).map(Kn)},ut=tt,at=function(n){return function(n,t){var e=n.dom().childNodes;return N.from(e[t]).map(Kn)}(n,0)},ct=function(n,t){n.dom().appendChild(t.dom())},st=function(n,t){it(n).fold((function(){ot(n).each((function(n){ct(n,t)}))}),(function(n){!function(n,t){ot(n).each((function(e){e.dom().insertBefore(t.dom(),n.dom())}))}(n,t)}))},ft=function(n,t){at(n).fold((function(){ct(n,t)}),(function(e){n.dom().insertBefore(t.dom(),e.dom())}))},lt=ct,dt=function(n,t){X(t,(function(t){lt(n,t)}))},mt=function(n){var t=n.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},gt=function(n){n.dom().textContent="",X(ut(n),(function(n){mt(n)}))},pt=mt,vt=function(n){return n.dom().nodeName.toLowerCase()},ht=function(n){return n.dom().nodeType},yt=function(n){return function(t){return ht(t)===n}},bt=yt(1),St=yt(3),xt=yt(9),wt={name:vt,type:ht,value:function(n){return n.dom().nodeValue},isElement:bt,isText:St,isDocument:xt,isComment:function(n){return 8===ht(n)||"#comment"===vt(n)}},Ot=f((function(){return Tt(Kn(document))})),Tt=function(n){var t=n.dom().body;if(null==t)throw"Body is not available yet";return Kn(t)},kt={body:Ot,getBody:Tt,inBody:function(n){var t=wt.isText(n)?n.dom().parentNode:n.dom();return null!=t&&t.ownerDocument.body.contains(t)}},Ct=function(n){Fn(n,yn.detachedFromDom());var t=n.components();X(t,Ct)},Et=function(n){var t=n.components();X(t,Et),Fn(n,yn.attachedToDom())},At=function(n,t,e){n.getSystem().addToWorld(t),e(n.element(),t.element()),kt.inBody(n.element())&&Et(t),n.syncComponents()},Mt=function(n){Ct(n),pt(n.element()),n.getSystem().removeFromWorld(n)},Dt=function(n,t){At(n,t,lt)},Rt=At,Bt=function(n){var t=ot(n.element()).bind((function(t){return n.getSystem().getByDom(t).fold(N.none,N.some)}));Mt(n),t.each((function(n){n.syncComponents()}))},Ft=function(n){return n.dom().innerHTML},It=Ft,Ht=function(n,t,e){if(!(Sn.isString(e)||Sn.isBoolean(e)||Sn.isNumber(e)))throw console.error("Invalid call to Attr.set. Key ",t,":: Value ",e,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,e+"")},Vt=function(n,t,e){Ht(n.dom(),t,e)},Nt=function(n,t){var e=n.dom();Dn.each(t,(function(n,t){Ht(e,t,n)}))},jt=function(n,t){var e=n.dom().getAttribute(t);return null===e?void 0:e},Pt=function(n,t){var e=n.dom();return!(!e||!e.hasAttribute)&&e.hasAttribute(t)},Lt=function(n,t){n.dom().removeAttribute(t)},Wt=function(n){return function(n){var t=qn("div"),e=Kn(n.dom().cloneNode(!0));return lt(t,e),Ft(t)}(function(n){return function(n,t){return Kn(n.dom().cloneNode(!1))}(n)}(n))},zt=function(n){return Wt(n)},Gt=function(n){return{is:function(t){return n===t},isValue:c.always,isError:c.never,getOr:c.constant(n),getOrThunk:c.constant(n),getOrDie:c.constant(n),or:function(t){return Gt(n)},orThunk:function(t){return Gt(n)},fold:function(t,e){return e(n)},map:function(t){return Gt(t(n))},each:function(t){t(n)},bind:function(t){return t(n)},exists:function(t){return t(n)},forall:function(t){return t(n)},toOption:function(){return N.some(n)}}},$t=function(n){return{is:c.never,isValue:c.never,isError:c.always,getOr:c.identity,getOrThunk:function(n){return n()},getOrDie:function(){return c.die(n)()},or:function(n){return n},orThunk:function(n){return n()},fold:function(t,e){return t(n)},map:function(t){return $t(n)},each:c.noop,bind:function(t){return $t(n)},exists:c.never,forall:c.always,toOption:N.none}},Ut={value:Gt,error:$t},_t=function(n){if(!Sn.isArray(n))throw new Error("cases must be an array");if(0===n.length)throw new Error("there must be at least one case");var t=[],e={};return X(n,(function(r,o){var i=Dn.keys(r);if(1!==i.length)throw new Error("one and only one name per case");var u=i[0],a=r[u];if(void 0!==e[u])throw new Error("duplicate key detected:"+u);if("cata"===u)throw new Error("cannot have a case named cata (sorry)");if(!Sn.isArray(a))throw new Error("case arguments must be an array");t.push(u),e[u]=function(){var e=arguments.length;if(e!==a.length)throw new Error("Wrong number of arguments to case "+u+". Expected "+a.length+" ("+a+"), got "+e);for(var r=new Array(e),i=0;i<r.length;i++)r[i]=arguments[i];return{fold:function(){if(arguments.length!==n.length)throw new Error("Wrong number of arguments to fold. Expected "+n.length+", got "+arguments.length);return arguments[o].apply(null,r)},match:function(n){var e=Dn.keys(n);if(t.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+e.join(","));if(!rn(t,(function(n){return on(e,n)})))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+t.join(", "));return n[u].apply(null,r)},log:function(n){console.log(n,{constructors:t,constructor:u,params:r})}}}})),e},qt=(_t([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){var t=[],e=[];return X(n,(function(n){n.fold((function(n){t.push(n)}),(function(n){e.push(n)}))})),{errors:t,values:e}}),Kt=function(n){return c.compose(Ut.error,tn)(n)},Xt=function(n,t){var e,r,o=qt(n);return o.errors.length>0?Kt(o.errors):(e=o.values,r=t,Ut.value(Tn.deepMerge.apply(void 0,[r].concat(e))))},Yt=function(n){return function(t){return t.hasOwnProperty(n)?N.from(t[n]):N.none()}},Jt=Yt,Qt=function(n,t){return Yt(t)(n)},Zt=function(n,t){var e={};return e[n]=t,e},ne=function(n,t){return function(n,t){var e={};return X(t,(function(t){void 0!==n[t]&&n.hasOwnProperty(t)&&(e[t]=n[t])})),e}(n,t)},te=function(n){return Jt(n)},ee=function(n,t){return function(n,t){return function(e){return Yt(n)(e).getOr(t)}}(n,t)},re=function(n,t){return Qt(n,t)},oe=function(n,t){return Zt(n,t)},ie=function(n){return function(n){var t={};return X(n,(function(n){t[n.key]=n.value})),t}(n)},ue=function(n,t){return function(n,t){return n.hasOwnProperty(t)&&void 0!==n[t]&&null!==n[t]}(n,t)},ae=function(n,t){return Xt(n,t)},ce=function(n){for(var t=[],e=function(n){t.push(n)},r=0;r<n.length;r++)n[r].each(e);return t},se=function(n,t){for(var e=0;e<n.length;e++){var r=t(n[e],e);if(r.isSome())return r}return N.none()},fe="unknown",le="__CHROME_INSPECTOR_CONNECTION_TO_ALLOY__",de=[],me=["alloy/data/Fields","alloy/debugging/Debugging"],ge={logEventCut:c.noop,logEventStopped:c.noop,logNoParent:c.noop,logEventNoHandlers:c.noop,logEventResponse:c.noop,write:c.noop},pe=(c.constant(ge),function(){var n=new Error;if(void 0!==n.stack){var t=n.stack.split("\n");return Z(t,(function(n){return n.indexOf("alloy")>0&&!function(n,t){return G(n,t).isSome()}(me,(function(t){return n.indexOf(t)>-1}))})).getOr(fe)}return fe}),ve=function(n,t,e){var r,o="*"===de||on(de,n)?(r=[],{logEventCut:function(n,t,e){r.push({outcome:"cut",target:t,purpose:e})},logEventStopped:function(n,t,e){r.push({outcome:"stopped",target:t,purpose:e})},logNoParent:function(n,t,e){r.push({outcome:"no-parent",target:t,purpose:e})},logEventNoHandlers:function(n,t){r.push({outcome:"no-handlers-left",target:t})},logEventResponse:function(n,t,e){r.push({outcome:"response",purpose:e,target:t})},write:function(){on(["mousemove","mouseover","mouseout",yn.systemInit()],n)||console.log(n,{event:n,target:t.dom(),sequence:K(r,(function(n){return on(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+zt(n.target)+")":n.outcome}))})}}):ge,i=e(o);return o.write(),i},he=(c.constant(!0),function(n,t){(void 0!==window[le]||(window[le]={systems:{},lookup:function(n){var t=window[le].systems,e=Dn.keys(t);return se(e,(function(e){return t[e].getByUid(n).toOption().map((function(n){return oe(zt(n.element()),(t=function(n){var e=n.spec();return{"(original.spec)":e,"(dom.ref)":n.element().dom(),"(element)":zt(n.element()),"(initComponents)":K(void 0!==e.components?e.components:[],t),"(components)":K(n.components(),t),"(bound.events)":Dn.mapToArray(n.events(),(function(n,t){return[t]})).join(", "),"(behaviours)":void 0!==e.behaviours?Dn.map(e.behaviours,(function(t,e){return void 0===t?"--revoked--":{config:t.configAsRaw(),"original-config":t.initialConfig,state:n.readState(e)}})):"none"}})(n));var t}))}))}}),window[le]).systems[n]=t}),ye=_t([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),be={strict:ye.strict,asOption:ye.asOption,defaulted:function(n){return ye.defaultedThunk(c.constant(n))},defaultedThunk:ye.defaultedThunk,asDefaultedOption:function(n){return ye.asDefaultedOptionThunk(c.constant(n))},asDefaultedOptionThunk:ye.asDefaultedOptionThunk,mergeWith:function(n){return ye.mergeWithThunk(c.constant(n))},mergeWithThunk:ye.mergeWithThunk},Se={typeAdt:_t([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),fieldAdt:_t([{field:["name","presence","type"]},{state:["name"]}])},xe=function(n,t,e){return Un("JSON").stringify(n,t,e)},we=function(n){return Sn.isObject(n)&&Dn.keys(n).length>100?" removed due to size":xe(n,null,2)},Oe=function(n,t){return Ut.error([{path:n,getErrorInfo:t}])},Te=_t([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),ke=function(n,t,e){var r=Qt(n,t).fold((function(){return e(n)}),c.identity);return Ut.value(r)},Ce=function(n,t,e,r){return e.fold((function(e,o,i,u){var a=function(t){return u.extract(n.concat([e]),r,t).map((function(n){return Zt(o,r(n))}))},s=function(t){return t.fold((function(){var n=Zt(o,r(N.none()));return Ut.value(n)}),(function(t){return u.extract(n.concat([e]),r,t).map((function(n){return Zt(o,r(N.some(n)))}))}))};return i.fold((function(){return(r=n,o=t,i=e,Qt(o,i).fold((function(){return function(n,t,e){return Oe(n,(function(){return'Could not find valid *strict* value for "'+t+'" in '+we(e)}))}(r,i,o)}),Ut.value)).bind(a);var r,o,i}),(function(n){return ke(t,e,n).bind(a)}),(function(){return(n=t,r=e,Ut.value(Qt(n,r))).bind(s);var n,r}),(function(n){return(r=t,o=e,i=n,u=Qt(r,o).map((function(n){return!0===n?i(r):n})),Ut.value(u)).bind(s);var r,o,i,u}),(function(n){var r=n(t);return ke(t,e,c.constant({})).map((function(n){return Tn.deepMerge(r,n)})).bind(a)}))}),(function(n,e){var o=e(t);return Ut.value(Zt(n,r(o)))}))},Ee=function(n){return{extract:function(t,e,r){return n(r,e).fold((function(n){return function(n,t){return Oe(n,(function(){return t}))}(t,n)}),Ut.value)},toString:function(){return"val"},toDsl:function(){return Se.typeAdt.itemOf(n)}}},Ae=function(n){return{extract:function(t,e,r){return o=t,i=r,u=e,a=K(n,(function(n){return Ce(o,i,n,u)})),Xt(a,{});var o,i,u,a},toString:function(){return"obj{\n"+K(n,(function(n){return n.fold((function(n,t,e,r){return n+" -> "+r.toString()}),(function(n,t){return"state("+n+")"}))})).join("\n")+"}"},toDsl:function(){return Se.typeAdt.objOf(K(n,(function(n){return n.fold((function(n,t,e,r){return Se.fieldAdt.field(n,e,r)}),(function(n,t){return Se.fieldAdt.state(n)}))})))}}},Me=function(n){return{extract:function(t,e,r){return function(n){var t=qt(n);return t.errors.length>0?Kt(t.errors):Ut.value(t.values)}(K(r,(function(r,o){return n.extract(t.concat(["["+o+"]"]),e,r)})))},toString:function(){return"array("+n.toString()+")"},toDsl:function(){return Se.typeAdt.arrOf(n)}}},De=Ee(Ut.value),Re=c.compose(Me,Ae),Be={anyValue:c.constant(De),value:Ee,obj:Ae,objOnly:function(n){var t=Ae(n),e=J(n,(function(n,t){return t.fold((function(t){return Tn.deepMerge(n,oe(t,!0))}),c.constant(n))}),{});return{extract:function(n,r,o){var i,u,a=Sn.isBoolean(o)?[]:(i=o,u=Dn.keys(i),Y(u,(function(n){return ue(i,n)}))),c=Y(a,(function(n){return!ue(e,n)}));return 0===c.length?t.extract(n,r,o):function(n,t){return Oe(n,(function(){return"There are unsupported fields: ["+t.join(", ")+"] specified"}))}(n,c)},toString:t.toString,toDsl:t.toDsl}},arr:Me,setOf:function(n,t){return{extract:function(e,r,o){var i,u,a=Dn.keys(o);return(i=e,u=a,Me(Ee(n)).extract(i,c.identity,u)).bind((function(n){var i=K(n,(function(n){return Te.field(n,n,be.strict(),t)}));return Ae(i).extract(e,r,o)}))},toString:function(){return"setOf("+t.toString()+")"},toDsl:function(){return Se.typeAdt.setOf(n,t)}}},arrOfObj:Re,state:Te.state,field:Te.field,output:function(n,t){return Te.state(n,c.constant(t))},snapshot:function(n){return Te.state(n,c.identity)},thunk:function(n,t){var e=f((function(){return t()}));return{extract:function(n,t,r){return e().extract(n,t,r)},toString:function(){return e().toString()},toDsl:function(){return Se.typeAdt.thunk(n)}}},func:function(n,t,e){return{extract:Ee((function(t,r){return Sn.isFunction(t)?Ut.value((function(){var o=Array.prototype.slice.call(arguments,0).slice(0,n.length),i=t.apply(null,o);return e(i,r)})):Ut.error("Not a function")})).extract,toString:function(){return"function"},toDsl:function(){return Se.typeAdt.func(n,t)}}}},Fe=function(n){return Be.field(n,n,be.strict(),Be.anyValue())},Ie=function(n,t){return Be.field(n,n,be.strict(),t)},He=function(n,t){return Be.field(n,n,be.strict(),Be.obj(t))},Ve=function(n){return Be.field(n,n,be.strict(),Be.value((function(n){return Sn.isFunction(n)?Ut.value(n):Ut.error("Not a function")})))},Ne=function(n){return Be.field(n,n,be.asOption(),Be.anyValue())},je=function(n,t){return Be.field(n,n,be.asOption(),t)},Pe=function(n,t){return Be.field(n,n,be.asOption(),Be.obj(t))},Le=function(n,t){return Be.field(n,n,be.asOption(),Be.objOnly(t))},We=function(n,t){return Be.field(n,n,be.defaulted(t),Be.anyValue())},ze=function(n,t,e){return Be.field(n,n,be.defaulted(t),e)},Ge=function(n,t,e,r){return Be.field(n,t,e,r)},$e=function(n,t){return Be.state(n,t)},Ue=Be.value(Ut.value),_e=Be.arr,qe=Be.obj,Ke=Be.objOnly,Xe=Be.setOf,Ye=function(n,t,e,r){return t.extract([n],e,r).fold((function(n){return Ut.error({input:r,errors:n})}),Ut.value)},Je=function(n,t,e){return Ye(n,t,c.constant,e)},Qe=function(n,t,e){return Ye(n,t,c.identity,e)},Ze=function(n){return n.fold((function(n){throw new Error(nr(n))}),c.identity)},nr=function(n){return"Errors: \n"+function(n){var t=n.length>10?n.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):n;return K(t,(function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))}(n.errors)+"\n\nInput object: "+we(n.input)},tr={anyValue:c.constant(Ue),arrOfObj:function(n){return Be.arrOfObj(n)},arrOf:_e,arrOfVal:function(){return Be.arr(Ue)},valueOf:function(n){return Be.value((function(t){return n(t)}))},setOf:Xe,objOf:qe,objOfOnly:Ke,asStruct:Je,asRaw:Qe,asStructOrDie:function(n,t,e){return Ze(Je(n,t,e))},asRawOrDie:function(n,t,e){return Ze(Qe(n,t,e))},getOrDie:Ze,formatError:nr,choose:function(n,t){return function(n,t){return{extract:function(e,r,o){return re(o,n).fold((function(){return function(n,t){return Oe(n,(function(){return'Choice schema did not contain choice key: "'+t+'"'}))}(e,n)}),(function(n){return i=e,u=r,a=o,re(c=t,s=n).fold((function(){return function(n,t,e){return Oe(n,(function(){return'The chosen schema: "'+e+'" did not exist in branches: '+we(t)}))}(i,c,s)}),(function(n){return Be.obj(n).extract(i.concat(["branch: "+s]),u,a)}));var i,u,a,c,s}))},toString:function(){return"chooseOn("+n+"). Possible values: "+Dn.keys(t)},toDsl:function(){return Se.typeAdt.choiceOf(n,t)}}}(n,t)},thunkOf:function(n,t){return Be.thunk(n,t)},funcOrDie:function(n,t){return Be.func(n,t,(function(n,e){return Ze(Ye("()",t,e,n))}))}},er=function(n){if(!ue(n,"can")&&!ue(n,"abort")&&!ue(n,"run"))throw new Error("EventHandler defined by: "+xe(n,null,2)+" does not have can, abort, or run!");return tr.asRawOrDie("Extracting event.handler",tr.objOfOnly([We("can",c.constant(!0)),We("abort",c.constant(!1)),We("run",c.noop)]),n)},rr=er,or=function(n,t){return{key:n,value:rr({run:t})}},ir=function(n){return function(t){return{key:n,value:rr({run:function(n,e){(function(n,t){return Zn(n.element(),t.event().target())})(n,e)&&t(n,e)}})}}},ur=function(n,t){return or(n,(function(e,r){e.getSystem().getByUid(t).each((function(t){!function(n,t,e,r){n.getSystem().triggerEvent(e,t,r.event())}(t,t.element(),n,r)}))}))},ar={derive:ie,run:or,preventDefault:function(n){return{key:n,value:rr({run:function(n,t){t.event().prevent()}})}},runActionExtra:function(n,t,e){return{key:n,value:rr({run:function(n){t.apply(void 0,[n].concat(e))}})}},runOnAttached:ir(yn.attachedToDom()),runOnDetached:ir(yn.detachedFromDom()),runOnInit:ir(yn.systemInit()),runOnExecute:(u=yn.execute(),function(n){return or(u,n)}),redirectToUid:ur,redirectToPart:function(n,t,e){var r=t.partUids()[e];return ur(n,r)},runWithTarget:function(n,t){return or(n,(function(n,e){n.getSystem().getByDom(e.event().target()).each((function(r){t(n,r,e)}))}))},abort:function(n,t){return{key:n,value:rr({abort:t})}},can:function(n,t){return{key:n,value:rr({can:t})}},cutter:function(n){return or(n,(function(n,t){t.cut()}))},stopper:function(n){return or(n,(function(n,t){t.stop()}))}},cr=(N.none,function(n,t,e){return n}),sr=function(n,t){return n},fr=Gn(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),lr=function(n){return{tag:n.tag(),classes:n.classes().getOr([]),attributes:n.attributes().getOr({}),styles:n.styles().getOr({}),value:n.value().getOr("<none>"),innerHtml:n.innerHtml().getOr("<none>"),defChildren:n.defChildren().getOr("<none>"),domChildren:n.domChildren().fold((function(){return"<none>"}),(function(n){return 0===n.length?"0 children, but still specified":String(n.length)}))}},dr={nu:fr,defToStr:function(n){var t=lr(n);return xe(t,null,2)},defToRaw:lr},mr=Gn([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),gr=function(n){return{classes:n.classes().getOr("<none>"),attributes:n.attributes().getOr("<none>"),styles:n.styles().getOr("<none>"),value:n.value().getOr("<none>"),innerHtml:n.innerHtml().getOr("<none>"),defChildren:n.defChildren().getOr("<none>"),domChildren:n.domChildren().fold((function(){return"<none>"}),(function(n){return 0===n.length?"0 children, but still specified":String(n.length)}))}},pr=function(n,t,e){return t.fold((function(){return e.fold((function(){return{}}),(function(t){return oe(n,t)}))}),(function(t){return e.fold((function(){return oe(n,t)}),(function(t){return oe(n,t)}))}))},vr={nu:mr,derive:function(n){var t={},e=Dn.keys(n);return X(e,(function(e){n[e].each((function(n){t[e]=n}))})),mr(t)},merge:function(n,t){var e=Tn.deepMerge({tag:n.tag(),classes:t.classes().getOr([]).concat(n.classes().getOr([])),attributes:Tn.merge(n.attributes().getOr({}),t.attributes().getOr({})),styles:Tn.merge(n.styles().getOr({}),t.styles().getOr({}))},t.innerHtml().or(n.innerHtml()).map((function(n){return oe("innerHtml",n)})).getOr({}),pr("domChildren",t.domChildren(),n.domChildren()),pr("defChildren",t.defChildren(),n.defChildren()),t.value().or(n.value()).map((function(n){return oe("value",n)})).getOr({}));return dr.nu(e)},modToStr:function(n){var t=gr(n);return xe(t,null,2)},modToRaw:gr},hr=function(n){return{key:n,value:void 0}},yr=function(n,t,e,r,o,i,u){var a=function(n){return ue(n,e)?n[e]():N.none()},s=Dn.map(o,(function(n,t){return r=e,cr((function(n){var t=arguments;return n.config({name:c.constant(r)}).fold((function(){throw new Error("We could not find any behaviour configuration for: "+r+". Using API: "+i)}),(function(e){var r=Array.prototype.slice.call(t,1);return o.apply(void 0,[n,e.config,e.state].concat(r))}))}),i=t,o=n);var r,o,i})),l=Dn.map(i,(function(n,t){return sr(n)})),d=Tn.deepMerge(l,s,{revoke:c.curry(hr,e),config:function(t){var r=tr.asStructOrDie(e+"-config",n,t);return{key:e,value:{config:r,me:d,configAsRaw:f((function(){return tr.asRawOrDie(e+"-config",n,t)})),initialConfig:t,state:u}}},schema:function(){return t},exhibit:function(n,t){return a(n).bind((function(n){return re(r,"exhibit").map((function(e){return e(t,n.config,n.state)}))})).getOr(vr.nu({}))},name:function(){return e},handlers:function(n){return a(n).bind((function(n){return re(r,"events").map((function(t){return t(n.config,n.state)}))})).getOr({})}});return d},br=function(n,t,e){return ar.runOnInit((function(r,o){e(r,n,t)}))},Sr=function(n,t){return xr(n,t,{validate:Sn.isFunction,label:"function"})},xr=function(n,t,e){if(0===t.length)throw new Error("You must specify at least one required field.");return Ln("required",t),Wn(t),function(r){var o=Dn.keys(r);rn(t,(function(n){return on(o,n)}))||jn(t,o),n(t,o);var i=Y(t,(function(n){return!e.validate(r[n],n)}));return i.length>0&&function(n,t){throw new Error("All values need to be of type: "+t+". Keys ("+Nn(n).join(", ")+") were not.")}(i,e.label),r}},wr=c.noop,Or={exactly:c.curry(Sr,(function(n,t){var e=Y(t,(function(t){return!on(n,t)}));e.length>0&&Pn(e)})),ensure:c.curry(Sr,wr),ensureWith:c.curry(xr,wr)},Tr=Or.ensure(["readState"]),kr={init:function(){return Tr({readState:function(){return"No State required"}})}},Cr=tr.objOfOnly([Fe("fields"),Fe("name"),We("active",{}),We("apis",{}),We("extra",{}),We("state",kr)]),Er=tr.objOfOnly([Fe("branchKey"),Fe("branches"),Fe("name"),We("active",{}),We("apis",{}),We("extra",{}),We("state",kr)]),Ar={derive:function(n){return ie(n)},revoke:c.constant(void 0),noActive:c.constant({}),noApis:c.constant({}),noExtra:c.constant({}),noState:c.constant(kr),create:function(n){var t=tr.asRawOrDie("Creating behaviour: "+n.name,Cr,n);return function(n,t,e,r,o,i){var u=tr.objOfOnly(n),a=Pe(t,[Le("config",n)]);return yr(u,a,t,e,r,o,i)}(t.fields,t.name,t.active,t.apis,t.extra,t.state)},createModes:function(n){var t=tr.asRawOrDie("Creating behaviour: "+n.name,Er,n);return function(n,t,e,r,o,i){var u=n,a=Pe(t,[je("config",n)]);return yr(u,a,t,e,r,o,i)}(tr.choose(t.branchKey,t.branches),t.name,t.active,t.apis,t.extra,t.state)}},Mr=function(n,t){var e=jt(n,t);return void 0===e||""===e?[]:e.split(" ")},Dr=Mr,Rr=function(n){return Dr(n,"class")},Br=function(n,t){return function(n,t,e){var r=Mr(n,t).concat([e]);Vt(n,t,r.join(" "))}(n,"class",t)},Fr=function(n,t){return function(n,t,e){var r=Y(Mr(n,t),(function(n){return n!==e}));r.length>0?Vt(n,t,r.join(" ")):Lt(n,t)}(n,"class",t)},Ir=Rr,Hr=Br,Vr=Fr,Nr=function(n){return void 0!==n.dom().classList},jr=function(n,t){Nr(n)?n.dom().classList.add(t):Hr(n,t)},Pr=function(n,t){var e;Nr(n)?n.dom().classList.remove(t):Vr(n,t),0===(Nr(e=n)?e.dom().classList:Ir(e)).length&&Lt(e,"class")},Lr=function(n,t){return Nr(n)&&n.dom().classList.contains(t)},Wr=function(n,t,e){Pr(n,e),jr(n,t)},zr={toAlpha:function(n,t,e){Wr(n.element(),t.alpha(),t.omega())},toOmega:function(n,t,e){Wr(n.element(),t.omega(),t.alpha())},isAlpha:function(n,t,e){return Lr(n.element(),t.alpha())},isOmega:function(n,t,e){return Lr(n.element(),t.omega())},clear:function(n,t,e){Pr(n.element(),t.alpha()),Pr(n.element(),t.omega())}},Gr=[Fe("alpha"),Fe("omega")],$r=Ar.create({fields:Gr,name:"swapping",apis:zr}),Ur=function(n){var t=n,e=function(){return t};return{get:e,set:function(n){t=n},clone:function(){return Ur(e())}}};function _r(n,t,e,r,o){return n(e,r)?N.some(e):Sn.isFunction(o)&&o(e)?N.none():t(e,r,o)}var qr=function(n,t,e){for(var r=n.dom(),o=Sn.isFunction(e)?e:c.constant(!1);r.parentNode;){r=r.parentNode;var i=Kn(r);if(t(i))return N.some(i);if(o(i))break}return N.none()},Kr=qr,Xr=function(n,t){var e=function(n){for(var r=0;r<n.childNodes.length;r++){if(t(Kn(n.childNodes[r])))return N.some(Kn(n.childNodes[r]));var o=e(n.childNodes[r]);if(o.isSome())return o}return N.none()};return e(n.dom())},Yr=function(n){var t=void 0!==n?n.dom():document;return N.from(t.activeElement).map(Kn)},Jr=function(n){n.dom().focus()},Qr=function(n){n.dom().blur()},Zr=Yr,no=function(n){return Yr(et(n)).filter((function(t){return n.dom().contains(t.dom())}))},to=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),eo=tinymce.util.Tools.resolve("tinymce.ThemeManager"),ro={formatChanged:c.constant("formatChanged"),orientationChanged:c.constant("orientationChanged"),dropupDismissed:c.constant("dropupDismissed")},oo={events:function(n){return ar.derive([ar.run(yn.receive(),(function(t,e){var r,o,i=n.channels(),u=(r=Dn.keys(i),(o=e).universal()?r:Y(r,(function(n){return on(o.channels(),n)})));X(u,(function(n){var r=i[n](),o=r.schema(),u=tr.asStructOrDie("channel["+n+"] data\nReceiver: "+zt(t.element()),o,e.data());r.onReceive()(t,u)}))}))])}},io=[Fe("menu"),Fe("selectedMenu")],uo=[Fe("item"),Fe("selectedItem")],ao=tr.objOfOnly(uo.concat(io)),co=tr.objOfOnly(uo),so={menuFields:c.constant(io),itemFields:c.constant(uo),schema:c.constant(ao),itemSchema:c.constant(co)},fo=He("initSize",[Fe("numColumns"),Fe("numRows")]),lo=function(n,t,e){return pe(),Ge(t,t,e,tr.valueOf((function(n){return Ut.value((function(){return n.apply(void 0,arguments)}))})))},mo={initSize:c.constant(fo),itemMarkers:function(){return Ie("markers",so.itemSchema())},menuMarkers:function(){return Ie("markers",so.schema())},tieredMenuMarkers:function(){return He("markers",[Fe("backgroundMenu")].concat(so.menuFields()).concat(so.itemFields()))},markers:function(n){return He("markers",K(n,Fe))},onHandler:function(n){return lo(0,n,be.defaulted(c.noop))},onKeyboardHandler:function(n){return lo(0,n,be.defaulted(N.none))},onStrictHandler:function(n){return lo(0,n,be.strict())},onStrictKeyboardHandler:function(n){return lo(0,n,be.strict())},output:function(n,t){return $e(n,c.constant(t))},snapshot:function(n){return $e(n,c.identity)}},go=[Ie("channels",tr.setOf(Ut.value,tr.objOfOnly([mo.onStrictHandler("onReceive"),We("schema",tr.anyValue())])))],po=Ar.create({fields:go,name:"receiving",active:oo}),vo=function(n,t){var e=bo(n,t),r=t.aria();r.update()(n,r,e)},ho=function(n,t,e){jr(n.element(),t.toggleClass()),vo(n,t)},yo=function(n,t,e){Pr(n.element(),t.toggleClass()),vo(n,t)},bo=function(n,t){return Lr(n.element(),t.toggleClass())},So={onLoad:function(n,t,e){(t.selected()?ho:yo)(n,t,e)},toggle:function(n,t,e){(function(n,t){Nr(n)?n.dom().classList.toggle(t):function(n,t){on(Rr(n),t)?Fr(n,t):Br(n,t)}(n,t)})(n.element(),t.toggleClass()),vo(n,t)},isOn:bo,on:ho,off:yo},xo={exhibit:function(n,t,e){return vr.nu({})},events:function(n,t){var e=function(n,t,e){return ar.runOnExecute((function(r){e(r,n,t)}))}(n,t,So.toggle),r=br(n,t,So.onLoad);return ar.derive(tn([n.toggleOnExecute()?[e]:[],[r]]))}},wo=function(n,t,e){Vt(n.element(),"aria-expanded",e)},Oo=wo,To=[We("selected",!1),Fe("toggleClass"),We("toggleOnExecute",!0),ze("aria",{mode:"none"},tr.choose("mode",{pressed:[We("syncWithExpanded",!1),mo.output("update",(function(n,t,e){Vt(n.element(),"aria-pressed",e),t.syncWithExpanded()&&wo(n,0,e)}))],checked:[mo.output("update",(function(n,t,e){Vt(n.element(),"aria-checked",e)}))],expanded:[mo.output("update",Oo)],selected:[mo.output("update",(function(n,t,e){Vt(n.element(),"aria-selected",e)}))],none:[mo.output("update",c.noop)]}))],ko=Ar.create({fields:To,name:"toggling",active:xo,apis:So}),Co=function(n,t){return po.config({channels:oe(ro.formatChanged(),{onReceive:function(e,r){r.command===n&&t(e,r.state)}})})},Eo=function(n){return po.config({channels:oe(ro.orientationChanged(),{onReceive:n})})},Ao=function(n,t){return{key:n,value:{onReceive:t}}},Mo="tinymce-mobile",Do={resolve:function(n){return Mo+"-"+n},prefix:c.constant(Mo)},Ro={focus:function(n,t){t.ignore()||(Jr(n.element()),t.onFocus()(n))},blur:function(n,t){t.ignore()||Qr(n.element())},isFocused:function(n){return function(n){var t=et(n).dom();return n.dom()===t.activeElement}(n.element())}},Bo={exhibit:function(n,t){return t.ignore()?vr.nu({}):vr.nu({attributes:{tabindex:"-1"}})},events:function(n){return ar.derive([ar.run(yn.focus(),(function(t,e){Ro.focus(t,n),e.stop()}))])}},Fo=[mo.onHandler("onFocus"),We("ignore",!1)],Io=Ar.create({fields:Fo,name:"focusing",active:Bo,apis:Ro}),Ho={BACKSPACE:c.constant([8]),TAB:c.constant([9]),ENTER:c.constant([13]),SHIFT:c.constant([16]),CTRL:c.constant([17]),ALT:c.constant([18]),CAPSLOCK:c.constant([20]),ESCAPE:c.constant([27]),SPACE:c.constant([32]),PAGEUP:c.constant([33]),PAGEDOWN:c.constant([34]),END:c.constant([35]),HOME:c.constant([36]),LEFT:c.constant([37]),UP:c.constant([38]),RIGHT:c.constant([39]),DOWN:c.constant([40]),INSERT:c.constant([45]),DEL:c.constant([46]),META:c.constant([91,93,224]),F10:c.constant([121])},Vo=function(n,t,e,r){var o=n+t;return o>r?e:o<e?r:o},No=function(n,t,e){return n<=t?t:n>=e?e:n},jo=function(n,t,e){return function(n,t,e){return Y(function(n,t){for(var e=Sn.isFunction(t)?t:c.constant(!1),r=n.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var i=r.parentNode,u=Kn(i);if(o.push(u),!0===e(u))break;r=i}return o}(n,e),t)}(n,(function(n){return Jn(n,t)}),e)},Po=function(n,t){return function(n,t){return Y(function(n){return nt(n).map(tt).map((function(t){return Y(t,(function(t){return!Zn(n,t)}))})).getOr([])}(n),t)}(n,(function(n){return Jn(n,t)}))},Lo=function(n,t){return Yn(t,n)},Wo=function(n,t,e){return Kr(n,(function(n){return Jn(n,t)}),e)},zo=function(n){return Qn(n)},Go=Wo,$o=function(n,t){return Qn(t,n)},Uo=function(n,t,e){return _r(Jn,Wo,n,t,e)},_o=function(n,t,e){var r=Lo(n.element(),"."+t.highlightClass());X(r,(function(e){Pr(e,t.highlightClass()),n.getSystem().getByDom(e).each((function(e){t.onDehighlight()(n,e)}))}))},qo=function(n,t,e,r){var o=Ko(n,t,e,r);_o(n,t),jr(r.element(),t.highlightClass()),o||t.onHighlight()(n,r)},Ko=function(n,t,e,r){return Lr(r.element(),t.highlightClass())},Xo=function(n,t,e){return $o(n.element(),"."+t.itemClass()).bind(n.getSystem().getByDom)},Yo=function(n,t,e){var r=Lo(n.element(),"."+t.itemClass());return(r.length>0?N.some(r[r.length-1]):N.none()).bind(n.getSystem().getByDom)},Jo=function(n,t,e,r){var o=Lo(n.element(),"."+t.itemClass());return nn(o,(function(n){return Lr(n,t.highlightClass())})).bind((function(t){var e=Vo(t,r,0,o.length-1);return n.getSystem().getByDom(o[e])}))},Qo={dehighlightAll:_o,dehighlight:function(n,t,e,r){var o=Ko(n,t,e,r);Pr(r.element(),t.highlightClass()),o&&t.onDehighlight()(n,r)},highlight:qo,highlightFirst:function(n,t,e){Xo(n,t).each((function(r){qo(n,t,e,r)}))},highlightLast:function(n,t,e){Yo(n,t).each((function(r){qo(n,t,e,r)}))},highlightAt:function(n,t,e,r){(function(n,t,e,r){var o=Lo(n.element(),"."+t.itemClass());return N.from(o[r]).fold((function(){return Ut.error("No element found with index "+r)}),n.getSystem().getByDom)})(n,t,0,r).fold((function(n){throw new Error(n)}),(function(r){qo(n,t,e,r)}))},highlightBy:function(n,t,e,r){var o=Lo(n.element(),"."+t.itemClass()),i=ce(K(o,(function(t){return n.getSystem().getByDom(t).toOption()})));Z(i,r).each((function(r){qo(n,t,e,r)}))},isHighlighted:Ko,getHighlighted:function(n,t,e){return $o(n.element(),"."+t.highlightClass()).bind(n.getSystem().getByDom)},getFirst:Xo,getLast:Yo,getPrevious:function(n,t,e){return Jo(n,t,0,-1)},getNext:function(n,t,e){return Jo(n,t,0,1)}},Zo=[Fe("highlightClass"),Fe("itemClass"),mo.onHandler("onHighlight"),mo.onHandler("onDehighlight")],ni=Ar.create({fields:Zo,name:"highlighting",apis:Qo}),ti=function(){return{get:function(n){return no(n.element())},set:function(n,t){n.getSystem().triggerFocus(t,n.element())}}},ei=function(n){return!0===n.raw().shiftKey},ri=function(n){return!0===n.raw().ctrlKey},oi={inSet:function(n){return function(t){return on(n,t.raw().which)}},and:function(n){return function(t){return rn(n,(function(n){return n(t)}))}},is:function(n){return function(t){return t.raw().which===n}},isShift:ei,isNotShift:c.not(ei),isControl:ri,isNotControl:c.not(ri)},ii=function(n,t){return{matches:n,classification:t}},ui=function(n,t,e,r,o,i){var u=function(n,t,r,o){return function(n,t){return Z(n,(function(n){return n.matches(t)})).map((function(n){return n.classification}))}(e(n,t,r,o),t.event()).bind((function(e){return e(n,t,r,o)}))},a={schema:function(){return n.concat([We("focusManager",ti()),mo.output("handler",a),mo.output("state",t)])},processKey:u,toEvents:function(n,t){var e=r(n,t),o=ar.derive(i.map((function(e){return ar.run(yn.focus(),(function(r,o){e(r,n,t,o),o.stop()}))})).toArray().concat([ar.run(s.keydown(),(function(e,r){u(e,r,n,t).each((function(n){r.stop()}))}))]));return Tn.deepMerge(e,o)},toApis:o};return a},ai={cyclePrev:function(n,t,e){var r=un(n.slice(0,t)),o=un(n.slice(t+1));return Z(r.concat(o),e)},cycleNext:function(n,t,e){var r=n.slice(0,t),o=n.slice(t+1);return Z(o.concat(r),e)},tryPrev:function(n,t,e){var r=un(n.slice(0,t));return Z(r,e)},tryNext:function(n,t,e){var r=n.slice(t+1);return Z(r,e)}},ci=function(n){return void 0!==n.style},si=function(n,t,e){if(!Sn.isString(e))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",e,":: Element ",n),new Error("CSS value must be a string: "+e);ci(n)&&n.style.setProperty(t,e)},fi=function(n,t){return ci(n)?n.style.getPropertyValue(t):""},li=function(n,t,e){var r=n.dom();si(r,t,e)},di=function(n,t){var e=n.dom();Dn.each(t,(function(n,t){si(e,t,n)}))},mi=function(n,t){(function(n,t){ci(n)&&n.style.removeProperty(t)})(n.dom(),t),Pt(n,"style")&&""===function(n){return n.replace(/^\s+|\s+$/g,"")}(jt(n,"style"))&&Lt(n,"style")},gi=function(n,t){var e=n.dom(),r=window.getComputedStyle(e).getPropertyValue(t),o=""!==r||kt.inBody(n)?r:fi(e,t);return null===o?void 0:o},pi=function(n,t){var e=n.dom(),r=fi(e,t);return N.from(r).filter((function(n){return n.length>0}))},vi=function(n){return n.dom().offsetWidth};function hi(n,t){var e=function(e){var r=t(e);if(r<=0||null===r){var o=gi(e,n);return parseFloat(o)||0}return r},r=function(n,t){return Q(t,(function(t,e){var r=gi(n,e),o=void 0===r?0:parseInt(r,10);return isNaN(o)?t:t+o}),0)};return{set:function(t,e){if(!Sn.isNumber(e)&&!e.match(/^[0-9]+$/))throw n+".set accepts only positive integer values. Value was "+e;var r=t.dom();ci(r)&&(r.style[n]=e+"px")},get:e,getOuter:e,aggregate:r,max:function(n,t,e){var o=r(n,e);return t>o?t-o:0}}}var yi=hi("height",(function(n){return kt.inBody(n)?n.dom().getBoundingClientRect().height:n.dom().offsetHeight})),bi=function(n){return yi.get(n)},Si=function(n){var t=[Ne("onEscape"),Ne("onEnter"),We("selector",'[data-alloy-tabstop="true"]'),We("firstTabstop",0),We("useTabstopAt",c.constant(!0)),Ne("visibilitySelector")].concat([n]),e=function(n,t){var e=n.visibilitySelector().bind((function(n){return Uo(t,n)})).getOr(t);return bi(e)>0},r=function(n,t,r,o,i){return i(t,r,(function(n){return e(t=o,r=n)&&t.useTabstopAt()(r);var t,r})).fold((function(){return o.cyclic()?N.some(!0):N.none()}),(function(t){return o.focusManager().set(n,t),N.some(!0)}))},o=function(n,t,e,o){var i,u,a=Lo(n.element(),e.selector());return(i=n,u=e,u.focusManager().get(i).bind((function(n){return Uo(n,u.selector())}))).bind((function(t){return nn(a,c.curry(Zn,t)).bind((function(t){return r(n,a,t,e,o)}))}))},i=c.constant([ii(oi.and([oi.isShift,oi.inSet(Ho.TAB())]),(function(n,t,e,r){var i=e.cyclic()?ai.cyclePrev:ai.tryPrev;return o(n,0,e,i)})),ii(oi.inSet(Ho.TAB()),(function(n,t,e,r){var i=e.cyclic()?ai.cycleNext:ai.tryNext;return o(n,0,e,i)})),ii(oi.inSet(Ho.ESCAPE()),(function(n,t,e,r){return e.onEscape().bind((function(e){return e(n,t)}))})),ii(oi.and([oi.isNotShift,oi.inSet(Ho.ENTER())]),(function(n,t,e,r){return e.onEnter().bind((function(e){return e(n,t)}))}))]),u=c.constant({}),a=c.constant({});return ui(t,kr.init,i,u,a,N.some((function(n,t,r){var o,i,u,a;(o=n,i=t,u=Lo(o.element(),i.selector()),a=Y(u,(function(n){return e(i,n)})),N.from(a[i.firstTabstop()])).each((function(e){t.focusManager().set(n,e)}))})))},xi=Si($e("cyclic",c.constant(!1))),wi=Si($e("cyclic",c.constant(!0))),Oi=function(n){return"input"===wt.name(n)&&"radio"!==jt(n,"type")||"textarea"===wt.name(n)},Ti=function(n,t,e){return Oi(e)&&oi.inSet(Ho.SPACE())(t.event())?N.none():(Vn(n,e,yn.execute()),N.some(!0))},ki=[We("execute",Ti),We("useSpace",!1),We("useEnter",!0),We("useControlEnter",!1),We("useDown",!1)],Ci=function(n,t,e,r){return e.execute()(n,t,n.element())},Ei=c.constant({}),Ai=c.constant({}),Mi=ui(ki,kr.init,(function(n,t,e,r){var o=e.useSpace()&&!Oi(n.element())?Ho.SPACE():[],i=e.useEnter()?Ho.ENTER():[],u=e.useDown()?Ho.DOWN():[],a=o.concat(i).concat(u);return[ii(oi.inSet(a),Ci)].concat(e.useControlEnter()?[ii(oi.and([oi.isControl,oi.inSet(Ho.ENTER())]),Ci)]:[])}),Ei,Ai,N.none()),Di={flatgrid:function(n){var t=Ur(N.none());return Tr({readState:c.constant({}),setGridSize:function(n,e){t.set(N.some({numRows:c.constant(n),numColumns:c.constant(e)}))},getNumRows:function(){return t.get().map((function(n){return n.numRows()}))},getNumColumns:function(){return t.get().map((function(n){return n.numColumns()}))}})},init:function(n){return n.state()(n)}},Ri=function(n,t){return function(e){return"rtl"===function(n){return"rtl"===gi(n,"direction")?"rtl":"ltr"}(e)?t:n}},Bi=function(n){return function(t,e,r,o){var i=n(t.element());return Ii(i,t,e,r,o)}},Fi=function(n){return function(t,e,r,o){return Ii(n,t,e,r,o)}},Ii=function(n,t,e,r,o){return r.focusManager().get(t).bind((function(e){return n(t.element(),e,r,o)})).map((function(n){return r.focusManager().set(t,n),!0}))},Hi=function(n,t){var e=Ri(t,n);return Bi(e)},Vi=function(n,t){var e=Ri(n,t);return Bi(e)},Ni=Fi,ji=Fi,Pi=Fi,Li=Gn(["index","candidates"],[]),Wi=function(n){var t;return!((t=n.dom()).offsetWidth<=0&&t.offsetHeight<=0)},zi=function(n,t,e){return function(n,t,e,r){var o=c.curry(Zn,t),i=Lo(n,e);return function(n,t){return nn(n,t).map((function(t){return Li({index:t,candidates:n})}))}(Y(i,Wi),o)}(n,t,e)},Gi=function(n,t){return nn(n,(function(n){return Zn(t,n)}))},$i=function(n,t,e,r){return r(Math.floor(t/e),t%e).bind((function(t){var r=t.row()*e+t.column();return r>=0&&r<n.length?N.some(n[r]):N.none()}))},Ui=function(n,t,e,r,o){return $i(n,t,r,(function(t,i){var u=t===e-1?n.length-t*r:r,a=Vo(i,o,0,u-1);return N.some({row:c.constant(t),column:c.constant(a)})}))},_i=function(n,t,e,r,o){return $i(n,t,r,(function(t,i){var u=Vo(t,o,0,e-1),a=u===e-1?n.length-u*r:r,s=No(i,0,a-1);return N.some({row:c.constant(u),column:c.constant(s)})}))},qi=[Fe("selector"),We("execute",Ti),mo.onKeyboardHandler("onEscape"),We("captureTab",!1),mo.initSize()],Ki=function(n){return function(t,e,r,o){return zi(t,e,r.selector()).bind((function(t){return n(t.candidates(),t.index(),o.getNumRows().getOr(r.initSize().numRows()),o.getNumColumns().getOr(r.initSize().numColumns()))}))}},Xi=function(n,t,e,r){return e.captureTab()?N.some(!0):N.none()},Yi=Ki((function(n,t,e,r){return Ui(n,t,e,r,-1)})),Ji=Ki((function(n,t,e,r){return Ui(n,t,e,r,1)})),Qi=Ki((function(n,t,e,r){return _i(n,t,e,r,-1)})),Zi=Ki((function(n,t,e,r){return _i(n,t,e,r,1)})),nu=c.constant([ii(oi.inSet(Ho.LEFT()),Vi(Yi,Ji)),ii(oi.inSet(Ho.RIGHT()),Hi(Yi,Ji)),ii(oi.inSet(Ho.UP()),Ni(Qi)),ii(oi.inSet(Ho.DOWN()),ji(Zi)),ii(oi.and([oi.isShift,oi.inSet(Ho.TAB())]),Xi),ii(oi.and([oi.isNotShift,oi.inSet(Ho.TAB())]),Xi),ii(oi.inSet(Ho.ESCAPE()),(function(n,t,e,r){return e.onEscape()(n,t)})),ii(oi.inSet(Ho.SPACE().concat(Ho.ENTER())),(function(n,t,e,r){return(o=n,i=e,i.focusManager().get(o).bind((function(n){return Uo(n,i.selector())}))).bind((function(r){return e.execute()(n,t,r)}));var o,i}))]),tu=c.constant({}),eu=ui(qi,Di.flatgrid,nu,tu,{},N.some((function(n,t,e){$o(n.element(),t.selector()).each((function(e){t.focusManager().set(n,e)}))}))),ru=function(n,t,e,r){return zi(n,e,t,c.constant(!0)).bind((function(n){var t=n.index(),e=n.candidates(),o=Vo(t,r,0,e.length-1);return N.from(e[o])}))},ou=[Fe("selector"),We("getInitial",N.none),We("execute",Ti),We("executeOnMove",!1)],iu=function(n,t,e){return(r=n,o=e,o.focusManager().get(r).bind((function(n){return Uo(n,o.selector())}))).bind((function(r){return e.execute()(n,t,r)}));var r,o},uu=function(n,t,e){return ru(n,e.selector(),t,-1)},au=function(n,t,e){return ru(n,e.selector(),t,1)},cu=function(n){return function(t,e,r){return n(t,e,r).bind((function(){return r.executeOnMove()?iu(t,e,r):N.some(!0)}))}},su=c.constant({}),fu=c.constant({}),lu=ui(ou,kr.init,(function(n){return[ii(oi.inSet(Ho.LEFT().concat(Ho.UP())),cu(Vi(uu,au))),ii(oi.inSet(Ho.RIGHT().concat(Ho.DOWN())),cu(Hi(uu,au))),ii(oi.inSet(Ho.ENTER()),iu),ii(oi.inSet(Ho.SPACE()),iu)]}),su,fu,N.some((function(n,t){t.getInitial()(n).or($o(n.element(),t.selector())).each((function(e){t.focusManager().set(n,e)}))}))),du=Gn(["rowIndex","columnIndex","cell"],[]),mu=function(n,t,e){return N.from(n[t]).bind((function(n){return N.from(n[e]).map((function(n){return du({rowIndex:t,columnIndex:e,cell:n})}))}))},gu=function(n,t,e,r){var o=n[t].length,i=Vo(e,r,0,o-1);return mu(n,t,i)},pu=function(n,t,e,r){var o=Vo(e,r,0,n.length-1),i=n[o].length,u=No(t,0,i-1);return mu(n,o,u)},vu=function(n,t,e,r){var o=n[t].length,i=No(e+r,0,o-1);return mu(n,t,i)},hu=function(n,t,e,r){var o=No(e+r,0,n.length-1),i=n[o].length,u=No(t,0,i-1);return mu(n,o,u)},yu=[He("selectors",[Fe("row"),Fe("cell")]),We("cycles",!0),We("previousSelector",N.none),We("execute",Ti)],bu=function(n,t){return function(e,r,o){var i=o.cycles()?n:t;return Uo(r,o.selectors().row()).bind((function(n){var t=Lo(n,o.selectors().cell());return Gi(t,r).bind((function(t){var r=Lo(e,o.selectors().row());return Gi(r,n).bind((function(n){var e,u=(e=o,K(r,(function(n){return Lo(n,e.selectors().cell())})));return i(u,n,t).map((function(n){return n.cell()}))}))}))}))}},Su=bu((function(n,t,e){return gu(n,t,e,-1)}),(function(n,t,e){return vu(n,t,e,-1)})),xu=bu((function(n,t,e){return gu(n,t,e,1)}),(function(n,t,e){return vu(n,t,e,1)})),wu=bu((function(n,t,e){return pu(n,e,t,-1)}),(function(n,t,e){return hu(n,e,t,-1)})),Ou=bu((function(n,t,e){return pu(n,e,t,1)}),(function(n,t,e){return hu(n,e,t,1)})),Tu=c.constant([ii(oi.inSet(Ho.LEFT()),Vi(Su,xu)),ii(oi.inSet(Ho.RIGHT()),Hi(Su,xu)),ii(oi.inSet(Ho.UP()),Ni(wu)),ii(oi.inSet(Ho.DOWN()),ji(Ou)),ii(oi.inSet(Ho.SPACE().concat(Ho.ENTER())),(function(n,t,e){return no(n.element()).bind((function(r){return e.execute()(n,t,r)}))}))]),ku=c.constant({}),Cu=c.constant({}),Eu=ui(yu,kr.init,Tu,ku,Cu,N.some((function(n,t){t.previousSelector()(n).orThunk((function(){var e=t.selectors();return $o(n.element(),e.cell())})).each((function(e){t.focusManager().set(n,e)}))}))),Au=[Fe("selector"),We("execute",Ti),We("moveOnTab",!1)],Mu=function(n,t,e){return e.focusManager().get(n).bind((function(r){return e.execute()(n,t,r)}))},Du=function(n,t,e){return ru(n,e.selector(),t,-1)},Ru=function(n,t,e){return ru(n,e.selector(),t,1)},Bu=c.constant([ii(oi.inSet(Ho.UP()),Pi(Du)),ii(oi.inSet(Ho.DOWN()),Pi(Ru)),ii(oi.and([oi.isShift,oi.inSet(Ho.TAB())]),(function(n,t,e){return e.moveOnTab()?Pi(Du)(n,t,e):N.none()})),ii(oi.and([oi.isNotShift,oi.inSet(Ho.TAB())]),(function(n,t,e){return e.moveOnTab()?Pi(Ru)(n,t,e):N.none()})),ii(oi.inSet(Ho.ENTER()),Mu),ii(oi.inSet(Ho.SPACE()),Mu)]),Fu=c.constant({}),Iu=c.constant({}),Hu=ui(Au,kr.init,Bu,Fu,Iu,N.some((function(n,t,e){$o(n.element(),t.selector()).each((function(e){t.focusManager().set(n,e)}))}))),Vu=[mo.onKeyboardHandler("onSpace"),mo.onKeyboardHandler("onEnter"),mo.onKeyboardHandler("onShiftEnter"),mo.onKeyboardHandler("onLeft"),mo.onKeyboardHandler("onRight"),mo.onKeyboardHandler("onTab"),mo.onKeyboardHandler("onShiftTab"),mo.onKeyboardHandler("onUp"),mo.onKeyboardHandler("onDown"),mo.onKeyboardHandler("onEscape"),Ne("focusIn")],Nu=c.constant({}),ju=c.constant({}),Pu=ui(Vu,kr.init,(function(n,t,e){return[ii(oi.inSet(Ho.SPACE()),e.onSpace()),ii(oi.and([oi.isNotShift,oi.inSet(Ho.ENTER())]),e.onEnter()),ii(oi.and([oi.isShift,oi.inSet(Ho.ENTER())]),e.onShiftEnter()),ii(oi.and([oi.isShift,oi.inSet(Ho.TAB())]),e.onShiftTab()),ii(oi.and([oi.isNotShift,oi.inSet(Ho.TAB())]),e.onTab()),ii(oi.inSet(Ho.UP()),e.onUp()),ii(oi.inSet(Ho.DOWN()),e.onDown()),ii(oi.inSet(Ho.LEFT()),e.onLeft()),ii(oi.inSet(Ho.RIGHT()),e.onRight()),ii(oi.inSet(Ho.SPACE()),e.onSpace()),ii(oi.inSet(Ho.ESCAPE()),e.onEscape())]}),Nu,ju,N.some((function(n,t){return t.focusIn().bind((function(e){return e(n,t)}))}))),Lu={acyclic:xi.schema(),cyclic:wi.schema(),flow:lu.schema(),flatgrid:eu.schema(),matrix:Eu.schema(),execution:Mi.schema(),menu:Hu.schema(),special:Pu.schema()},Wu=Ar.createModes({branchKey:"mode",branches:Lu,name:"keying",active:{events:function(n,t){return n.handler().toEvents(n,t)}},apis:{focusIn:function(n){n.getSystem().triggerFocus(n.element(),n.element())},setGridSize:function(n,t,e,r,o){ue(e,"setGridSize")?e.setGridSize(r,o):console.error("Layout does not support setGridSize")}},state:Di}),zu=function(n,t){return function(n,t,e){return Be.field(n,n,be.defaulted({}),Be.obj(e))}(n,0,K(t,(function(t){return function(n,t){return Be.field(n,n,be.asOption(),Be.value((function(e){return Ut.error("The field: "+n+" is forbidden. "+t)})))}(t.name(),"Cannot configure "+t.name()+" for "+n)})).concat([$e("dump",c.identity)]))},Gu=function(n){return n.dump()},$u=0,Uu=function(n){var t=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++$u+String(t)},_u=Uu("alloy-premade"),qu=Uu("api"),Ku={apiConfig:c.constant(qu),makeApi:function(n){return function(n,t){return n}((function(t){var e=Array.prototype.slice.call(arguments,0),r=t.config(qu);return n.apply(void 0,[r].concat(e))}))},premade:function(n){return oe(_u,n)},getPremade:function(n){return re(n,_u)}},Xu=_t([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),Yu=We("factory",{sketch:c.identity}),Ju=We("schema",[]),Qu=Fe("name"),Zu=Ge("pname","pname",be.defaultedThunk((function(n){return"<alloy."+Uu(n.name)+">"})),tr.anyValue()),na=We("defaults",c.constant({})),ta=We("overrides",c.constant({})),ea=tr.objOf([Yu,Ju,Qu,Zu,na,ta]),ra=tr.objOf([Yu,Ju,Qu,na,ta]),oa=tr.objOf([Yu,Ju,Qu,Zu,na,ta]),ia=tr.objOf([Yu,Ju,Qu,Fe("unit"),Zu,na,ta]),ua=function(n,t){return function(e){var r=tr.asStructOrDie("Converting part type",t,e);return n(r)}},aa={required:ua(Xu.required,ea),external:ua(Xu.external,ra),optional:ua(Xu.optional,oa),group:ua(Xu.group,ia),asNamedPart:function(n){return n.fold(N.some,N.none,N.some,N.some)},name:function(n){var t=function(n){return n.name()};return n.fold(t,t,t,t)},asCommon:function(n){return n.fold(c.identity,c.identity,c.identity,c.identity)},original:c.constant("entirety")},ca="placeholder",sa=_t([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),fa=function(n,t,e,r){return function(n,t,e,r){return e.uiType===ca?(i=e,u=r,(o=n).exists((function(n){return n!==i.owner}))?sa.single(!0,c.constant(i)):re(u,i.name).fold((function(){throw new Error("Unknown placeholder component: "+i.name+"\nKnown: ["+Dn.keys(u)+"]\nNamespace: "+o.getOr("none")+"\nSpec: "+xe(i,null,2))}),(function(n){return n.replace()}))):sa.single(!1,c.constant(e));var o,i,u}(n,0,e,r).fold((function(o,i){var u=i(t,e.config,e.validated),a=re(u,"components").getOr([]),c=en(a,(function(e){return fa(n,t,e,r)}));return[Tn.deepMerge(u,{components:c})]}),(function(n,r){return r(t,e.config,e.validated)}))},la=function(n,t,e,r){return en(e,(function(e){return fa(n,t,e,r)}))},da={single:sa.single,multiple:sa.multiple,isSubstitute:function(n){return on([ca],n)},placeholder:c.constant(ca),substituteAll:la,substitutePlaces:function(n,t,e,r){var o=Dn.map(r,(function(n,t){return e=t,r=n,o=!1,{name:c.constant(e),required:function(){return r.fold((function(n,t){return n}),(function(n,t){return n}))},used:function(){return o},replace:function(){if(!0===o)throw new Error("Trying to use the same placeholder more than once: "+e);return o=!0,r}};var e,r,o})),i=la(n,t,e,o);return Dn.each(o,(function(e){if(!1===e.used()&&e.required())throw new Error("Placeholder: "+e.name()+" was not found in components list\nNamespace: "+n.getOr("none")+"\nComponents: "+xe(t.components(),null,2))})),i},singleReplace:function(n,t){return t.fold((function(t,e){return[e(n)]}),(function(t,e){return e(n)}))}},ma=function(n,t,e,r){var o=e;return Tn.deepMerge(t.defaults()(n,e,r),e,{uid:n.partUids()[t.name()]},t.overrides()(n,e,r),{"debug.sketcher":oe("part-"+t.name(),o)})},ga=function(n,t,e){var r=t.partUids()[e];return n.getSystem().getByUid(r).toOption()},pa=function(n,t,e){return function(n,t,e){var r={},o={};return X(e,(function(n){n.fold((function(n){r[n.pname()]=da.single(!0,(function(t,e,r){return n.factory().sketch(ma(t,n,e,r))}))}),(function(n){var e=t.parts()[n.name()]();o[n.name()]=c.constant(ma(t,n,e[aa.original()]()))}),(function(n){r[n.pname()]=da.single(!1,(function(t,e,r){return n.factory().sketch(ma(t,n,e,r))}))}),(function(n){r[n.pname()]=da.multiple(!0,(function(t,e,r){var o=t[n.name()]();return K(o,(function(e){return n.factory().sketch(Tn.deepMerge(n.defaults()(t,e),e,n.overrides()(t,e)))}))}))}))})),{internals:c.constant(r),externals:c.constant(o)}}(0,t,e)},va=function(n,t,e){return da.substitutePlaces(N.some(n),t,t.components(),e)},ha=function(n){return Ge("partUids","partUids",be.mergeWithThunk((function(t){return function(n,t){var e=function(n){return K(n,aa.name)}(t);return ie(K(e,(function(t){return{key:t,value:n+"-"+t}})))}(t.uid,n)})),tr.anyValue())},ya=ga,ba=function(n,t,e){return ga(n,t,e).getOrDie("Could not find part: "+e)},Sa={prefix:c.constant("alloy-id-"),idAttr:c.constant("data-alloy-id")},xa=Sa.prefix(),wa=Sa.idAttr(),Oa=function(n){var t=wt.isElement(n)?jt(n,wa):null;return N.from(t)},Ta=function(n){return Uu(n)},ka=(c.constant(wa),function(n,t,e,r,o){var i=function(n,t,e,r){return(t.length>0?[He("parts",t)]:[]).concat([Fe("uid"),We("dom",{}),We("components",[]),mo.snapshot("originalSpec"),We("debug.sketcher",{})]).concat(e)}(0,r,o);return tr.asStructOrDie(n+" [SpecSchema]",tr.objOfOnly(i.concat(t)),e)}),Ca=function(n){return Tn.deepMerge({uid:Ta("uid")},n)},Ea=function(n,t,e,r,o){var i=Ca(o),u=function(n){return en(n,(function(n){return n.fold(N.none,N.some,N.none,N.none).map((function(n){return He(n.name(),n.schema().concat([mo.snapshot(aa.original())]))})).toArray()}))}(e),a=ha(e),c=ka(n,t,i,u,[a]),s=pa(0,c,e),f=va(n,c,s.internals());return Tn.deepMerge(r(c,f,i,s.externals()),{"debug.sketcher":oe(n,o)})},Aa=tr.objOfOnly([Fe("name"),Fe("factory"),Fe("configFields"),We("apis",{}),We("extraApis",{})]),Ma=tr.objOfOnly([Fe("name"),Fe("factory"),Fe("configFields"),Fe("partFields"),We("apis",{}),We("extraApis",{})]),Da=function(n){var t=tr.asRawOrDie("Sketcher for "+n.name,Aa,n),e=Dn.map(t.apis,Ku.makeApi),r=Dn.map(t.extraApis,(function(n,t){return sr(n)}));return Tn.deepMerge({name:c.constant(t.name),partFields:c.constant([]),configFields:c.constant(t.configFields),sketch:function(n){return function(n,t,e,r){var o=Ca(r),i=ka(n,t,o,[],[]);return Tn.deepMerge(e(i,o),{"debug.sketcher":oe(n,r)})}(t.name,t.configFields,t.factory,n)}},e,r)},Ra=function(n){var t=tr.asRawOrDie("Sketcher for "+n.name,Ma,n),e=function(n,t){var e={};return X(t,(function(t){aa.asNamedPart(t).each((function(t){var r=function(n,t){return{uiType:da.placeholder(),owner:n,name:t}}(n,t.pname());e[t.name()]=function(e){var o=tr.asRawOrDie("Part: "+t.name()+" in "+n,tr.objOf(t.schema()),e);return Tn.deepMerge(r,{config:e,validated:o})}}))})),e}(t.name,t.partFields),r=Dn.map(t.apis,Ku.makeApi),o=Dn.map(t.extraApis,(function(n,t){return sr(n)}));return Tn.deepMerge({name:c.constant(t.name),partFields:c.constant(t.partFields),configFields:c.constant(t.configFields),sketch:function(n){return Ea(t.name,t.configFields,t.partFields,t.factory,n)},parts:c.constant(e)},r,o)},Ba=Da({name:"Button",factory:function(n,t){var e=function(n){var t=function(n,t){t.stop(),Hn(n)},e=vn.detect().deviceType.isTouch()?[ar.run(yn.tap(),t)]:[ar.run(s.click(),t),ar.run(s.mousedown(),(function(n,t){t.cut()}))];return ar.derive(tn([n.map((function(n){return ar.run(yn.execute(),(function(t,e){n(t),e.stop()}))})).toArray(),e]))}(n.action()),r=re(n.dom(),"attributes").bind(te("type")),o=re(n.dom(),"tag");return{uid:n.uid(),dom:n.dom(),components:n.components(),events:e,behaviours:Tn.deepMerge(Ar.derive([Io.config({}),Wu.config({mode:"execution",useSpace:!0,useEnter:!0})]),Gu(n.buttonBehaviours())),domModification:{attributes:Tn.deepMerge(r.fold((function(){return o.is("button")?{type:"button"}:{}}),(function(n){return{}})),{role:n.role().getOr("button")})},eventOrder:n.eventOrder()}},configFields:[We("uid",void 0),Fe("dom"),We("components",[]),zu("buttonBehaviours",[Io,Wu]),Ne("action"),Ne("role"),We("eventOrder",{})]}),Fa={events:function(n){return ar.derive([ar.abort(s.selectstart(),c.constant(!0))])},exhibit:function(n,t){return vr.nu({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}},Ia=Ar.create({fields:[],name:"unselecting",active:Fa}),Ha=function(n){var t,e,r,o=function(n,t){var e=(t||document).createElement("div");if(e.innerHTML=n,!e.hasChildNodes()||e.childNodes.length>1)throw console.error("HTML does not have a single root node",n),"HTML must have a single root node";return _n(e.childNodes[0])}(n),i=ut(o),u=(e=void 0!==(t=o).dom().attributes?t.dom().attributes:[],Q(e,(function(n,t){return"class"===t.name?n:Tn.deepMerge(n,oe(t.name,t.value))}),{})),a=(r=o,Array.prototype.slice.call(r.dom().classList,0)),c=0===i.length?{}:{innerHtml:It(o)};return Tn.deepMerge({tag:wt.name(o),classes:a,attributes:u},c)},Va=function(n){var t=function(n,t){return n.replace(/\${([^{}]*)}/g,(function(n,e){var r,o=t[e];return"string"==(r=typeof o)||"number"===r?o:n}))}(n,{prefix:Do.prefix()});return Ha(t)},Na=Va,ja=function(n){return{dom:Va(n)}},Pa=function(n){return Ar.derive([ko.config({toggleClass:Do.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),Co(n,(function(n,t){(t?ko.on:ko.off)(n)}))])},La=function(n,t,e){return Ba.sketch({dom:Na('<span class="${prefix}-toolbar-button ${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:t,buttonBehaviours:Tn.deepMerge(Ar.derive([Ia.config({})]),e)})},Wa=La,za=function(n,t,e,r){var o=Pa(e);return La(t,r,o)},Ga=function(n,t,e){return Math.max(t,Math.min(e,n))},$a="slider.change.value",Ua=vn.detect().deviceType.isTouch(),_a=function(n,t){In(n,$a,{value:t})},qa={setXFromEvent:function(n,t,e,r){return function(n){var t;return(t=n.event().raw(),Ua&&void 0!==t.touches&&1===t.touches.length?N.some(t.touches[0]):Ua&&void 0!==t.touches||Ua||void 0===t.clientX?N.none():N.some(t)).map((function(n){return n.clientX}))}(r).map((function(r){var o,i,u,a;return o=n,u=r,a=function(n,t,e,r,o,i,u){var a=e-t;if(r<n.left)return t-1;if(r>n.right)return e+1;var c,s,f,l,d=Math.min(n.right,Math.max(r,n.left))-n.left,m=Ga(d/n.width*a+t,t-1,e+1),g=Math.round(m);return i&&m>=t&&m<=e?(c=m,s=t,f=e,l=o,u.fold((function(){var n=c-s,t=Math.round(n/l)*l;return Ga(s+t,s-1,f+1)}),(function(n){var t=(c-n)%l,e=Math.round(t/l),r=Math.floor((c-n)/l),o=Math.floor((f-n)/l),i=n+Math.min(o,r+e)*l;return Math.max(n,i)}))):g}(e,(i=t).min(),i.max(),u,i.stepSize(),i.snapToGrid(),i.snapStart()),_a(o,a),r}))},setToLedge:function(n,t){_a(n,t.min()-1)},setToRedge:function(n,t){_a(n,t.max()+1)},moveLeftFromRedge:function(n,t){_a(n,t.max())},moveRightFromLedge:function(n,t){_a(n,t.min())},moveLeft:function(n,t){var e=function(n,t,e,r){return n<t?n:n>e?e:n===t?t-1:Math.max(t,n-r)}(t.value().get(),t.min(),t.max(),t.stepSize());_a(n,e)},moveRight:function(n,t){var e=function(n,t,e,r){return n>e?n:n<t?t:n===e?e+1:Math.min(e,n+r)}(t.value().get(),t.min(),t.max(),t.stepSize());_a(n,e)},changeEvent:c.constant($a)},Ka=vn.detect().deviceType.isTouch(),Xa=function(n,t){return aa.optional({name:n+"-edge",overrides:function(n){var e=ar.derive([ar.runActionExtra(s.touchstart(),t,[n])]),r=ar.derive([ar.runActionExtra(s.mousedown(),t,[n]),ar.runActionExtra(s.mousemove(),(function(n,e){e.mouseIsDown().get()&&t(n,e)}),[n])]);return{events:Ka?e:r}}})},Ya=[Xa("left",qa.setToLedge),Xa("right",qa.setToRedge),aa.required({name:"thumb",defaults:c.constant({dom:{styles:{position:"absolute"}}}),overrides:function(n){return{events:ar.derive([ar.redirectToPart(s.touchstart(),n,"spectrum"),ar.redirectToPart(s.touchmove(),n,"spectrum"),ar.redirectToPart(s.touchend(),n,"spectrum")])}}}),aa.required({schema:[$e("mouseIsDown",(function(){return Ur(!1)}))],name:"spectrum",overrides:function(n){var t=function(t,e){var r=t.element().dom().getBoundingClientRect();qa.setXFromEvent(t,n,r,e)},e=ar.derive([ar.run(s.touchstart(),t),ar.run(s.touchmove(),t)]),r=ar.derive([ar.run(s.mousedown(),t),ar.run(s.mousemove(),(function(e,r){n.mouseIsDown().get()&&t(e,r)}))]);return{behaviours:Ar.derive(Ka?[]:[Wu.config({mode:"special",onLeft:function(t){return qa.moveLeft(t,n),N.some(!0)},onRight:function(t){return qa.moveRight(t,n),N.some(!0)}}),Io.config({})]),events:Ka?e:r}}})],Ja={onLoad:function(n,t,e){t.store().manager().onLoad(n,t,e)},onUnload:function(n,t,e){t.store().manager().onUnload(n,t,e)},setValue:function(n,t,e,r){t.store().manager().setValue(n,t,e,r)},getValue:function(n,t,e){return t.store().manager().getValue(n,t,e)}},Qa={events:function(n,t){var e=n.resetOnDom()?[ar.runOnAttached((function(e,r){Ja.onLoad(e,n,t)})),ar.runOnDetached((function(e,r){Ja.onUnload(e,n,t)}))]:[br(n,t,Ja.onLoad)];return ar.derive(e)}},Za={memory:function(){var n=Ur(null);return Tr({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},dataset:function(){var n=Ur({});return Tr({readState:function(){return{mode:"dataset",dataset:n.get()}},set:n.set,get:n.get})},manual:function(){return Tr({readState:function(){}})},init:function(n){return n.store().manager().state(n)}},nc=function(n,t,e,r){t.store().getDataKey(),e.set({}),t.store().setData()(n,r),t.onSetValue()(n,r)},tc=[Ne("initialValue"),Fe("getFallbackEntry"),Fe("getDataKey"),Fe("setData"),mo.output("manager",{setValue:nc,getValue:function(n,t,e){var r=t.store().getDataKey()(n),o=e.get();return re(o,r).fold((function(){return t.store().getFallbackEntry()(r)}),(function(n){return n}))},onLoad:function(n,t,e){t.store().initialValue().each((function(r){nc(n,t,e,r)}))},onUnload:function(n,t,e){e.set({})},state:Za.dataset})],ec=[Fe("getValue"),We("setValue",c.noop),Ne("initialValue"),mo.output("manager",{setValue:function(n,t,e,r){t.store().setValue()(n,r),t.onSetValue()(n,r)},getValue:function(n,t,e){return t.store().getValue()(n)},onLoad:function(n,t,e){t.store().initialValue().each((function(e){t.store().setValue()(n,e)}))},onUnload:c.noop,state:kr.init})],rc=[Ne("initialValue"),mo.output("manager",{setValue:function(n,t,e,r){e.set(r),t.onSetValue()(n,r)},getValue:function(n,t,e){return e.get()},onLoad:function(n,t,e){t.store().initialValue().each((function(n){e.isNotSet()&&e.set(n)}))},onUnload:function(n,t,e){e.clear()},state:Za.memory})],oc=[ze("store",{mode:"memory"},tr.choose("mode",{memory:rc,manual:ec,dataset:tc})),mo.onHandler("onSetValue"),We("resetOnDom",!1)],ic=Ar.create({fields:oc,name:"representing",active:Qa,apis:Ja,extra:{setValueFrom:function(n,t){var e=ic.getValue(t);ic.setValue(n,e)}},state:Za}),uc=vn.detect().deviceType.isTouch(),ac=[Fe("min"),Fe("max"),We("stepSize",1),We("onChange",c.noop),We("onInit",c.noop),We("onDragStart",c.noop),We("onDragEnd",c.noop),We("snapToGrid",!1),Ne("snapStart"),Fe("getInitialValue"),zu("sliderBehaviours",[Wu,ic]),$e("value",(function(n){return Ur(n.min)}))].concat(uc?[]:[$e("mouseIsDown",(function(){return Ur(!1)}))]),cc=hi("width",(function(n){return n.dom().offsetWidth})),sc=function(n,t){cc.set(n,t)},fc=function(n){return cc.get(n)},lc=vn.detect().deviceType.isTouch(),dc=Ra({name:"Slider",configFields:ac,partFields:Ya,factory:function(n,t,e,r){var o=n.max()-n.min(),i=function(n){var t=n.element().dom().getBoundingClientRect();return(t.left+t.right)/2},u=function(t){return ba(t,n,"thumb")},a=function(t){var e,r,u,a,c=ba(t,n,"spectrum").element().dom().getBoundingClientRect(),s=t.element().dom().getBoundingClientRect(),f=(e=t,r=c,(a=(u=n).value().get())<u.min()?ya(e,u,"left-edge").fold((function(){return 0}),(function(n){return i(n)-r.left})):a>u.max()?ya(e,u,"right-edge").fold((function(){return r.width}),(function(n){return i(n)-r.left})):(u.value().get()-u.min())/o*r.width);return c.left-s.left+f},f=function(n){var t=a(n),e=u(n),r=fc(e.element())/2;li(e.element(),"left",t-r+"px")},l=function(t,e){var r=n.value().get(),o=u(t);return r!==e||pi(o.element(),"left").isNone()?(n.value().set(e),f(t),n.onChange()(t,o,e),N.some(!0)):N.none()},d=lc?[ar.run(s.touchstart(),(function(t,e){n.onDragStart()(t,u(t))})),ar.run(s.touchend(),(function(t,e){n.onDragEnd()(t,u(t))}))]:[ar.run(s.mousedown(),(function(t,e){e.stop(),n.onDragStart()(t,u(t)),n.mouseIsDown().set(!0)})),ar.run(s.mouseup(),(function(t,e){n.onDragEnd()(t,u(t)),n.mouseIsDown().set(!1)}))];return{uid:n.uid(),dom:n.dom(),components:t,behaviours:Tn.deepMerge(Ar.derive(tn([lc?[]:[Wu.config({mode:"special",focusIn:function(t){return ya(t,n,"spectrum").map(Wu.focusIn).map(c.constant(!0))}})],[ic.config({store:{mode:"manual",getValue:function(t){return n.value().get()}}})]])),Gu(n.sliderBehaviours())),events:ar.derive([ar.run(qa.changeEvent(),(function(n,t){l(n,t.event().value())})),ar.runOnAttached((function(t,e){n.value().set(n.getInitialValue()());var r=u(t);f(t),n.onInit()(t,r,n.value().get())}))].concat(d)),apis:{resetToMin:function(t){l(t,n.min())},resetToMax:function(t){l(t,n.max())},refresh:f},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(n,t){n.resetToMin(t)},resetToMax:function(n,t){n.resetToMax(t)},refresh:function(n,t){n.refresh(t)}}}),mc=function(n,t,e){return Wa(t,(function(){var r=e();n.setContextToolbar([{label:t+" group",items:r}])}),{})},gc=tr.objOfOnly([Fe("getInitialValue"),Fe("onChange"),Fe("category"),Fe("sizes")]),pc=function(n){var t=tr.asRawOrDie("SizeSlider",gc,n);return dc.sketch({dom:{tag:"div",classes:[Do.resolve("slider-"+t.category+"-size-container"),Do.resolve("slider"),Do.resolve("slider-size-container")]},onChange:function(n,e,r){var o;(o=r)>=0&&o<t.sizes.length&&t.onChange(r)},onDragStart:function(n,t){ko.on(t)},onDragEnd:function(n,t){ko.off(t)},min:0,max:t.sizes.length-1,stepSize:1,getInitialValue:t.getInitialValue,snapToGrid:!0,sliderBehaviours:Ar.derive([Eo(dc.refresh)]),components:[dc.parts().spectrum({dom:Na('<div class="${prefix}-slider-size-container"></div>'),components:[ja('<div class="${prefix}-slider-size-line"></div>')]}),dc.parts().thumb({dom:Na('<div class="${prefix}-slider-thumb"></div>'),behaviours:Ar.derive([ko.config({toggleClass:Do.resolve("thumb-active")})])})]})},vc=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],hc=function(n){var t,e,r=n.selection.getStart(),o=Kn(r),i=Kn(n.getBody()),u=(t=function(n){return Zn(i,n)},e=o,(wt.isElement(e)?N.some(e):ot(e)).map((function(n){return function(n,t,e){return t(n).orThunk((function(){return e(n)?N.none():function(n,t,e){for(var r=n.dom(),o=Sn.isFunction(e)?e:c.constant(!1);r.parentNode;){r=r.parentNode;var i=Kn(r),u=t(i);if(u.isSome())return u;if(o(i))break}return N.none()}(n,t,e)}))}(n,(function(n){return pi(n,"font-size")}),t).getOrThunk((function(){return gi(n,"font-size")}))})).getOr(""));return Z(vc,(function(n){return u===n})).getOr("medium")},yc={candidates:c.constant(vc),get:function(n){var t,e=hc(n);return(t=e,nn(vc,(function(n){return n===t}))).getOr(2)},apply:function(n,t){var e;(e=t,N.from(vc[e])).each((function(t){var e,r;r=t,hc(e=n)!==r&&e.execCommand("fontSize",!1,r)}))}},bc=yc.candidates(),Sc=function(n){var t=ue(n,"uid")?n.uid:Ta("memento");return{get:function(n){return n.getSystem().getByUid(t).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(t).fold(N.none,N.some)},asSpec:function(){return Tn.deepMerge(n,{uid:t})}}},xc=window.Promise?window.Promise:function(){var n=function(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],c(n,e(i,this),e(u,this))},t=n.immediateFn||"function"==typeof setImmediate&&setImmediate||function(n){setTimeout(n,1)};function e(n,t){return function(){n.apply(t,arguments)}}var r=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};function o(n){var e=this;null!==this._state?t((function(){var t=e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(t){return void n.reject(t)}n.resolve(r)}else(e._state?n.resolve:n.reject)(e._value)})):this._deferreds.push(n)}function i(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void c(e(t,n),e(i,this),e(u,this))}this._state=!0,this._value=n,a.call(this)}catch(n){u.call(this,n)}}function u(n){this._state=!1,this._value=n,a.call(this)}function a(){for(var n=0,t=this._deferreds.length;n<t;n++)o.call(this,this._deferreds[n]);this._deferreds=null}function c(n,t,e){var r=!1;try{n((function(n){r||(r=!0,t(n))}),(function(n){r||(r=!0,e(n))}))}catch(n){if(r)return;r=!0,e(n)}}return n.prototype.catch=function(n){return this.then(null,n)},n.prototype.then=function(t,e){var r=this;return new n((function(n,i){o.call(r,new function(n,t,e,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof t?t:null,this.resolve=e,this.reject=r}(t,e,n,i))}))},n.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&r(arguments[0])?arguments[0]:arguments);return new n((function(n,e){if(0===t.length)return n([]);var r=t.length;function o(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var a=u.then;if("function"==typeof a)return void a.call(u,(function(n){o(i,n)}),e)}t[i]=u,0==--r&&n(t)}catch(n){e(n)}}for(var i=0;i<t.length;i++)o(i,t[i])}))},n.resolve=function(t){return t&&"object"==typeof t&&t.constructor===n?t:new n((function(n){n(t)}))},n.reject=function(t){return new n((function(n,e){e(t)}))},n.race=function(t){return new n((function(n,e){for(var r=0,o=t.length;r<o;r++)t[r].then(n,e)}))},n}();function wc(){return new(Un("FileReader"))}var Oc=function(n){return function(n){return new xc((function(t){var e=new wc;e.onloadend=function(){t(e.result)},e.readAsDataURL(n)}))}(n).then((function(n){return n.split(",")[1]}))},Tc=function(n){var t=Sc({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:ar.derive([ar.cutter(s.click()),ar.run(s.change(),(function(t,e){var r,o,i;(r=e,o=r.event(),i=o.raw().target.files||o.raw().dataTransfer.files,N.from(i[0])).each((function(t){var e,r;e=n,function(n){return Oc(n)}(r=t).then((function(n){e.undoManager.transact((function(){var t=e.editorUpload.blobCache,o=t.create(Uu("mceu"),r,n);t.add(o);var i=e.dom.createHTML("img",{src:o.blobUri()});e.insertContent(i)}))}))}))}))])});return Ba.sketch({dom:Na('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[t.asSpec()],action:function(n){t.get(n).element().dom().click()}})},kc=function(n){return n.dom().textContent},Cc=function(n){return n.length>0},Ec=function(n){return null==n?"":n},Ac=function(n){var t=Kn(n.selection.getStart());return Uo(t,"a")},Mc=Ac,Dc=vn.detect(),Rc=function(n,t){var e=t.selection.getRng();n(),t.selection.setRng(e)},Bc=function(n,t){var e=ar.derive(t);return Ar.create({fields:[Fe("enabled")],name:n,active:{events:c.constant(e)}})},Fc=function(n,t){return{key:n,value:{config:{},me:Bc(n,t),configAsRaw:c.constant({}),initialConfig:{},state:Ar.noState()}}},Ic=[Fe("find")],Hc=Ar.create({fields:Ic,name:"composing",apis:{getCurrent:function(n,t,e){return t.find()(n)}}}),Vc=Da({name:"Container",factory:function(n,t){return{uid:n.uid(),dom:Tn.deepMerge({tag:"div",attributes:{role:"presentation"}},n.dom()),components:n.components(),behaviours:Gu(n.containerBehaviours()),events:n.events(),domModification:n.domModification(),eventOrder:n.eventOrder()}},configFields:[We("components",[]),zu("containerBehaviours",[]),We("events",{}),We("domModification",{}),We("eventOrder",{})]}),Nc=Da({name:"DataField",factory:function(n,t){return{uid:n.uid(),dom:n.dom(),behaviours:Tn.deepMerge(Ar.derive([ic.config({store:{mode:"memory",initialValue:n.getInitialValue()()}}),Hc.config({find:N.some})]),Gu(n.dataBehaviours())),events:ar.derive([ar.runOnAttached((function(t,e){ic.setValue(t,n.getInitialValue()())}))])}},configFields:[Fe("uid"),Fe("dom"),Fe("getInitialValue"),zu("dataBehaviours",[ic,Hc])]}),jc=function(n,t){if(void 0===t)throw new Error("Value.set was undefined");n.dom().value=t},Pc=function(n){return n.dom().value},Lc=[Ne("data"),We("inputAttributes",{}),We("inputStyles",{}),We("type","input"),We("tag","input"),We("inputClasses",[]),mo.onHandler("onSetValue"),We("styles",{}),Ne("placeholder"),We("eventOrder",{}),zu("inputBehaviours",[ic,Io]),We("selectOnFocus",!0)],Wc={schema:c.constant(Lc),behaviours:function(n){return Tn.deepMerge(Ar.derive([ic.config({store:{mode:"manual",initialValue:n.data().getOr(void 0),getValue:function(n){return Pc(n.element())},setValue:function(n,t){Pc(n.element())!==t&&jc(n.element(),t)}},onSetValue:n.onSetValue()}),Io.config({onFocus:!1===n.selectOnFocus()?c.noop:function(n){var t=n.element(),e=Pc(t);t.dom().setSelectionRange(0,e.length)}})]),Gu(n.inputBehaviours()))},dom:function(n){return{tag:n.tag(),attributes:Tn.deepMerge(ie([{key:"type",value:n.type()}].concat(n.placeholder().map((function(n){return{key:"placeholder",value:n}})).toArray())),n.inputAttributes()),styles:n.inputStyles(),classes:n.inputClasses()}}},zc=Da({name:"Input",configFields:Wc.schema(),factory:function(n,t){return{uid:n.uid(),dom:Wc.dom(n),components:[],behaviours:Wc.behaviours(n),eventOrder:n.eventOrder()}}}),Gc={exhibit:function(n,t){return vr.nu({attributes:ie([{key:t.tabAttr(),value:"true"}])})}},$c=[We("tabAttr","data-alloy-tabstop")],Uc=Ar.create({fields:$c,name:"tabstopping",active:Gc}),_c=function(n,t){var e=Sc(zc.sketch({placeholder:t,onSetValue:function(n,t){Fn(n,s.input())},inputBehaviours:Ar.derive([Hc.config({find:N.some}),Uc.config({}),Wu.config({mode:"execution"})]),selectOnFocus:!1})),r=Sc(Ba.sketch({dom:Na('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(n){var t=e.get(n);ic.setValue(t,"")}}));return{name:n,spec:Vc.sketch({dom:Na('<div class="${prefix}-input-container"></div>'),components:[e.asSpec(),r.asSpec()],containerBehaviours:Ar.derive([ko.config({toggleClass:Do.resolve("input-container-empty")}),Hc.config({find:function(n){return N.some(e.get(n))}}),Fc("input-clearing",[ar.run(s.input(),(function(n){var t=e.get(n);(ic.getValue(t).length>0?ko.off:ko.on)(n)}))])])})}},qc=function(n){return{name:n,spec:Nc.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return N.none()}})}},Kc=["input","button","textarea"],Xc=function(n){return on(Kc,wt.name(n.element()))},Yc=function(n){Vt(n.element(),"disabled","disabled")},Jc=function(n){Lt(n.element(),"disabled")},Qc=function(n){Vt(n.element(),"aria-disabled","true")},Zc=function(n){Vt(n.element(),"aria-disabled","false")},ns=function(n,t,e){t.disableClass().each((function(t){jr(n.element(),t)})),(Xc(n)?Yc:Qc)(n)},ts={enable:function(n,t,e){t.disableClass().each((function(t){Pr(n.element(),t)})),(Xc(n)?Jc:Zc)(n)},disable:ns,isDisabled:function(n){return Xc(n)?Pt(n.element(),"disabled"):"true"===jt(n.element(),"aria-disabled")},onLoad:function(n,t,e){t.disabled()&&ns(n,t)}},es={exhibit:function(n,t,e){return vr.nu({classes:t.disabled()?t.disableClass().map(an).getOr([]):[]})},events:function(n,t){return ar.derive([ar.abort(yn.execute(),(function(e,r){return ts.isDisabled(e,n,t)})),br(n,t,ts.onLoad)])}},rs=[We("disabled",!1),Ne("disableClass")],os=Ar.create({fields:rs,name:"disabling",active:es,apis:ts}),is=[zu("formBehaviours",[ic])],us=function(n){return"<alloy.field."+n+">"},as=function(n,t,e){return Tn.deepMerge({"debug.sketcher":{Form:e},uid:n.uid(),dom:n.dom(),components:t,behaviours:Tn.deepMerge(Ar.derive([ic.config({store:{mode:"manual",getValue:function(t){var e=function(n,t){var e=n.getSystem();return Dn.map(t.partUids(),(function(n,t){return c.constant(e.getByUid(n))}))}(t,n);return Dn.map(e,(function(n,t){return n().bind(Hc.getCurrent).map(ic.getValue)}))},setValue:function(t,e){Dn.each(e,(function(e,r){ya(t,n,r).each((function(n){Hc.getCurrent(n).each((function(n){ic.setValue(n,e)}))}))}))}}})]),Gu(n.formBehaviours())),apis:{getField:function(t,e){return ya(t,n,e).bind(Hc.getCurrent)}}})},cs=(Ku.makeApi((function(n,t,e){return n.getField(t,e)})),function(n){var t,e=(t=[],{field:function(n,e){return t.push(n),function(n,t,e){return{uiType:da.placeholder(),owner:"form",name:t,config:e,validated:{}}}(0,us(n),e)},record:function(){return t}}),r=n(e),o=e.record(),i=K(o,(function(n){return aa.required({name:n,pname:us(n)})}));return Ea("form",is,i,as,r)}),ss=function(){var n=Ur(N.none()),t=function(){n.get().each((function(n){n.destroy()}))};return{clear:function(){t(),n.set(N.none())},isSet:function(){return n.get().isSome()},set:function(e){t(),n.set(N.some(e))},run:function(t){n.get().each(t)}}},fs=function(){var n=Ur(N.none());return{clear:function(){n.set(N.none())},set:function(t){n.set(N.some(t))},isSet:function(){return n.get().isSome()},on:function(t){n.get().each(t)}}},ls=function(n){var t="navigateEvent",e=tr.objOf([Fe("fields"),We("maxFieldIndex",n.fields.length-1),Fe("onExecute"),Fe("getInitialValue"),$e("state",(function(){return{dialogSwipeState:fs(),currentScreen:Ur(0)}}))]),r=tr.asRawOrDie("SerialisedDialog",e,n),o=function(n,e,r){return Ba.sketch({dom:Na('<span class="${prefix}-icon-'+e+' ${prefix}-icon"></span>'),action:function(e){In(e,t,{direction:n})},buttonBehaviours:Ar.derive([os.config({disableClass:Do.resolve("toolbar-navigation-disabled"),disabled:!r})])})},i=function(n,t){var e=Lo(n.element(),"."+Do.resolve("serialised-dialog-screen"));$o(n.element(),"."+Do.resolve("serialised-dialog-chain")).each((function(n){r.state.currentScreen.get()+t>=0&&r.state.currentScreen.get()+t<e.length&&(pi(n,"left").each((function(r){var o=parseInt(r,10),i=fc(e[0]);li(n,"left",o-t*i+"px")})),r.state.currentScreen.set(r.state.currentScreen.get()+t))}))},u=function(n){var t=Lo(n.element(),"input");N.from(t[r.state.currentScreen.get()]).each((function(t){n.getSystem().getByDom(t).each((function(t){!function(n,t){n.getSystem().triggerFocus(t,n.element())}(n,t.element())}))}));var e=c.get(n);ni.highlightAt(e,r.state.currentScreen.get())},a=Sc(cs((function(n){return{dom:Na('<div class="${prefix}-serialised-dialog"></div>'),components:[Vc.sketch({dom:Na('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:K(r.fields,(function(t,e){return e<=r.maxFieldIndex?Vc.sketch({dom:Na('<div class="${prefix}-serialised-dialog-screen"></div>'),components:tn([[o(-1,"previous",e>0)],[n.field(t.name,t.spec)],[o(1,"next",e<r.maxFieldIndex)]])}):n.field(t.name,t.spec)}))})],formBehaviours:Ar.derive([Eo((function(n,t){var e;e=t,$o(n.element(),"."+Do.resolve("serialised-dialog-chain")).each((function(n){li(n,"left",-r.state.currentScreen.get()*e.width+"px")}))})),Wu.config({mode:"special",focusIn:function(n){u(n)},onTab:function(n){return i(n,1),N.some(!0)},onShiftTab:function(n){return i(n,-1),N.some(!0)}}),Fc("form-events",[ar.runOnAttached((function(n,t){r.state.currentScreen.set(0),r.state.dialogSwipeState.clear();var e=c.get(n);ni.highlightFirst(e),r.getInitialValue(n).each((function(t){ic.setValue(n,t)}))})),ar.runOnExecute(r.onExecute),ar.run(s.transitionend(),(function(n,t){"left"===t.event().raw().propertyName&&u(n)})),ar.run(t,(function(n,t){var e=t.event().direction();i(n,e)}))])])}}))),c=Sc({dom:Na('<div class="${prefix}-dot-container"></div>'),behaviours:Ar.derive([ni.config({highlightClass:Do.resolve("dot-active"),itemClass:Do.resolve("dot-item")})]),components:en(r.fields,(function(n,t){return t<=r.maxFieldIndex?[ja('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]}))});return{dom:Na('<div class="${prefix}-serializer-wrapper"></div>'),components:[a.asSpec(),c.asSpec()],behaviours:Ar.derive([Wu.config({mode:"special",focusIn:function(n){var t=a.get(n);Wu.focusIn(t)}}),Fc("serializer-wrapper-events",[ar.run(s.touchstart(),(function(n,t){r.state.dialogSwipeState.set(function(n){return{xValue:n,points:[]}}(t.event().raw().touches[0].clientX))})),ar.run(s.touchmove(),(function(n,t){r.state.dialogSwipeState.on((function(n){t.event().prevent(),r.state.dialogSwipeState.set(function(n,t){if(t===n.xValue)return n;var e=t-n.xValue>0?1:-1,r={direction:e,xValue:t};return{xValue:t,points:(0===n.points.length?[]:n.points[n.points.length-1].direction===e?n.points.slice(0,n.points.length-1):n.points).concat([r])}}(n,t.event().raw().touches[0].clientX))}))})),ar.run(s.touchend(),(function(n){r.state.dialogSwipeState.on((function(t){var e=a.get(n),r=-1*function(n){if(0===n.points.length)return 0;var t=n.points[0].direction,e=n.points[n.points.length-1].direction;return-1===t&&-1===e?-1:1===t&&1===e?1:0}(t);i(e,r)}))}))])])}},ds=f((function(n,t){return[{label:"the link group",items:[ls({fields:[_c("url","Type or paste URL"),_c("text","Link text"),_c("title","Link title"),_c("target","Link target"),qc("link")],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return N.some(function(n){return Ac(n).fold((function(){return{url:"",text:n.selection.getContent({format:"text"}),title:"",target:"",link:N.none()}}),(function(n){return e=kc(t=n),r=jt(t,"href"),o=jt(t,"title"),i=jt(t,"target"),{url:Ec(r),text:e!==r?Ec(e):"",title:Ec(o),target:Ec(i),link:N.some(t)};var t,e,r,o,i}))}(t))},onExecute:function(e){var r=ic.getValue(e);(function(n,t){t.url.filter(Cc).fold((function(){var e;e=n,t.link.bind(c.identity).each((function(n){e.execCommand("unlink")}))}),(function(e){var r,o,i=(r=t,(o={}).href=e,r.title.filter(Cc).each((function(n){o.title=n})),r.target.filter(Cc).each((function(n){o.target=n})),o);t.link.bind(c.identity).fold((function(){var r=t.text.filter(Cc).getOr(e);n.insertContent(n.dom.createHTML("a",i,n.dom.encode(r)))}),(function(n){var r=function(n,t,e){return e.text.filter(Cc).fold((function(){return jt(e=n,"href")===kc(e)?N.some(t):N.none();var e}),N.some)}(n,e,t);Nt(n,i),r.each((function(t){!function(n,t){n.dom().textContent=t}(n,t)}))}))}))})(t,r),n.restoreToolbar(),t.focus()}})]}]})),ms=function(n,t){return za(0,"link","link",(function(){var e=ds(n,t);n.setContextToolbar(e),function(n,t){(Dc.os.isAndroid()?Rc:c.apply)(t,n)}(t,(function(){n.focusToolbar()})),Mc(t).each((function(n){t.selection.select(n.dom())}))}))},gs=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],ps=Or.exactly(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),vs=Or.exactly(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn"]);function hs(n){var t=function(t){return function(){throw new Error("The component must be in a context to send: "+t+"\n"+zt(n().element())+" is not in context.")}};return vs({debugInfo:c.constant("fake"),triggerEvent:t("triggerEvent"),triggerFocus:t("triggerFocus"),triggerEscape:t("triggerEscape"),build:t("build"),addToWorld:t("addToWorld"),removeFromWorld:t("removeFromWorld"),addToGui:t("addToGui"),removeFromGui:t("removeFromGui"),getByUid:t("getByUid"),getByDom:t("getByDom"),broadcast:t("broadcast"),broadcastOn:t("broadcastOn")})}var ys,bs,Ss,xs,ws=function(n,t){var e={};return Dn.each(n,(function(n,r){Dn.each(n,(function(n,o){var i=ee(o,[])(e);e[o]=i.concat([t(r,n)])}))})),e},Os=function(n,t){return{name:c.constant(n),modification:t}},Ts=function(n,t,e){return n.length>1?Ut.error('Multiple behaviours have tried to change DOM "'+t+'". The guilty behaviours are: '+xe(K(n,(function(n){return n.name()})))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===n.length?Ut.value({}):Ut.value(n[0].modification().fold((function(){return{}}),(function(n){return oe(t,n)})))},ks=function(n,t){return Q(n,(function(e,r){var o=r.modification().getOr({});return e.bind((function(e){var r=Dn.mapToArray(o,(function(r,o){return void 0!==e[o]?(i=t,u=o,a=n,Ut.error("Mulitple behaviours have tried to change the _"+u+'_ "'+i+'". The guilty behaviours are: '+xe(en(a,(function(n){return void 0!==n.modification().getOr({})[u]?[n.name()]:[]})),null,2)+". This is not currently supported.")):Ut.value(oe(o,r));var i,u,a}));return ae(r,e)}))}),Ut.value({})).map((function(n){return oe(t,n)}))},Cs={classes:function(n,t){var e=en(n,(function(n){return n.modification().getOr([])}));return Ut.value(oe(t,e))},attributes:ks,styles:ks,domChildren:Ts,defChildren:Ts,innerHtml:Ts,value:Ts},Es=function(n){return n.handler},As=function(n,t){return{name:c.constant(n),handler:c.constant(t)}},Ms=function(n,t){var e=Dn.mapToArray(n,(function(n,e){return(1===n.length?Ut.value(n[0].handler()):function(n,t,e){var r,o,i=t[e];return i?function(n,t,e,r){var o=e.slice(0);try{var i=o.sort((function(e,o){var i=e[t](),u=o[t](),a=r.indexOf(i),c=r.indexOf(u);if(-1===a)throw new Error("The ordering for "+n+" does not have an entry for "+i+".\nOrder specified: "+xe(r,null,2));if(-1===c)throw new Error("The ordering for "+n+" does not have an entry for "+u+".\nOrder specified: "+xe(r,null,2));return a<c?-1:c<a?1:0}));return Ut.value(i)}catch(n){return Ut.error([n])}}("Event: "+e,"name",n,i).map((function(n){return function(n){var t,e,r,o,i=(t=n,e=function(n){return n.can},function(){var n=Array.prototype.slice.call(arguments,0);return Q(t,(function(t,r){return t&&e(r).apply(void 0,n)}),!0)}),u=(r=n,o=function(n){return n.abort},function(){var n=Array.prototype.slice.call(arguments,0);return Q(r,(function(t,e){return t||o(e).apply(void 0,n)}),!1)});return er({can:i,abort:u,run:function(){var t=Array.prototype.slice.call(arguments,0);X(n,(function(n){n.run.apply(void 0,t)}))}})}(K(n,(function(n){return n.handler()})))})):(r=e,o=n,Ut.error(["The event ("+r+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+xe(K(o,(function(n){return n.name()})),null,2)]))}(n,t,e)).map((function(r){var o,i=(o=function(n){return Sn.isFunction(n)?{can:c.constant(!0),abort:c.constant(!1),run:n}:n}(r),function(n,t){var e=Array.prototype.slice.call(arguments,0);o.abort.apply(void 0,e)?t.stop():o.can.apply(void 0,e)&&o.run.apply(void 0,e)}),u=n.length>1?Y(t,(function(t){return on(n,(function(n){return n.name()===t}))})).join(" > "):n[0].name();return oe(e,function(n,t){return{handler:n,purpose:c.constant(t)}}(i,u))}))}));return ae(e,{})},Ds=function(n){return n.domModification().fold((function(){return vr.nu({})}),vr.nu)},Rs=function(n){return n.events()},Bs=function(n,t){X(t,(function(t){jr(n,t)}))},Fs=function(n,t){X(t,(function(t){Pr(n,t)}))},Is=function(n){var t=qn(n.tag());Nt(t,n.attributes().getOr({})),Bs(t,n.classes().getOr([])),di(t,n.styles().getOr({})),function(n,t){var e=et(n).dom(),r=Kn(e.createDocumentFragment()),o=function(n,t){var e=(t||document).createElement("div");return e.innerHTML=n,ut(Kn(e))}(t,e);dt(r,o),gt(n),lt(n,r)}(t,n.innerHtml().getOr(""));var e=function(n){if(n.domChildren().isSome()&&n.defChildren().isSome())throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+dr.defToStr(n));return n.domChildren().fold((function(){var t=n.defChildren().getOr([]);return K(t,Hs)}),(function(n){return n}))}(n);return dt(t,e),n.value().each((function(n){jc(t,n)})),t},Hs=function(n){var t=dr.nu(n);return Is(t)},Vs=Is,Ns=function(n){var t=function(){return v},e=Ur(hs(t)),r=tr.getOrDie(function(n){return tr.asStruct("custom.definition",tr.objOfOnly([Ge("dom","dom",be.strict(),tr.objOfOnly([Fe("tag"),We("styles",{}),We("classes",[]),We("attributes",{}),Ne("value"),Ne("innerHtml")])),Fe("components"),Fe("uid"),We("events",{}),We("apis",c.constant({})),Ge("eventOrder","eventOrder",be.mergeWith({"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]}),tr.anyValue()),Ne("domModification"),mo.snapshot("originalSpec"),We("debug.sketcher","unknown")]),n)}(Tn.deepMerge(n,{behaviours:void 0}))),o=function(n){var t,e,r;return function(n,t){return function(n,t){var e=K(t,(function(n){return Ge(n.name(),n.name(),be.asOption(),tr.objOf([Fe("config"),We("state",kr)]))})),r=tr.asStruct("component.behaviours",tr.objOf(e),n.behaviours).fold((function(t){throw new Error(tr.formatError(t)+"\nComplete spec:\n"+xe(n,null,2))}),c.identity);return{list:t,data:Dn.map(r,(function(n){var t=n();return c.constant(t.map((function(n){return{config:n.config(),state:n.state().init(n.config())}})))}))}}(n,t)}(n,(e=re(t=n,"behaviours").getOr({}),r=Y(Dn.keys(e),(function(n){return void 0!==e[n]})),K(r,(function(n){return t.behaviours[n].me}))))}(n),i=function(n){return n.list}(o),u=function(n){return n.data}(o),a=function(n){var t,e={tag:n.dom().tag(),classes:n.dom().classes(),attributes:Tn.deepMerge((t=n,oe(Sa.idAttr(),t.uid())),n.dom().attributes()),styles:n.dom().styles(),domChildren:K(n.components(),(function(n){return n.element()}))};return dr.nu(Tn.deepMerge(e,n.dom().innerHtml().map((function(n){return oe("innerHtml",n)})).getOr({}),n.dom().value().map((function(n){return oe("value",n)})).getOr({})))}(r),s={"alloy.base.modification":Ds(r)},f=function(n,t,e,r){var o=Tn.deepMerge({},t);X(e,(function(t){o[t.name()]=t.exhibit(n,r)}));var i=ws(o,Os),u=Dn.map(i,(function(n,t){return en(n,(function(n){return n.modification().fold((function(){return[]}),(function(t){return[n]}))}))})),a=Dn.mapToArray(u,(function(n,t){return re(Cs,t).fold((function(){return Ut.error("Unknown field type: "+t)}),(function(e){return e(n,t)}))}));return ae(a,{}).map(vr.nu)}(u,s,i,a).getOrDie(),l=vr.merge(a,f),d=Vs(l),m={"alloy.base.behaviour":Rs(r)},g=function(n,t,e,r){var o=function(n,t,e){var r,o,i=Tn.deepMerge(e,(r=n,o={},X(t,(function(n){o[n.name()]=n.handlers(r)})),o));return ws(i,As)}(n,e,r);return Ms(o,t)}(u,r.eventOrder(),i,m).getOrDie(),p=Ur(r.components()),v=ps({getSystem:e.get,config:function(t){if(t===Ku.apiConfig())return r.apis();var e=u;return(Sn.isFunction(e[t.name()])?e[t.name()]:function(){throw new Error("Could not find "+t.name()+" in "+xe(n,null,2))})()},hasConfigured:function(n){return Sn.isFunction(u[n.name()])},spec:c.constant(n),readState:function(n){return u[n]().map((function(n){return n.state.readState()})).getOr("not enabled")},connect:function(n){e.set(n)},disconnect:function(){e.set(hs(t))},element:c.constant(d),syncComponents:function(){var n=ut(d),t=en(n,(function(n){return e.get().getByDom(n).fold((function(){return[]}),(function(n){return[n]}))}));p.set(t)},components:p.get,events:c.constant(g)});return v},js={events:ar.derive([ar.can(yn.focus(),(function(n,t){var e,r,o=t.event().originator(),i=t.event().target();return r=i,!(Zn(e=o,n.element())&&!Zn(e,r)&&(console.warn(yn.focus()+" did not get interpreted by the desired target. \nOriginator: "+zt(o)+"\nTarget: "+zt(i)+"\nCheck the "+yn.focus()+" event handlers"),1))}))])},Ps=function(n){var t=tr.asStructOrDie("external.component",tr.objOfOnly([Fe("element"),Ne("uid")]),n),e=Ur(hs());t.uid().each((function(n){!function(n,t){Vt(n,wa,t)}(t.element(),n)}));var r=ps({getSystem:e.get,config:N.none,hasConfigured:c.constant(!1),connect:function(n){e.set(n)},disconnect:function(){e.set(hs((function(){return r})))},element:c.constant(t.element()),spec:c.constant(n),readState:c.constant("No state"),syncComponents:c.noop,components:c.constant([]),events:c.constant({})});return Ku.premade(r)},Ls=function(n){return Ku.getPremade(n).fold((function(){return function(n){var t,e,r=n,o=(t=r,e=ee("components",[])(t),K(e,Ls)),i=Tn.deepMerge(js,r,oe("components",o));return Ut.value(Ns(i))}(Tn.deepMerge({uid:Ta("")},n)).getOrDie()}),(function(n){return n}))},Ws={build:Ls,premade:Ku.premade,external:Ps,text:function(n){var t=function(n,t){var e=(t||document).createTextNode(n);return _n(e)}(n);return Ps({element:t})}},zs="alloy.item-hover",Gs="alloy.item-focus",$s={hover:c.constant(zs),focus:c.constant(Gs),onHover:function(n){(no(n.element()).isNone()||Io.isFocused(n))&&(Io.isFocused(n)||Io.focus(n),In(n,zs,{item:n}))},onFocus:function(n){In(n,Gs,{item:n})}},Us=[Fe("data"),Fe("components"),Fe("dom"),Ne("toggling"),We("itemBehaviours",{}),We("ignoreFocus",!1),We("domModification",{}),mo.output("builder",(function(n){return{dom:Tn.deepMerge(n.dom(),{attributes:{role:n.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:Tn.deepMerge(Ar.derive([n.toggling().fold(ko.revoke,(function(n){return ko.config(Tn.deepMerge({aria:{mode:"checked"}},n))})),Io.config({ignore:n.ignoreFocus(),onFocus:function(n){$s.onFocus(n)}}),Wu.config({mode:"execution"}),ic.config({store:{mode:"memory",initialValue:n.data()}})]),n.itemBehaviours()),events:ar.derive([ar.runWithTarget(yn.tapOrClick(),Hn),ar.cutter(s.mousedown()),ar.run(s.mouseover(),$s.onHover),ar.run(yn.focusItem(),Io.focus)]),components:n.components(),domModification:n.domModification()}}))],_s=[Fe("dom"),Fe("components"),mo.output("builder",(function(n){return{dom:n.dom(),components:n.components(),events:ar.derive([ar.stopper(yn.focusItem())])}}))],qs=[aa.required({name:"widget",overrides:function(n){return{behaviours:Ar.derive([ic.config({store:{mode:"manual",getValue:function(t){return n.data()},setValue:function(){}}})])}}})],Ks={owner:c.constant("item-widget"),parts:c.constant(qs)},Xs=[Fe("uid"),Fe("data"),Fe("components"),Fe("dom"),We("autofocus",!1),We("domModification",{}),ha(Ks.parts()),mo.output("builder",(function(n){var t=pa(Ks.owner(),n,Ks.parts()),e=va(Ks.owner(),n,t.internals()),r=function(t){return ya(t,n,"widget").map((function(n){return Wu.focusIn(n),n}))},o=function(t,e){return Oi(e.event().target())?N.none():n.autofocus()?(e.setSource(t.element()),N.none()):N.none()};return Tn.deepMerge({dom:n.dom(),components:e,domModification:n.domModification(),events:ar.derive([ar.runOnExecute((function(n,t){r(n).each((function(n){t.stop()}))})),ar.run(s.mouseover(),$s.onHover),ar.run(yn.focusItem(),(function(t,e){n.autofocus()?r(t):Io.focus(t)}))]),behaviours:Ar.derive([ic.config({store:{mode:"memory",initialValue:n.data()}}),Io.config({onFocus:function(n){$s.onFocus(n)}}),Wu.config({mode:"special",onLeft:o,onRight:o,onEscape:function(t,e){return Io.isFocused(t)||n.autofocus()?n.autofocus()?(e.setSource(t.element()),N.none()):N.none():(Io.focus(t),N.some(!0))}})])})}))],Ys=tr.choose("type",{widget:Xs,item:Us,separator:_s}),Js=[aa.group({factory:{sketch:function(n){var t=tr.asStructOrDie("menu.spec item",Ys,n);return t.builder()(t)}},name:"items",unit:"item",defaults:function(n,t){var e=Ta("");return Tn.deepMerge({uid:e},t)},overrides:function(n,t){return{type:t.type,ignoreFocus:n.fakeFocus(),domModification:{classes:[n.markers().item()]}}}})],Qs=[Fe("value"),Fe("items"),Fe("dom"),Fe("components"),We("eventOrder",{}),zu("menuBehaviours",[ni,ic,Hc,Wu]),ze("movement",{mode:"menu",moveOnTab:!0},tr.choose("mode",{grid:[mo.initSize(),mo.output("config",(function(n,t){return{mode:"flatgrid",selector:"."+n.markers().item(),initSize:{numColumns:t.initSize().numColumns(),numRows:t.initSize().numRows()},focusManager:n.focusManager()}}))],menu:[We("moveOnTab",!0),mo.output("config",(function(n,t){return{mode:"menu",selector:"."+n.markers().item(),moveOnTab:t.moveOnTab(),focusManager:n.focusManager()}}))]})),mo.itemMarkers(),We("fakeFocus",!1),We("focusManager",ti()),mo.onHandler("onHighlight")],Zs={name:c.constant("Menu"),schema:c.constant(Qs),parts:c.constant(Js)},nf={focus:c.constant("alloy.menu-focus")},tf={make:function(n,t,e,r){return Tn.deepMerge({dom:Tn.deepMerge(n.dom(),{attributes:{role:"menu"}}),uid:n.uid(),behaviours:Tn.deepMerge(Ar.derive([ni.config({highlightClass:n.markers().selectedItem(),itemClass:n.markers().item(),onHighlight:n.onHighlight()}),ic.config({store:{mode:"memory",initialValue:n.value()}}),Hc.config({find:c.identity}),Wu.config(n.movement().config()(n,n.movement()))]),Gu(n.menuBehaviours())),events:ar.derive([ar.run($s.focus(),(function(n,t){var e=t.event();n.getSystem().getByDom(e.target()).each((function(e){ni.highlight(n,e),t.stop(),In(n,nf.focus(),{menu:n,item:e})}))})),ar.run($s.hover(),(function(n,t){var e=t.event().item();ni.highlight(n,e)}))]),components:t,eventOrder:n.eventOrder()})}},ef=Ra({name:"Menu",configFields:Zs.schema(),partFields:Zs.parts(),factory:tf.make}),rf=function(n,t,e,r){var o=n.getSystem().build(r);Rt(n,o,e)},of=function(n,t){return n.components()},uf={append:function(n,t,e,r){rf(n,0,lt,r)},prepend:function(n,t,e,r){rf(n,0,ft,r)},remove:function(n,t,e,r){var o=of(n);Z(o,(function(n){return Zn(r.element(),n.element())})).each(Bt)},set:function(n,t,e,r){(function(n){var t=n.components();X(t,Mt),gt(n.element()),n.syncComponents()})(n),function(n,t){var e=et(t),r=Zr(e).bind((function(n){var e=function(t){return Zn(n,t)};return e(t)?N.some(t):Xr(t,e)}));n();r.each((function(n){Zr(e).filter((function(t){return Zn(t,n)})).orThunk((function(){Jr(n)}))}))}((function(){var t=K(r,n.getSystem().build);X(t,(function(t){Dt(n,t)}))}),n.element())},contents:of},af=Ar.create({fields:[],name:"replacing",apis:uf}),cf=function(n,t,e,r){return re(e,r).bind((function(r){return re(n,r).bind((function(r){var o=cf(n,t,e,r);return N.some([r].concat(o))}))})).getOr([])},sf={make:function(n,t){var e,r,o,i,u,a,s=(e=Ur({}),r=Ur({}),o=Ur({}),i=Ur(N.none()),u=Ur(c.constant([])),{setContents:function(n,t,a,c){i.set(N.some(n)),e.set(a),r.set(t),u.set(c);var s=function(n,t){var e={};Dn.each(n,(function(n,t){X(n,(function(n){e[n]=t}))}));var r,o=t,i=(r=t,Dn.tupleMap(r,(function(n,t){return{k:n,v:t}}))),u=Dn.map(i,(function(n,t){return[t].concat(cf(e,o,i,t))}));return Dn.map(e,(function(n){return re(u,n).getOr([n])}))}(c(t),a);o.set(s)},expand:function(n){return re(e.get(),n).map((function(t){var e=re(o.get(),n).getOr([]);return[t].concat(e)}))},refresh:function(n){return re(o.get(),n)},collapse:function(n){return re(o.get(),n).bind((function(n){return n.length>1?N.some(n.slice(1)):N.none()}))},lookupMenu:a=function(n){return re(r.get(),n)},otherMenus:function(n){var t=u.get()(r.get());return function(n,t){return z(n,(function(n){return!P(t,n)}))}(Dn.keys(t),n)},getPrimary:function(){return i.get().bind(a)},getMenus:function(){return r.get()},clear:function(){e.set({}),r.set({}),o.set({}),i.set(N.none())},isClear:function(){return i.get().isNone()}}),f=function(e){var r,o,i=(r=e,o=n.data().menus(),Dn.map(o,(function(e,o){var i=ef.sketch(Tn.deepMerge(e,{value:o,items:e.items,markers:ne(t.markers,["item","selectedItem"]),fakeFocus:n.fakeFocus(),onHighlight:n.onHighlight(),focusManager:n.fakeFocus()?{get:function(n){return ni.getHighlighted(n).map((function(n){return n.element()}))},set:function(n,t){n.getSystem().getByDom(t).fold(c.noop,(function(t){ni.highlight(n,t)}))}}:ti()}));return r.getSystem().build(i)})));return s.setContents(n.data().primary(),i,n.data().expansions(),(function(n){return d(e,n)})),s.getPrimary()},l=function(n){return ic.getValue(n).value},d=function(t,e){return Dn.map(n.data().menus(),(function(n,t){return en(n.items,(function(n){return"separator"===n.type?[]:[n.data.value]}))}))},m=function(n,t){ni.highlight(n,t),ni.getHighlighted(t).orThunk((function(){return ni.getFirst(t)})).each((function(t){Vn(n,t.element(),yn.focusItem())}))},g=function(n,t){return ce(K(t,n.lookupMenu))},p=function(t,e,r){return N.from(r[0]).bind(e.lookupMenu).map((function(o){var i=g(e,r.slice(1));X(i,(function(t){jr(t.element(),n.markers().backgroundMenu())})),kt.inBody(o.element())||af.append(t,Ws.premade(o)),Fs(o.element(),[n.markers().backgroundMenu()]),m(t,o);var u=g(e,e.otherMenus(r));return X(u,(function(e){Fs(e.element(),[n.markers().backgroundMenu()]),n.stayInDom()||af.remove(t,e)})),o}))},v=function(t,e){var r=l(e);return s.expand(r).bind((function(r){return N.from(r[0]).bind(s.lookupMenu).each((function(r){kt.inBody(r.element())||af.append(t,Ws.premade(r)),n.onOpenSubmenu()(t,e,r),ni.highlightFirst(r)})),p(t,s,r)}))},h=function(t,e){var r=l(e);return s.collapse(r).bind((function(r){return p(t,s,r).map((function(r){return n.onCollapseMenu()(t,e,r),r}))}))},y=function(t){return function(e,r){return Uo(r.getSource(),"."+n.markers().item()).bind((function(n){return e.getSystem().getByDom(n).bind((function(n){return t(e,n)}))}))}},b=ar.derive([ar.run(nf.focus(),(function(n,t){var e=t.event().menu();ni.highlight(n,e)})),ar.runOnExecute((function(t,e){var r=e.event().target();return t.getSystem().getByDom(r).bind((function(e){return 0===l(e).indexOf("collapse-item")?h(t,e):v(t,e).orThunk((function(){return n.onExecute()(t,e)}))}))})),ar.runOnAttached((function(t,e){f(t).each((function(e){af.append(t,Ws.premade(e)),n.openImmediately()&&(m(t,e),n.onOpenMenu()(t,e))}))}))].concat(n.navigateOnHover()?[ar.run($s.hover(),(function(t,e){var r,o,i=e.event().item();r=t,o=l(i),s.refresh(o).bind((function(n){return p(r,s,n)})),v(t,i),n.onHover()(t,i)}))]:[]));return{uid:n.uid(),dom:n.dom(),behaviours:Tn.deepMerge(Ar.derive([Wu.config({mode:"special",onRight:y((function(n,t){return Oi(t.element())?N.none():v(n,t)})),onLeft:y((function(n,t){return Oi(t.element())?N.none():h(n,t)})),onEscape:y((function(t,e){return h(t,e).orThunk((function(){return n.onEscape()(t,e)}))})),focusIn:function(n,t){s.getPrimary().each((function(t){Vn(n,t.element(),yn.focusItem())}))}}),ni.config({highlightClass:n.markers().selectedMenu(),itemClass:n.markers().menu()}),Hc.config({find:function(n){return ni.getHighlighted(n)}}),af.config({})]),Gu(n.tmenuBehaviours())),eventOrder:n.eventOrder(),apis:{collapseMenu:function(n){ni.getHighlighted(n).each((function(t){ni.getHighlighted(t).each((function(t){h(n,t)}))}))}},events:b}},collapseItem:c.constant("collapse-item")},ff=Da({name:"TieredMenu",configFields:[mo.onStrictKeyboardHandler("onExecute"),mo.onStrictKeyboardHandler("onEscape"),mo.onStrictHandler("onOpenMenu"),mo.onStrictHandler("onOpenSubmenu"),mo.onHandler("onCollapseMenu"),We("openImmediately",!0),He("data",[Fe("primary"),Fe("menus"),Fe("expansions")]),We("fakeFocus",!1),mo.onHandler("onHighlight"),mo.onHandler("onHover"),mo.tieredMenuMarkers(),Fe("dom"),We("navigateOnHover",!0),We("stayInDom",!1),zu("tmenuBehaviours",[Wu,ni,Hc,af]),We("eventOrder",{})],apis:{collapseMenu:function(n,t){n.collapseMenu(t)}},factory:sf.make,extraApis:{tieredData:function(n,t,e){return{primary:n,menus:t,expansions:e}},singleData:function(n,t){return{primary:n,menus:oe(n,t),expansions:{}}},collapseItem:function(n){return{value:Uu(sf.collapseItem()),text:n}}}}),lf=function(n,t,e,r){return re(t.routes(),r.start()).map(c.apply).bind((function(n){return re(n,r.destination()).map(c.apply)}))},df=function(n,t,e,r){return lf(0,t,0,r).bind((function(n){return n.transition().map((function(t){return{transition:c.constant(t),route:c.constant(n)}}))}))},mf=function(n,t,e){var r,o,i;(r=n,o=t,i=e,gf(r,o,i).bind((function(n){return df(0,o,0,n)}))).each((function(e){var r=e.transition();Pr(n.element(),r.transitionClass()),Lt(n.element(),t.destinationAttr())}))},gf=function(n,t,e){var r=n.element();return Pt(r,t.destinationAttr())?N.some({start:c.constant(jt(n.element(),t.stateAttr())),destination:c.constant(jt(n.element(),t.destinationAttr()))}):N.none()},pf=function(n,t,e,r){mf(n,t,e),Pt(n.element(),t.stateAttr())&&jt(n.element(),t.stateAttr())!==r&&t.onFinish()(n,r),Vt(n.element(),t.stateAttr(),r)},vf={findRoute:lf,disableTransition:mf,getCurrentRoute:gf,jumpTo:pf,progressTo:function(n,t,e,r){var o,i;i=t,Pt((o=n).element(),i.destinationAttr())&&(Vt(o.element(),i.stateAttr(),jt(o.element(),i.destinationAttr())),Lt(o.element(),i.destinationAttr()));var u,a,s,f=(u=n,a=t,s=r,{start:c.constant(jt(u.element(),a.stateAttr())),destination:c.constant(s)});df(0,t,0,f).fold((function(){pf(n,t,e,r)}),(function(o){mf(n,t,e);var i=o.transition();jr(n.element(),i.transitionClass()),Vt(n.element(),t.destinationAttr(),r)}))},getState:function(n,t,e){var r=n.element();return Pt(r,t.stateAttr())?N.some(jt(r,t.stateAttr())):N.none()}},hf={events:function(n,t){return ar.derive([ar.run(s.transitionend(),(function(e,r){var o=r.event().raw();vf.getCurrentRoute(e,n,t).each((function(r){vf.findRoute(e,n,t,r).each((function(i){i.transition().each((function(i){o.propertyName===i.property()&&(vf.jumpTo(e,n,t,r.destination()),n.onTransition()(e,r))}))}))}))})),ar.runOnAttached((function(e,r){vf.jumpTo(e,n,t,n.initialState())}))])}},yf=[We("destinationAttr","data-transitioning-destination"),We("stateAttr","data-transitioning-state"),Fe("initialState"),mo.onHandler("onTransition"),mo.onHandler("onFinish"),Ie("routes",tr.setOf(Ut.value,tr.setOf(Ut.value,tr.objOfOnly([Le("transition",[Fe("property"),Fe("transitionClass")])]))))],bf=Ar.create({fields:yf,name:"transitioning",active:hf,apis:vf,extra:{createRoutes:function(n){var t={};return Dn.each(n,(function(n,e){var r=e.split("<->");t[r[0]]=oe(r[1],n),t[r[1]]=oe(r[0],n)})),t},createBistate:function(n,t,e){return ie([{key:n,value:oe(t,e)},{key:t,value:oe(n,e)}])},createTristate:function(n,t,e,r){return ie([{key:n,value:ie([{key:t,value:r},{key:e,value:r}])},{key:t,value:ie([{key:n,value:r},{key:e,value:r}])},{key:e,value:ie([{key:n,value:r},{key:t,value:r}])}])}}}),Sf=Do.resolve("scrollable"),xf={register:function(n){jr(n,Sf)},deregister:function(n){Pr(n,Sf)},scrollable:c.constant(Sf)},wf=function(n){return re(n,"format").getOr(n.title)},Of=function(n,t,e,r,o){return{data:{value:n,text:t},type:"item",dom:{tag:"div",classes:o?[Do.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:Do.resolve("format-matches"),selected:e},itemBehaviours:Ar.derive(o?[]:[Co(n,(function(n,t){(t?ko.on:ko.off)(n)}))]),components:[{dom:{tag:"div",attributes:{style:r},innerHtml:t}}]}},Tf=function(n,t,e,r){return{value:n,dom:{tag:"div"},components:[Ba.sketch({dom:{tag:"div",classes:[Do.resolve("styles-collapser")]},components:r?[{dom:{tag:"span",classes:[Do.resolve("styles-collapse-icon")]}},Ws.text(n)]:[Ws.text(n)],action:function(n){if(r){var t=e().get(n);ff.collapseMenu(t)}}}),{dom:{tag:"div",classes:[Do.resolve("styles-menu-items-container")]},components:[ef.parts().items({})],behaviours:Ar.derive([Fc("adhoc-scrollable-menu",[ar.runOnAttached((function(n,t){li(n.element(),"overflow-y","auto"),li(n.element(),"-webkit-overflow-scrolling","touch"),xf.register(n.element())})),ar.runOnDetached((function(n){mi(n.element(),"overflow-y"),mi(n.element(),"-webkit-overflow-scrolling"),xf.deregister(n.element())}))])])}],items:t,menuBehaviours:Ar.derive([bf.config({initialState:"after",routes:bf.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},kf=function(n){return J(n,(function(n,t){var e=function(n){return ue(n,"items")?(t=n,e=Tn.deepMerge(function(n,t){return function(n,t){var e={};return Dn.each(n,(function(n,r){on(t,r)||(e[r]=n)})),e}(n,t)}(t,["items"]),{menu:!0}),r=kf(t.items),{item:e,menus:Tn.deepMerge(r.menus,oe(t.title,r.items)),expansions:Tn.deepMerge(r.expansions,oe(t.title,t.title))}):{item:n,menus:{},expansions:{}};var t,e,r}(t);return{menus:Tn.deepMerge(n.menus,e.menus),items:[e.item].concat(n.items),expansions:Tn.deepMerge(n.expansions,e.expansions)}}),{menus:{},expansions:{},items:[]})},Cf={expand:kf},Ef=function(n,t){var e=function(t){return function(){return n.formatter.match(t)}},r=function(t){return function(){return n.formatter.getCssText(t)}},o=re(t,"style_formats").getOr(gs),i=function(t){return K(t,(function(t){if(ue(t,"items")){var o=i(t.items);return Tn.deepMerge((l=t,Tn.deepMerge(l,{isSelected:c.constant(!1),getPreview:c.constant("")})),{items:o})}return ue(t,"format")?(f=t,Tn.deepMerge(f,{isSelected:e(f.format),getPreview:r(f.format)})):(a=Uu((u=t).title),s=Tn.deepMerge(u,{format:a,isSelected:e(a),getPreview:r(a)}),n.formatter.register(a,s),s);var u,a,s,f,l}))};return i(o)},Af=["undo","bold","italic","link","image","bullist","styleselect"],Mf=function(n){var t=n.replace(/\|/g," ").trim();return t.length>0?t.split(/\s+/):[]},Df=function(n){return en(n,(function(n){return Sn.isArray(n)?Df(n):Mf(n)}))},Rf=function(n,t,e,r,o){var i=function(n,t){return function(e){if(n(e)){var r,o,i,u,a,s,f,l=Kn(e.target),d=function(){e.stopPropagation()},m=function(){e.preventDefault()},g=c.compose(m,d),p=(r=l,o=e.clientX,i=e.clientY,u=d,a=m,s=g,f=e,{target:c.constant(r),x:c.constant(o),y:c.constant(i),stop:u,prevent:a,kill:s,raw:c.constant(f)});t(p)}}}(e,r);return n.dom().addEventListener(t,i,o),{unbind:c.curry(Bf,n,t,i,o)}},Bf=function(n,t,e,r){n.dom().removeEventListener(t,e,r)},Ff=c.constant(!0),If=function(n,t,e){return function(n,t,e,r){return Rf(n,t,e,r,!1)}(n,t,Ff,e)},Hf=function(n,t,e){return function(n,t,e,r){return Rf(n,t,e,r,!0)}(n,t,Ff,e)},Vf=function(n){var t=n.matchMedia("(orientation: portrait)").matches;return{isPortrait:c.constant(t)}},Nf=Vf,jf=function(n,t){var e=Kn(n),r=null,o=If(e,"orientationchange",(function(){clearInterval(r);var e=Vf(n);t.onChange(e),i((function(){t.onReady(e)}))})),i=function(t){clearInterval(r);var e=n.innerHeight,o=0;r=setInterval((function(){e!==n.innerHeight?(clearInterval(r),t(N.some(n.innerHeight))):o>20&&(clearInterval(r),t(N.none())),o++}),50)};return{onAdjustment:i,destroy:function(){o.unbind()}}},Pf=function(n){var t=vn.detect().os.isiOS(),e=Vf(n).isPortrait();return t&&!e?n.screen.height:n.screen.width},Lf=function(n){return void 0===n.raw().touches||1!==n.raw().touches.length?N.none():N.some(n.raw().touches[0])},Wf=function(n){var t,e,r=Ur(N.none()),o=(t=function(t){r.set(N.none()),n.triggerEvent(yn.longpress(),t)},e=null,{cancel:function(){null!==e&&(clearTimeout(e),e=null)},schedule:function(){var n=arguments;e=setTimeout((function(){t.apply(null,n),e=null}),400)}}),i=ie([{key:s.touchstart(),value:function(n){return Lf(n).each((function(t){o.cancel();var e={x:c.constant(t.clientX),y:c.constant(t.clientY),target:n.target};o.schedule(e),r.set(N.some(e))})),N.none()}},{key:s.touchmove(),value:function(n){return o.cancel(),Lf(n).each((function(n){r.get().each((function(t){var e,o,i,u;e=n,o=t,i=Math.abs(e.clientX-o.x()),u=Math.abs(e.clientY-o.y()),(i>5||u>5)&&r.set(N.none())}))})),N.none()}},{key:s.touchend(),value:function(t){return o.cancel(),r.get().filter((function(n){return Zn(n.target(),t.target())})).map((function(e){return n.triggerEvent(yn.tap(),t)}))}}]);return{fireIfReady:function(n,t){return re(i,t).bind((function(t){return t(n)}))}}},zf=function(n){var t=Wf({triggerEvent:function(t,e){n.onTapContent(e)}});return{fireTouchstart:function(n){t.fireIfReady(n,"touchstart")},onTouchend:function(){return If(n.body(),"touchend",(function(n){t.fireIfReady(n,"touchend")}))},onTouchmove:function(){return If(n.body(),"touchmove",(function(n){t.fireIfReady(n,"touchmove")}))}}},Gf=vn.detect().os.version.major>=6,$f=function(n,t){var e=parseInt(jt(n,t),10);return isNaN(e)?0:e},Uf=(ys=wt.isText,bs=function(n){return ys(n)?N.from(n.dom().nodeValue):N.none()},Ss=vn.detect().browser,{get:function(n){if(!ys(n))throw new Error("Can only get text value of a text node");return xs(n).getOr("")},getOption:xs=Ss.isIE()&&10===Ss.version.major?function(n){try{return bs(n)}catch(n){return N.none()}}:bs,set:function(n,t){if(!ys(n))throw new Error("Can only set raw text value of a text node");n.dom().nodeValue=t}}),_f=_t([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),qf={before:_f.before,on:_f.on,after:_f.after,cata:function(n,t,e,r){return n.fold(t,e,r)},getStart:function(n){return n.fold(c.identity,c.identity,c.identity)}},Kf=_t([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Xf=zn("start","soffset","finish","foffset"),Yf={domRange:Kf.domRange,relative:Kf.relative,exact:Kf.exact,exactFromRange:function(n){return Kf.exact(n.start(),n.soffset(),n.finish(),n.foffset())},range:Xf,getWin:function(n){var t=n.match({domRange:function(n){return Kn(n.startContainer)},relative:function(n,t){return qf.getStart(n)},exact:function(n,t,e,r){return n}});return rt(t)}},Jf=function(n){return{left:c.constant(n.left),top:c.constant(n.top),right:c.constant(n.right),bottom:c.constant(n.bottom),width:c.constant(n.width),height:c.constant(n.height)}},Qf=function(n,t,e){var r,o,i=n.document.createRange();return r=i,t.fold((function(n){r.setStartBefore(n.dom())}),(function(n,t){r.setStart(n.dom(),t)}),(function(n){r.setStartAfter(n.dom())})),o=i,e.fold((function(n){o.setEndBefore(n.dom())}),(function(n,t){o.setEnd(n.dom(),t)}),(function(n){o.setEndAfter(n.dom())})),i},Zf=function(n,t,e,r,o){var i=n.document.createRange();return i.setStart(t.dom(),e),i.setEnd(r.dom(),o),i},nl=_t([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),tl=function(n,t,e){return t(Kn(e.startContainer),e.startOffset,Kn(e.endContainer),e.endOffset)},el=function(n,t){var e,r,o,i=(e=n,t.match({domRange:function(n){return{ltr:c.constant(n),rtl:N.none}},relative:function(n,t){return{ltr:f((function(){return Qf(e,n,t)})),rtl:f((function(){return N.some(Qf(e,t,n))}))}},exact:function(n,t,r,o){return{ltr:f((function(){return Zf(e,n,t,r,o)})),rtl:f((function(){return N.some(Zf(e,r,o,n,t))}))}}}));return(o=(r=i).ltr()).collapsed?r.rtl().filter((function(n){return!1===n.collapsed})).map((function(n){return nl.rtl(Kn(n.endContainer),n.endOffset,Kn(n.startContainer),n.startOffset)})).getOrThunk((function(){return tl(0,nl.ltr,o)})):tl(0,nl.ltr,o)},rl=(nl.ltr,nl.rtl,el),ol=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(n,t){var e=wt.name(n);return"input"===e?qf.after(n):on(["br","img"],e)?0===t?qf.before(n):qf.after(n):qf.on(n,t)}),il=function(n,t,e,r,o){!function(n,t){N.from(n.getSelection()).each((function(n){n.removeAllRanges(),n.addRange(t)}))}(n,Zf(n,t,e,r,o))},ul=function(n){var t=n.getSelection();return t.rangeCount>0?function(n){var t=Kn(n.anchorNode),e=Kn(n.focusNode);return function(n,t,e,r){var o=function(n,t,e,r){var o=et(n).dom().createRange();return o.setStart(n.dom(),t),o.setEnd(e.dom(),r),o}(n,t,e,r),i=Zn(n,e)&&t===r;return o.collapsed&&!i}(t,n.anchorOffset,e,n.focusOffset)?N.some(Yf.range(Kn(n.anchorNode),n.anchorOffset,Kn(n.focusNode),n.focusOffset)):function(n){if(n.rangeCount>0){var t=n.getRangeAt(0),e=n.getRangeAt(n.rangeCount-1);return N.some(Yf.range(Kn(t.startContainer),t.startOffset,Kn(e.endContainer),e.endOffset))}return N.none()}(n)}(t):N.none()},al=function(n,t,e,r,o){!function(n,t){rl(n,t).match({ltr:function(t,e,r,o){il(n,t,e,r,o)},rtl:function(t,e,r,o){var i=n.getSelection();i.setBaseAndExtent?i.setBaseAndExtent(t.dom(),e,r.dom(),o):i.extend?(i.collapse(t.dom(),e),i.extend(r.dom(),o)):il(n,r,o,t,e)}})}(n,function(n,t,e,r){var o=ol(n,t),i=ol(e,r);return Yf.relative(o,i)}(t,e,r,o))},cl=ul,sl=function(n,t){return function(n){var t=n.getClientRects(),e=t.length>0?t[0]:n.getBoundingClientRect();return e.width>0||e.height>0?N.some(e).map(Jf):N.none()}(function(n,t){return el(n,t).match({ltr:function(t,e,r,o){var i=n.document.createRange();return i.setStart(t.dom(),e),i.setEnd(r.dom(),o),i},rtl:function(t,e,r,o){var i=n.document.createRange();return i.setStart(r.dom(),o),i.setEnd(t.dom(),e),i}})}(n,t))},fl=function(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom,width:c.constant(2),height:n.height}},ll=function(n){return{left:c.constant(n.left),top:c.constant(n.top),right:c.constant(n.right),bottom:c.constant(n.bottom),width:c.constant(n.width),height:c.constant(n.height)}},dl=function(n){var t=n.getSelection();return void 0!==t&&t.rangeCount>0?function(n){if(n.collapsed){var t=Kn(n.startContainer);return ot(t).bind((function(e){var r=Yf.exact(t,n.startOffset,e,function(n){return"img"===wt.name(n)?1:function(n){return Uf.getOption(n)}(n).fold((function(){return ut(n).length}),(function(n){return n.length}))}(e));return sl(n.startContainer.ownerDocument.defaultView,r).map(fl).map(an)})).getOr([])}return K(n.getClientRects(),ll)}(t.getRangeAt(0)):[]},ml="data-"+Do.resolve("last-outer-height"),gl=function(n,t){Vt(n,ml,t)},pl=function(n){return{top:c.constant(n.top()),bottom:c.constant(n.top()+n.height())}},vl=function(n){return N.some(Kn(n.dom().contentWindow.document.body))},hl=function(n){return N.some(Kn(n.dom().contentWindow.document))},yl=function(n){return N.from(n.dom().contentWindow)},bl=function(n){return yl(n).bind(cl)},Sl=function(n){return n.getFrame()},xl=function(n,t){return function(e){return e[n].getOrThunk((function(){var n=Sl(e);return function(){return t(n)}}))()}},wl=function(n,t,e,r){return n[e].getOrThunk((function(){return function(n){return If(t,r,n)}}))},Ol=function(n){return{left:c.constant(n.left),top:c.constant(n.top),right:c.constant(n.right),bottom:c.constant(n.bottom),width:c.constant(n.width),height:c.constant(n.height)}},Tl={getBody:xl("getBody",vl),getDoc:xl("getDoc",hl),getWin:xl("getWin",yl),getSelection:xl("getSelection",bl),getFrame:Sl,getActiveApi:function(n){var t=Sl(n);return vl(t).bind((function(e){return hl(t).bind((function(r){return yl(t).map((function(o){var i=Kn(r.dom().documentElement),u=n.getCursorBox.getOrThunk((function(){return function(){return function(n){return ul(n).map((function(n){return Yf.exact(n.start(),n.soffset(),n.finish(),n.foffset())}))}(o).bind((function(n){return sl(o,n).orThunk((function(){return cl(o).filter((function(n){return Zn(n.start(),n.finish())&&n.soffset()===n.foffset()})).bind((function(n){var t=n.start().dom().getBoundingClientRect();return t.width>0||t.height>0?N.some(t).map(Ol):N.none()}))}))}))}})),a=n.setSelection.getOrThunk((function(){return function(n,t,e,r){al(o,n,t,e,r)}})),s=n.clearSelection.getOrThunk((function(){return function(){!function(n){n.getSelection().removeAllRanges()}(o)}}));return{body:c.constant(e),doc:c.constant(r),win:c.constant(o),html:c.constant(i),getSelection:c.curry(bl,t),setSelection:a,clearSelection:s,frame:c.constant(t),onKeyup:wl(n,r,"onKeyup","keyup"),onNodeChanged:wl(n,r,"onNodeChanged","selectionchange"),onDomChanged:n.onDomChanged,onScrollToCursor:n.onScrollToCursor,onScrollToElement:n.onScrollToElement,onToReading:n.onToReading,onToEditing:n.onToEditing,onToolbarScrollStart:n.onToolbarScrollStart,onTouchContent:n.onTouchContent,onTapContent:n.onTapContent,onTouchToolstrip:n.onTouchToolstrip,getCursorBox:u}}))}))}))}},kl="data-ephox-mobile-fullscreen-style",Cl="position:absolute!important;",El="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;",Al=vn.detect().os.isAndroid(),Ml=function(n,t){var e,r=function(n){return function(t){var e=jt(t,"style"),r=void 0===e?"no-styles":e.trim();r!==n&&(Vt(t,kl,r),Vt(t,"style",n))}},o=jo(n,"*"),i=en(o,(function(n){return Po(n,"*")})),u=void 0!==(e=gi(t,"background-color"))&&""!==e?"background-color:"+e+"!important":"background-color:rgb(255,255,255)!important;";X(i,r("display:none!important;")),X(o,r(Cl+El+u)),r((!0===Al?"":Cl)+El+u)(n)},Dl=function(){var n=Yn("[data-ephox-mobile-fullscreen-style]");X(n,(function(n){var t=jt(n,kl);"no-styles"!==t?Vt(n,"style",t):Lt(n,"style"),Lt(n,kl)}))},Rl=function(){var n=zo("head").getOrDie(),t=zo('meta[name="viewport"]').getOrThunk((function(){var t=qn("meta");return Vt(t,"name","viewport"),lt(n,t),t})),e=jt(t,"content");return{maximize:function(){Vt(t,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){null!=e&&e.length>0?Vt(t,"content",e):Vt(t,"content","user-scalable=yes")}}},Bl=function(n,t){var e=Rl(),r=ss(),o=ss();return{enter:function(){t.hide(),jr(n.container,Do.resolve("fullscreen-maximized")),jr(n.container,Do.resolve("android-maximized")),e.maximize(),jr(n.body,Do.resolve("android-scroll-reload")),r.set(function(n,t){var e=Kn(t.document.body),r=If(Kn(n),"resize",(function(){(function(n,t){var e=$f(t,ml),r=n.innerHeight;return e>r?N.some(e-r):N.none()})(n,e).each((function(n){var e,r;(e=t,r=dl(e),r.length>0?N.some(r[0]).map(pl):N.none()).each((function(e){var r,o,i,u=(r=t,i=n,(o=e).top()>r.innerHeight||o.bottom()>r.innerHeight?Math.min(i,o.bottom()-r.innerHeight+50):0);0!==u&&t.scrollTo(t.pageXOffset,t.pageYOffset+u)}))})),gl(e,n.innerHeight)}));return gl(e,n.innerHeight),{toEditing:function(){!function(n){n.focus();var t=Kn(n.document.body);(Zr().exists((function(n){return on(["input","textarea"],wt.name(n))}))?function(n){setTimeout((function(){n()}),0)}:c.apply)((function(){Zr().each(Qr),Jr(t)}))}(t)},destroy:function(){r.unbind()}}}(n.win,Tl.getWin(n.editor).getOrDie("no"))),Tl.getActiveApi(n.editor).each((function(t){Ml(n.container,t.body()),o.set(function(n,t,e){var r=zf(n),o=et(t),i=function(n){return!Zn(n.start(),n.finish())||n.soffset()!==n.foffset()},u=function(){var r=n.doc().dom().hasFocus()&&n.getSelection().exists(i);e.getByDom(t).each(!0===(r||Zr(o).filter((function(n){return"input"===wt.name(n)})).exists((function(n){return n.dom().selectionStart!==n.dom().selectionEnd})))?ko.on:ko.off)},a=[If(n.body(),"touchstart",(function(t){n.onTouchContent(),r.fireTouchstart(t)})),r.onTouchmove(),r.onTouchend(),If(t,"touchstart",(function(t){n.onTouchToolstrip()})),n.onToReading((function(){Qr(n.body())})),n.onToEditing(c.noop),n.onScrollToCursor((function(t){t.preventDefault(),n.getCursorBox().each((function(t){var e=n.win(),r=t.top()>e.innerHeight||t.bottom()>e.innerHeight?t.bottom()-e.innerHeight+50:0;0!==r&&e.scrollTo(e.pageXOffset,e.pageYOffset+r)}))}))].concat(!0===Gf?[]:[If(Kn(n.win()),"blur",(function(){e.getByDom(t).each(ko.off)})),If(o,"select",u),If(n.doc(),"selectionchange",u)]);return{destroy:function(){X(a,(function(n){n.unbind()}))}}}(t,n.toolstrip,n.alloy))}))},exit:function(){e.restore(),t.show(),Pr(n.container,Do.resolve("fullscreen-maximized")),Pr(n.container,Do.resolve("android-maximized")),Dl(),Pr(n.body,Do.resolve("android-scroll-reload")),o.clear(),r.clear()}}},Fl=function(n,t){var e=null;return{cancel:function(){null!==e&&(clearTimeout(e),e=null)},throttle:function(){var r=arguments;null!==e&&clearTimeout(e),e=setTimeout((function(){n.apply(null,r),e=null,r=null}),t)}}},Il=function(n,t){var e=Sc(Vc.sketch({dom:Na('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:Ar.derive([ko.config({toggleClass:Do.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),r=function(n,t){var e=null;return{cancel:function(){null!==e&&(clearTimeout(e),e=null)},throttle:function(){var t=arguments;null===e&&(e=setTimeout((function(){n.apply(null,t),e=null,t=null}),200))}}}(n);return Vc.sketch({dom:Na('<div class="${prefix}-disabled-mask"></div>'),components:[Vc.sketch({dom:Na('<div class="${prefix}-content-container"></div>'),components:[Ba.sketch({dom:Na('<div class="${prefix}-content-tap-section"></div>'),components:[e.asSpec()],action:function(n){r.throttle()},buttonBehaviours:Ar.derive([ko.config({toggleClass:Do.resolve("mask-tap-icon-selected")})])})]})]})},Hl=tr.objOf([He("editor",[Fe("getFrame"),Ne("getBody"),Ne("getDoc"),Ne("getWin"),Ne("getSelection"),Ne("setSelection"),Ne("clearSelection"),Ne("cursorSaver"),Ne("onKeyup"),Ne("onNodeChanged"),Ne("getCursorBox"),Fe("onDomChanged"),We("onTouchContent",c.noop),We("onTapContent",c.noop),We("onTouchToolstrip",c.noop),We("onScrollToCursor",c.constant({unbind:c.noop})),We("onScrollToElement",c.constant({unbind:c.noop})),We("onToEditing",c.constant({unbind:c.noop})),We("onToReading",c.constant({unbind:c.noop})),We("onToolbarScrollStart",c.identity)]),Fe("socket"),Fe("toolstrip"),Fe("dropup"),Fe("toolbar"),Fe("container"),Fe("alloy"),$e("win",(function(n){return et(n.socket).dom().defaultView})),$e("body",(function(n){return Kn(n.socket.dom().ownerDocument.body)})),We("translate",c.identity),We("setReadOnly",c.noop)]),Vl=[We("shell",!0),zu("toolbarBehaviours",[af])],Nl=[aa.optional({name:"groups",overrides:function(n){return{behaviours:Ar.derive([af.config({})])}}})],jl={name:c.constant("Toolbar"),schema:c.constant(Vl),parts:c.constant(Nl)},Pl=Ra({name:"Toolbar",configFields:jl.schema(),partFields:jl.parts(),factory:function(n,t,e,r){var o=function(t){return n.shell()?N.some(t):ya(t,n,"groups")},i=n.shell()?{behaviours:[af.config({})],components:[]}:{behaviours:[],components:t};return{uid:n.uid(),dom:n.dom(),components:i.components,behaviours:Tn.deepMerge(Ar.derive(i.behaviours),Gu(n.toolbarBehaviours())),apis:{setGroups:function(n,t){o(n).fold((function(){throw console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")}),(function(n){af.set(n,t)}))}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(n,t,e){n.setGroups(t,e)}}}),Ll=[Fe("items"),mo.markers(["itemClass"]),zu("tgroupBehaviours",[Wu])],Wl=[aa.group({name:"items",unit:"item",overrides:function(n){return{domModification:{classes:[n.markers().itemClass()]}}}})],zl={name:c.constant("ToolbarGroup"),schema:c.constant(Ll),parts:c.constant(Wl)},Gl=Ra({name:"ToolbarGroup",configFields:zl.schema(),partFields:zl.parts(),factory:function(n,t,e,r){return Tn.deepMerge({dom:{attributes:{role:"toolbar"}}},{uid:n.uid(),dom:n.dom(),components:t,behaviours:Tn.deepMerge(Ar.derive([Wu.config({mode:"flow",selector:"."+n.markers().itemClass()})]),Gu(n.tgroupBehaviours())),"debug.sketcher":e["debug.sketcher"]})}}),$l="data-"+Do.resolve("horizontal-scroll"),Ul=function(n){return n.dom().scrollTop>0||function(n){n.dom().scrollTop=1;var t=0!==n.dom().scrollTop;return n.dom().scrollTop=0,t}(n)},_l=function(n){return n.dom().scrollLeft>0||function(n){n.dom().scrollLeft=1;var t=0!==n.dom().scrollLeft;return n.dom().scrollLeft=0,t}(n)},ql=function(n){return"true"===jt(n,$l)?_l:Ul},Kl=function(n,t){return If(n,"touchmove",(function(n){Uo(n.target(),t).filter(ql).fold((function(){n.raw().preventDefault()}),c.noop)}))};function Xl(){var n=function(n){var t=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:Na('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+t+'"></div>'),tgroupBehaviours:Ar.derive([Fc("adhoc-scrollable-toolbar",!0===n.scrollable?[ar.runOnInit((function(n,t){li(n.element(),"overflow-x","auto"),function(n){Vt(n,$l,"true")}(n.element()),xf.register(n.element())}))]:[])]),components:[Vc.sketch({components:[Gl.parts().items({})]})],markers:{itemClass:Do.resolve("toolbar-group-item")},items:n.items}},t=Ws.build(Pl.sketch({dom:Na('<div class="${prefix}-toolbar"></div>'),components:[Pl.parts().groups({})],toolbarBehaviours:Ar.derive([ko.config({toggleClass:Do.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),Wu.config({mode:"cyclic"})]),shell:!0})),e=Ws.build(Vc.sketch({dom:{classes:[Do.resolve("toolstrip")]},components:[Ws.premade(t)],containerBehaviours:Ar.derive([ko.config({toggleClass:Do.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),r=function(){Pl.setGroups(t,o.get()),ko.off(t)},o=Ur([]);return{wrapper:c.constant(e),toolbar:c.constant(t),createGroups:function(t){return K(t,c.compose(Gl.sketch,n))},setGroups:function(n){o.set(n),r()},setContextToolbar:function(n){ko.on(t),Pl.setGroups(t,n)},restoreToolbar:function(){ko.isOn(t)&&r()},refresh:function(){Pl.refresh(t)},focus:function(){Wu.focusIn(t)}}}var Yl=function(n,t){af.append(n,Ws.premade(t))},Jl=function(n,t){af.remove(n,t)},Ql=function(n){return Ws.build(Ba.sketch({dom:Na('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){n.run((function(n){n.setReadOnly(!1)}))}}))},Zl=function(){return Ws.build(Vc.sketch({dom:Na('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:Ar.derive([af.config({})])}))},nd=function(n,t,e,r){(!0===e?$r.toAlpha:$r.toOmega)(r),(e?Yl:Jl)(n,t)},td=function(n,t){return t.getAnimationRoot().fold((function(){return n.element()}),(function(t){return t(n)}))},ed=function(n){return n.dimension().property()},rd=function(n,t){return n.dimension().getDimension()(t)},od=function(n,t){var e=td(n,t);Fs(e,[t.shrinkingClass(),t.growingClass()])},id=function(n,t){Pr(n.element(),t.openClass()),jr(n.element(),t.closedClass()),li(n.element(),ed(t),"0px"),vi(n.element())},ud=function(n,t){Pr(n.element(),t.closedClass()),jr(n.element(),t.openClass()),mi(n.element(),ed(t))},ad=function(n,t,e){e.setCollapsed(),li(n.element(),ed(t),rd(t,n.element())),vi(n.element());var r=td(n,t);jr(r,t.shrinkingClass()),id(n,t),t.onStartShrink()(n)},cd=function(n,t,e){var r=function(n,t){ud(n,t);var e=rd(t,n.element());return id(n,t),e}(n,t),o=td(n,t);jr(o,t.growingClass()),ud(n,t),li(n.element(),ed(t),r),e.setExpanded(),t.onStartGrow()(n)},sd=function(n,t,e){var r=td(n,t);return!0===Lr(r,t.growingClass())},fd=function(n,t,e){var r=td(n,t);return!0===Lr(r,t.shrinkingClass())},ld={grow:function(n,t,e){e.isExpanded()||cd(n,t,e)},shrink:function(n,t,e){e.isExpanded()&&ad(n,t,e)},immediateShrink:function(n,t,e){var r,o;e.isExpanded()&&(r=n,o=t,e.setCollapsed(),li(r.element(),ed(o),rd(o,r.element())),vi(r.element()),od(r,o),id(r,o),o.onStartShrink()(r),o.onShrunk()(r))},hasGrown:function(n,t,e){return e.isExpanded()},hasShrunk:function(n,t,e){return e.isCollapsed()},isGrowing:sd,isShrinking:fd,isTransitioning:function(n,t,e){return!0===sd(n,t)||!0===fd(n,t)},toggleGrow:function(n,t,e){(e.isExpanded()?ad:cd)(n,t,e)},disableTransitions:od},dd={exhibit:function(n,t){return t.expanded()?vr.nu({classes:[t.openClass()],styles:{}}):vr.nu({classes:[t.closedClass()],styles:oe(t.dimension().property(),"0px")})},events:function(n,t){return ar.derive([ar.run(s.transitionend(),(function(e,r){r.event().raw().propertyName===n.dimension().property()&&(ld.disableTransitions(e,n,t),t.isExpanded()&&mi(e.element(),n.dimension().property()),(t.isExpanded()?n.onGrown():n.onShrunk())(e,r))}))])}},md=[Fe("closedClass"),Fe("openClass"),Fe("shrinkingClass"),Fe("growingClass"),Ne("getAnimationRoot"),mo.onHandler("onShrunk"),mo.onHandler("onStartShrink"),mo.onHandler("onGrown"),mo.onHandler("onStartGrow"),We("expanded",!1),Ie("dimension",tr.choose("property",{width:[mo.output("property","width"),mo.output("getDimension",(function(n){return fc(n)+"px"}))],height:[mo.output("property","height"),mo.output("getDimension",(function(n){return bi(n)+"px"}))]}))],gd={init:function(n){var t=Ur(n.expanded());return Tr({isExpanded:function(){return!0===t.get()},isCollapsed:function(){return!1===t.get()},setCollapsed:c.curry(t.set,!1),setExpanded:c.curry(t.set,!0),readState:function(){return"expanded: "+t.get()}})}},pd=Ar.create({fields:md,name:"sliding",active:dd,apis:ld,state:gd}),vd=function(n,t){var e=Ws.build(Vc.sketch({dom:{tag:"div",classes:Do.resolve("dropup")},components:[],containerBehaviours:Ar.derive([af.config({}),pd.config({closedClass:Do.resolve("dropup-closed"),openClass:Do.resolve("dropup-open"),shrinkingClass:Do.resolve("dropup-shrinking"),growingClass:Do.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(e){n(),t(),af.set(e,[])},onGrown:function(e){n(),t()}}),Eo((function(n,t){r(c.noop)}))])})),r=function(n){window.requestAnimationFrame((function(){n(),pd.shrink(e)}))};return{appear:function(n,t,r){!0===pd.hasShrunk(e)&&!1===pd.isTransitioning(e)&&window.requestAnimationFrame((function(){t(r),af.set(e,[n()]),pd.grow(e)}))},disappear:r,component:c.constant(e),element:e.element}},hd=vn.detect().browser.isFirefox(),yd=tr.objOfOnly([Ve("triggerEvent"),Ve("broadcastEvent"),We("stopBackspace",!0)]),bd=function(n,t){var e=re(n,"target").map((function(n){return n()})).getOr(t);return Ur(e)},Sd=_t([{stopped:[]},{resume:["element"]},{complete:[]}]),xd=function(n,t,e,r,o,i){var u=n(t,r),a=function(n,t){var e=Ur(!1),r=Ur(!1);return{stop:function(){e.set(!0)},cut:function(){r.set(!0)},isStopped:e.get,isCut:r.get,event:c.constant(n),setSource:t.set,getSource:t.get}}(e,o);return u.fold((function(){return i.logEventNoHandlers(t,r),Sd.complete()}),(function(n){var e=n.descHandler();return Es(e)(a),a.isStopped()?(i.logEventStopped(t,n.element(),e.purpose()),Sd.stopped()):a.isCut()?(i.logEventCut(t,n.element(),e.purpose()),Sd.complete()):ot(n.element()).fold((function(){return i.logNoParent(t,n.element(),e.purpose()),Sd.complete()}),(function(r){return i.logEventResponse(t,n.element(),e.purpose()),Sd.resume(r)}))}))},wd=function(n,t,e,r,o,i){return xd(n,t,e,r,o,i).fold((function(){return!0}),(function(r){return wd(n,t,e,r,o,i)}),(function(){return!1}))},Od=function(n,t,e,r,o){var i=bd(e,r);return wd(n,t,e,r,i,o)},Td=Od,kd=function(n,t,e){return function(n,t,e){return _r((function(n){return t(n)}),qr,n,t,e)}(n,(function(n){return t(n).isSome()}),e).bind(t)},Cd=zn("element","descHandler");function Ed(){var n={};return{registerId:function(t,e,r){Dn.each(r,(function(r,o){var i=void 0!==n[o]?n[o]:{};i[e]=function(n,t){return{handler:c.curry.apply(void 0,[n.handler].concat(t)),purpose:n.purpose}}(r,t),n[o]=i}))},unregisterId:function(t){Dn.each(n,(function(n,e){n.hasOwnProperty(t)&&delete n[t]}))},filterByType:function(t){return re(n,t).map((function(n){return Dn.mapToArray(n,(function(n,t){return function(n,t){return{id:c.constant(n),descHandler:c.constant(t)}}(t,n)}))})).getOr([])},find:function(t,e,r){var o=te(e)(n);return kd(r,(function(n){return t=o,Oa(e=n).fold((function(n){return N.none()}),(function(n){var r=te(n);return t.bind(r).map((function(n){return Cd(e,n)}))}));var t,e}),t)}}}var Ad=function(n){var t=function(t){return ot(n.element()).fold((function(){return!0}),(function(n){return Zn(t,n)}))},e=function(){var n=Ed(),t={},e=function(e){Oa(e.element()).each((function(e){t[e]=void 0,n.unregisterId(e)}))};return{find:function(t,e,r){return n.find(t,e,r)},filter:function(t){return n.filterByType(t)},register:function(r){var o,i,u=(i=(o=r).element(),Oa(i).fold((function(){return function(n,t){var e=Uu(xa+n);return Vt(t,wa,e),e}("uid-",o.element())}),(function(n){return n})));ue(t,u)&&function(n,r){var o=t[r];if(o!==n)throw new Error('The tagId "'+r+'" is already used by: '+zt(o.element())+"\nCannot use it for: "+zt(n.element())+"\nThe conflicting element is"+(kt.inBody(o.element())?" ":" not ")+"already in the DOM");e(n)}(r,u);var a=[r];n.registerId(a,u,r.events()),t[u]=r},unregister:e,getById:function(n){return te(n)(t)}}}(),r=function(n,r){return e.find(t,n,r)},o=function(n,t){var e,r,o,i,u=tr.asRawOrDie("Getting GUI events settings",yd,t),a=vn.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],c=Wf(u),s=K(a.concat(["selectstart","input","contextmenu","change","transitionend","dragstart","dragover","drop"]),(function(t){return If(n,t,(function(n){c.fireIfReady(n,t).each((function(t){t&&n.kill()})),u.triggerEvent(t,n)&&n.kill()}))})),f=If(n,"keydown",(function(n){var t;u.triggerEvent("keydown",n)?n.kill():!0!==u.stopBackspace||(t=n).raw().which!==Ho.BACKSPACE()[0]||on(["input","textarea"],wt.name(t.target()))||n.prevent()})),l=(e=n,r=function(n){u.triggerEvent("focusin",n)&&n.kill()},hd?Hf(e,"focus",r):If(e,"focusin",r)),d=(o=n,i=function(n){u.triggerEvent("focusout",n)&&n.kill(),setTimeout((function(){u.triggerEvent(yn.postBlur(),n)}),0)},hd?Hf(o,"blur",i):If(o,"focusout",i)),m=rt(n),g=If(m,"scroll",(function(n){u.broadcastEvent(yn.windowScroll(),n)&&n.kill()}));return{unbind:function(){X(s,(function(n){n.unbind()})),f.unbind(),l.unbind(),d.unbind(),g.unbind()}}}(n.element(),{triggerEvent:function(n,t){return ve(n,t.target(),(function(e){return function(n,t,e,r){var o=e.target();return Od(n,t,e,o,r)}(r,n,t,e)}))},broadcastEvent:function(n,t){return function(n,t,e){var r=function(n){var t=Ur(!1);return{stop:function(){t.set(!0)},cut:c.noop,isStopped:t.get,isCut:c.constant(!1),event:c.constant(n),setTarget:c.die(new Error("Cannot set target of a broadcasted event")),getTarget:c.die(new Error("Cannot get target of a broadcasted event"))}}(t);return X(n,(function(n){var t=n.descHandler();Es(t)(r)})),r.isStopped()}(e.filter(n),t)}}),i=vs({debugInfo:c.constant("real"),triggerEvent:function(n,t,e){ve(n,t,(function(o){Td(r,n,e,t,o)}))},triggerFocus:function(n,t){Oa(n).fold((function(){Jr(n)}),(function(e){ve(yn.focus(),n,(function(e){!function(n,t,e,r,o){var i=bd(e,r);xd(n,t,e,r,i,o)}(r,yn.focus(),{originator:c.constant(t),target:c.constant(n)},n,e)}))}))},triggerEscape:function(n,t){i.triggerEvent("keydown",n.element(),t.event())},getByUid:function(n){return g(n)},getByDom:function(n){return p(n)},build:Ws.build,addToGui:function(n){s(n)},removeFromGui:function(n){f(n)},addToWorld:function(n){u(n)},removeFromWorld:function(n){a(n)},broadcast:function(n){d(n)},broadcastOn:function(n,t){m(n,t)}}),u=function(n){n.connect(i),wt.isText(n.element())||(e.register(n),X(n.components(),u),i.triggerEvent(yn.systemInit(),n.element(),{target:c.constant(n.element())}))},a=function(n){wt.isText(n.element())||(X(n.components(),a),e.unregister(n)),n.disconnect()},s=function(t){Dt(n,t)},f=function(n){Bt(n)},l=function(n){var t=e.filter(yn.receive());X(t,(function(t){var e=t.descHandler();Es(e)(n)}))},d=function(n){l({universal:c.constant(!0),data:c.constant(n)})},m=function(n,t){l({universal:c.constant(!1),channels:c.constant(n),data:c.constant(t)})},g=function(n){return e.getById(n).fold((function(){return Ut.error(new Error('Could not find component with uid: "'+n+'" in system.'))}),Ut.value)},p=function(n){return Oa(n).bind(g)};return u(n),{root:c.constant(n),element:n.element,destroy:function(){o.unbind(),pt(n.element())},add:s,remove:f,getByUid:g,getByDom:p,addToWorld:u,removeFromWorld:a,broadcast:d,broadcastOn:m}},Md=c.constant(Do.resolve("readonly-mode")),Dd=c.constant(Do.resolve("edit-mode"));function Rd(n){var t=Ws.build(Vc.sketch({dom:{classes:[Do.resolve("outer-container")].concat(n.classes)},containerBehaviours:Ar.derive([$r.config({alpha:Md(),omega:Dd()})])}));return Ad(t)}var Bd=function(n,t){var e=qn("input");di(e,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),lt(n,e),Jr(e),t(e),pt(e)},Fd=function(n){var t=n.getSelection();if(t.rangeCount>0){var e=t.getRangeAt(0),r=n.document.createRange();r.setStart(e.startContainer,e.startOffset),r.setEnd(e.endContainer,e.endOffset),t.removeAllRanges(),t.addRange(r)}},Id=function(n,t){Zr().each((function(n){Zn(n,t)||Qr(n)})),n.focus(),Jr(Kn(n.document.body)),Fd(n)},Hd={stubborn:function(n,t,e,r){var o=function(){Id(t,r)},i=If(e,"keydown",(function(n){on(["input","textarea"],wt.name(n.target()))||o()}));return{toReading:function(){Bd(n,Qr)},toEditing:o,onToolbarTouch:function(){},destroy:function(){i.unbind()}}},timid:function(n,t,e,r){var o=function(){Qr(r)};return{toReading:function(){o()},toEditing:function(){Id(t,r)},onToolbarTouch:function(){o()},destroy:c.noop}}},Vd=function(n){var t=N.none(),e=[],r=function(n){o()?i(n):e.push(n)},o=function(){return t.isSome()},i=function(n){t.each((function(t){setTimeout((function(){n(t)}),0)}))};return n((function(n){t=N.some(n),function(n){X(n,i)}(e),e=[]})),{get:r,map:function(n){return Vd((function(t){r((function(e){t(n(e))}))}))},isReady:o}},Nd={nu:Vd,pure:function(n){return Vd((function(t){t(n)}))}},jd=function(n){var t=function(t){n(function(n){return function(){var t=Array.prototype.slice.call(arguments),e=this;setTimeout((function(){n.apply(e,t)}),0)}}(t))};return{map:function(n){return jd((function(e){t((function(t){var r=n(t);e(r)}))}))},bind:function(n){return jd((function(e){t((function(t){n(t).get(e)}))}))},anonBind:function(n){return jd((function(e){t((function(t){n.get(e)}))}))},toLazy:function(){return Nd.nu(t)},get:t}},Pd={nu:jd,pure:function(n){return jd((function(t){t(n)}))}},Ld=function(n,t){var e=et(n).dom().defaultView;return bi(n)+bi(t)-function(n){var t,e=Nf(n).isPortrait(),r=function(n,t){return se([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],(function(e){return n<=e.width&&t<=e.height?N.some(e.keyboard):N.none()})).getOr({portrait:t/5,landscape:n/4})}((t=n).screen.width,t.screen.height),o=e?r.portrait:r.landscape;return(e?n.screen.height:n.screen.width)-n.innerHeight>o?0:o}(e)},Wd=Ld,zd=function(n,t,e){var r=Ld(t,e),o=bi(t)+bi(e)-r;li(n,"padding-bottom",o+"px")},Gd=_t([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),$d="data-"+Do.resolve("position-y-fixed"),Ud="data-"+Do.resolve("y-property"),_d="data-"+Do.resolve("scrolling"),qd="data-"+Do.resolve("last-window-height"),Kd=function(n){return $f(n,$d)},Xd=function(n,t){var e=jt(n,Ud);return Gd.fixed(n,e,t)},Yd=function(n,t){return Gd.scroller(n,t)},Jd=function(n){var t=Kd(n);return("true"===jt(n,_d)?Yd:Xd)(n,t)},Qd=function(n,t,e){var r=et(n).dom().defaultView.innerHeight;return Vt(n,qd,r+"px"),r-t-e},Zd=Kd,nm=function(){var n=null;return{animate:function(t,e,r,o,i,u){var a=!1,c=function(n){a=!0,i(n)};clearInterval(n);var s=function(t){clearInterval(n),c(t)};n=setInterval((function(){var i=t();(function(n,t,e){return Math.abs(n-t)<=e?N.none():n<t?N.some(n+e):N.some(n-e)})(i,e,r).fold((function(){clearInterval(n),c(e)}),(function(r){if(o(r,s),!a){var u=t();(u!==r||Math.abs(u-e)>Math.abs(i-e))&&(clearInterval(n),c(e))}}))}),u)}}}(),tm="data-"+Do.resolve("last-scroll-top"),em=function(n){var t=pi(n,"top").getOr(0);return parseInt(t,10)},rm=function(n){return parseInt(n.dom().scrollTop,10)},om=function(n,t){var e=t+Zd(n)+"px";li(n,"top",e)},im=function(n,t,e){return Pd.nu((function(r){var o=c.curry(rm,n);nm.animate(o,t,15,(function(t){n.dom().scrollTop=t,li(n,"top",em(n)+15+"px")}),(function(){n.dom().scrollTop=t,li(n,"top",e+"px"),r(t)}),10)}))},um=function(n,t){return Pd.nu((function(e){var r=c.curry(rm,n);Vt(n,tm,r());var o=Math.abs(t-r()),i=Math.ceil(o/10);nm.animate(r,t,i,(function(t,e){$f(n,tm)!==n.dom().scrollTop?e(n.dom().scrollTop):(n.dom().scrollTop=t,Vt(n,tm,t))}),(function(){n.dom().scrollTop=t,Vt(n,tm,t),e(t)}),10)}))},am=function(n,t){var e=function(n){var t=Lo(n,"["+$d+"]");return K(t,Jd)}(n);return function(n){return function(n,t){return t((function(t){var e=[],r=0;0===n.length?t([]):X(n,(function(o,i){var u;o.get((u=i,function(o){e[u]=o,++r>=n.length&&t(e)}))}))}))}(n,Pd.nu)}(K(e,(function(n){return function(n,t){return n.fold((function(n,e,r){return i=t+(o=r),li(n,e,i+"px"),Pd.pure(o);var o,i}),(function(n,e){return i=t+(o=e),u=pi(r=n,"top").getOr(o),a=i-parseInt(u,10),c=r.dom().scrollTop+a,im(r,c,i);var r,o,i,u,a,c}))}(n,t)})))},cm=function(n){var t=n.cWin(),e=n.ceBody(),r=n.socket(),o=n.toolstrip(),i=n.toolbar(),u=n.contentElement(),a=n.keyboardType(),s=n.outerWindow(),f=n.dropup(),l=function(n,t,e,r){var o,i,u,a,s,f,l,d,m=et(n).dom().defaultView,g=(d=jt(l=e,"style"),di(l,{position:"absolute",top:"0px"}),Vt(l,$d,"0px"),Vt(l,Ud,"top"),{restore:function(){Vt(l,"style",d||""),Lt(l,$d),Lt(l,Ud)}}),p=bi(e),v=bi(r),h=(u=p,a=Qd(n,p,v),f=jt(s=n,"style"),xf.register(s),di(s,{position:"absolute",height:a+"px",width:"100%",top:u+"px"}),Vt(s,$d,u+"px"),Vt(s,_d,"true"),Vt(s,Ud,"top"),{restore:function(){xf.deregister(s),Vt(s,"style",f||""),Lt(s,$d),Lt(s,_d),Lt(s,Ud)}}),y=(i=jt(o=r,"style"),di(o,{position:"absolute",bottom:"0px"}),Vt(o,$d,"0px"),Vt(o,Ud,"bottom"),{restore:function(){Vt(o,"style",i||""),Lt(o,$d),Lt(o,Ud)}}),b=!0,S=function(){return m.innerHeight>$f(n,qd)},x=function(){if(b){var o=bi(e),i=bi(r),u=Qd(n,o,i);Vt(n,$d,o+"px"),li(n,"height",u+"px"),li(r,"bottom",-(o+u+i)+"px"),zd(t,n,r)}};return zd(t,n,r),{setViewportOffset:function(t){Vt(n,$d,t+"px"),x()},isExpanding:S,isShrinking:c.not(S),refresh:x,restore:function(){b=!1,g.restore(),h.restore(),y.restore()}}}(r,e,o,f),d=a(n.outerBody(),t,kt.body(),u,o,i),m=jf(s,{onChange:c.noop,onReady:l.refresh});m.onAdjustment((function(){l.refresh()}));var g=If(Kn(s),"resize",(function(){l.isExpanding()&&l.refresh()})),p=function(n,t,e,r,o,i){var u,a,s=(u=function(e){return function(n,t,e){var r=et(n).dom().defaultView;return Pd.nu((function(o){om(n,e),om(t,e),r.scrollTo(0,e),o(e)}))}(n,t,e)},a=Ur(Nd.pure({})),{start:function(n){var t=Nd.nu((function(t){return u(n).get(t)}));a.set(t)},idle:function(n){a.get().get((function(){n()}))}}),f=Fl((function(){s.idle((function(){am(e,r.pageYOffset).get((function(){var n;(n=dl(i),N.from(n[0]).bind((function(n){var e=n.top()-t.dom().scrollTop;return e>r.innerHeight+5||e<-5?N.some({top:c.constant(e),bottom:c.constant(e+n.height())}):N.none()}))).each((function(n){t.dom().scrollTop=t.dom().scrollTop+n.top()})),s.start(0),o.refresh()}))}))}),1e3),l=If(Kn(r),"scroll",(function(){r.pageYOffset<0||f.throttle()}));return am(e,r.pageYOffset).get(c.identity),{unbind:l.unbind}}(o,r,n.outerBody(),s,l,t),v=function(n,t){var e=n.document,r=qn("div");jr(r,Do.resolve("unfocused-selections")),lt(Kn(e.documentElement),r);var o=If(r,"touchstart",(function(e){e.prevent(),Id(n,t),u()})),i=function(n){var t=qn("span");return Bs(t,[Do.resolve("layer-editor"),Do.resolve("unfocused-selection")]),di(t,{left:n.left()+"px",top:n.top()+"px",width:n.width()+"px",height:n.height()+"px"}),t},u=function(){gt(r)};return{update:function(){u();var t=dl(n),e=K(t,i);dt(r,e)},isActive:function(){return ut(r).length>0},destroy:function(){o.unbind(),pt(r)},clear:u}}(t,u),h=function(){v.clear()};return{toEditing:function(){d.toEditing(),h()},toReading:function(){d.toReading()},onToolbarTouch:function(n){d.onToolbarTouch(n)},refreshSelection:function(){v.isActive()&&v.update()},clearSelection:h,highlightSelection:function(){v.update()},scrollIntoView:function(n,e){!function(n,t,e,r,o){var i=Wd(t,e),u=c.curry(Fd,n);r>i||o>i?um(t,t.dom().scrollTop-i+o).get(u):r<0&&um(t,t.dom().scrollTop+r).get(u)}(t,r,f,n,e)},updateToolbarPadding:c.noop,setViewportOffset:function(n){l.setViewportOffset(n),function(n,t){return Pd.nu((function(e){var r=c.curry(em,n),o=function(t){li(n,"top",t+"px")},i=Math.abs(t-r()),u=Math.ceil(i/10);nm.animate(r,t,u,o,(function(){o(t),e(t)}),10)}))}(r,n).get(c.identity)},syncHeight:function(){li(u,"height",u.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:l.refresh,destroy:function(){l.restore(),m.destroy(),p.unbind(),g.unbind(),d.destroy(),v.destroy(),Bd(kt.body(),Qr)}}},sm=function(n){var t=tr.asRawOrDie("Getting IosWebapp schema",Hl,n);li(t.toolstrip,"width","100%"),li(t.container,"position","relative");var e=Ws.build(Il((function(){t.setReadOnly(!0),r.enter()}),t.translate));t.alloy.add(e);var r=function(n,t){var e=Rl(),r=fs(),o=fs(),i=ss(),u=ss();return{enter:function(){t.hide();var a=Kn(document);Tl.getActiveApi(n.editor).each((function(t){r.set({socketHeight:pi(n.socket,"height"),iframeHeight:pi(t.frame(),"height"),outerScroll:document.body.scrollTop}),o.set({exclusives:Kl(a,"."+xf.scrollable())}),jr(n.container,Do.resolve("fullscreen-maximized")),Ml(n.container,t.body()),e.maximize(),li(n.socket,"overflow","scroll"),li(n.socket,"-webkit-overflow-scrolling","touch"),Jr(t.body());var s=Gn(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);i.set(cm(s({cWin:t.win(),ceBody:t.body(),socket:n.socket,toolstrip:n.toolstrip,toolbar:n.toolbar,dropup:n.dropup.element(),contentElement:t.frame(),cursor:c.noop,outerBody:n.body,outerWindow:n.win,keyboardType:Hd.stubborn,isScrolling:function(){return o.get().exists((function(n){return n.socket.isScrolling()}))}}))),i.run((function(n){n.syncHeight()})),u.set(function(n,t,e,r,o){var i=function(){t.run((function(n){n.refreshSelection()}))},u=function(n,e){var o=n-r.dom().scrollTop;t.run((function(n){n.scrollIntoView(o,o+e)}))},a=function(){t.run((function(n){n.clearSelection()}))},c=function(){n.getCursorBox().each((function(n){u(n.top(),n.height())})),t.run((function(n){n.syncHeight()}))},s=zf(n),f=Fl(c,300),l=[n.onKeyup((function(){a(),f.throttle()})),n.onNodeChanged(i),n.onDomChanged(f.throttle),n.onDomChanged(i),n.onScrollToCursor((function(n){n.preventDefault(),f.throttle()})),n.onScrollToElement((function(n){n.element(),u(t,r)})),n.onToEditing((function(){t.run((function(n){n.toEditing()}))})),n.onToReading((function(){t.run((function(n){n.toReading()}))})),If(n.doc(),"touchend",(function(t){Zn(n.html(),t.target())||Zn(n.body(),t.target())})),If(e,"transitionend",(function(n){var r;"height"===n.raw().propertyName&&(r=bi(e),t.run((function(n){n.setViewportOffset(r)})),i(),c())})),Hf(e,"touchstart",(function(e){var r;t.run((function(n){n.highlightSelection()})),r=e,t.run((function(n){n.onToolbarTouch(r)})),n.onTouchToolstrip()})),If(n.body(),"touchstart",(function(t){a(),n.onTouchContent(),s.fireTouchstart(t)})),s.onTouchmove(),s.onTouchend(),If(n.body(),"click",(function(n){n.kill()})),If(e,"touchmove",(function(){n.onToolbarScrollStart()}))];return{destroy:function(){X(l,(function(n){n.unbind()}))}}}(t,i,n.toolstrip,n.socket,n.dropup))}))},refreshStructure:function(){i.run((function(n){n.refreshStructure()}))},exit:function(){e.restore(),u.clear(),i.clear(),t.show(),r.on((function(t){t.socketHeight.each((function(t){li(n.socket,"height",t)})),t.iframeHeight.each((function(t){li(n.editor.getFrame(),"height",t)})),document.body.scrollTop=t.scrollTop})),r.clear(),o.on((function(n){n.exclusives.unbind()})),o.clear(),Pr(n.container,Do.resolve("fullscreen-maximized")),Dl(),xf.deregister(n.toolbar),mi(n.socket,"overflow"),mi(n.socket,"-webkit-overflow-scrolling"),Qr(n.editor.getFrame()),Tl.getActiveApi(n.editor).each((function(n){n.clearSelection()}))}}}(t,{show:function(){t.alloy.add(e)},hide:function(){t.alloy.remove(e)}});return{setReadOnly:t.setReadOnly,refreshStructure:r.refreshStructure,enter:r.enter,exit:r.exit,destroy:c.noop}},fm=tinymce.util.Tools.resolve("tinymce.EditorManager"),lm=function(n,t,e){n.system().broadcastOn([ro.formatChanged()],{command:t,state:e})},dm=(c.constant(["x-small","small","medium","large","x-large"]),function(n){var t=function(){n._skinLoaded=!0,n.fire("SkinLoaded")};return function(){n.initialized?t():n.on("init",t)}}),mm=c.constant("toReading"),gm=c.constant("toEditing");eo.add("mobile",(function(n){return{getNotificationManagerImpl:function(){return{open:c.identity,close:c.noop,reposition:c.noop,getArgs:c.identity}},renderUI:function(t){var e=function(n){var t=re(n.settings,"skin_url").fold((function(){return fm.baseURL+"/skins/lightgray"}),(function(n){return n}));return{content:t+"/content.mobile.min.css",ui:t+"/skin.mobile.min.css"}}(n);!1===function(n){return!1===n.settings.skin}(n)?(n.contentCSS.push(e.content),to.DOM.styleSheetLoader.load(e.ui,dm(n))):dm(n)();var r,o,i,u,a,s,f,l,d,m,g,p,v,h,y=function(){n.fire("scrollIntoView")},b=qn("div"),S=vn.detect().os.isAndroid()?(l=y,d=Rd({classes:[Do.resolve("android-container")]}),m=Xl(),g=ss(),p=Ql(g),v=Zl(),h=vd(c.noop,l),d.add(m.wrapper()),d.add(v),d.add(h.component()),{system:c.constant(d),element:d.element,init:function(n){g.set(function(n){var t=tr.asRawOrDie("Getting AndroidWebapp schema",Hl,n);li(t.toolstrip,"width","100%");var e=Ws.build(Il((function(){t.setReadOnly(!0),o.enter()}),t.translate));t.alloy.add(e);var r={show:function(){t.alloy.add(e)},hide:function(){t.alloy.remove(e)}};lt(t.container,e.element());var o=Bl(t,r);return{setReadOnly:t.setReadOnly,refreshStructure:c.noop,enter:o.enter,exit:o.exit,destroy:c.noop}}(n))},exit:function(){g.run((function(n){n.exit(),af.remove(v,p)}))},setToolbarGroups:function(n){var t=m.createGroups(n);m.setGroups(t)},setContextToolbar:function(n){var t=m.createGroups(n);m.setContextToolbar(t)},focusToolbar:function(){m.focus()},restoreToolbar:function(){m.restoreToolbar()},updateMode:function(n){nd(v,p,n,d.root())},socket:c.constant(v),dropup:c.constant(h)}):(r=y,o=Rd({classes:[Do.resolve("ios-container")]}),i=Xl(),u=ss(),a=Ql(u),s=Zl(),f=vd((function(){u.run((function(n){n.refreshStructure()}))}),r),o.add(i.wrapper()),o.add(s),o.add(f.component()),{system:c.constant(o),element:o.element,init:function(n){u.set(sm(n))},exit:function(){u.run((function(n){af.remove(s,a),n.exit()}))},setToolbarGroups:function(n){var t=i.createGroups(n);i.setGroups(t)},setContextToolbar:function(n){var t=i.createGroups(n);i.setContextToolbar(t)},focusToolbar:function(){i.focus()},restoreToolbar:function(){i.restoreToolbar()},updateMode:function(n){nd(s,a,n,o.root())},socket:c.constant(s),dropup:c.constant(f)}),x=Kn(t.targetNode);st(x,b),function(n,t){lt(n,t.element());var e=ut(t.element());X(e,(function(n){t.getByDom(n).each(Et)}))}(b,S.system());var w=t.targetNode.ownerDocument.defaultView,O=jf(w,{onChange:function(){S.system().broadcastOn([ro.orientationChanged()],{width:Pf(w)})},onReady:c.noop}),T=function(t,e,r){!1===r&&n.selection.collapse(),S.setToolbarGroups(r?t.get():e.get()),n.setMode(!0===r?"readonly":"design"),n.fire(!0===r?mm():gm()),S.updateMode(r)},k=function(t,e){return n.on(t,e),{unbind:function(){n.off(t)}}};return n.on("init",(function(){S.init({editor:{getFrame:function(){return Kn(n.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:c.noop}},onToReading:function(n){return k(mm(),n)},onToEditing:function(n){return k(gm(),n)},onScrollToCursor:function(t){return n.on("scrollIntoView",(function(n){t(n)})),{unbind:function(){n.off("scrollIntoView"),O.destroy()}}},onTouchToolstrip:function(){t()},onTouchContent:function(){var e;(e=Kn(n.editorContainer.querySelector("."+Do.resolve("toolbar"))),no(e).bind((function(n){return S.system().getByDom(n).toOption()}))).each(Hn),S.restoreToolbar(),t()},onTapContent:function(t){var e=t.target();"img"===wt.name(e)?(n.selection.select(e.dom()),t.kill()):"a"===wt.name(e)&&S.system().getByDom(Kn(n.editorContainer)).each((function(n){$r.isAlpha(n)&&function(n){var t=document.createElement("a");t.target="_blank",t.href=n.href,t.rel="noreferrer noopener";var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(t),t.dispatchEvent(e),document.body.removeChild(t)}(e.dom())}))}},container:Kn(n.editorContainer),socket:Kn(n.contentAreaContainer),toolstrip:Kn(n.editorContainer.querySelector("."+Do.resolve("toolstrip"))),toolbar:Kn(n.editorContainer.querySelector("."+Do.resolve("toolbar"))),dropup:S.dropup(),alloy:S.system(),translate:c.noop,setReadOnly:function(n){T(s,a,n)}});var t=function(){S.dropup().disappear((function(){S.system().broadcastOn([ro.dropupDismissed()],{})}))};he("remove this",S.system());var e={label:"The first group",scrollable:!1,items:[Wa("back",(function(){n.selection.collapse(),S.exit()}),{})]},r={label:"Back to read only",scrollable:!1,items:[Wa("readonly-back",(function(){T(s,a,!0)}),{})]},o=function(n,t){var e=function(n){return function(){return function(n,t){return La(t,(function(){n.execCommand(t)}),{})}(t,n)}},r=function(n){return function(){return function(n,t){var e=Pa(t);return La(t,(function(){n.execCommand(t)}),e)}(t,n)}},o=function(n,t,e){return function(){return za(0,n,t,e)}},i=e("undo"),u=e("redo"),a=r("bold"),c=r("italic"),s=r("underline"),f=e("removeformat"),l=o("unlink","link",(function(){t.execCommand("unlink",null,!1)})),d=o("unordered-list","ul",(function(){t.execCommand("InsertUnorderedList",null,!1)})),m=o("ordered-list","ol",(function(){t.execCommand("InsertOrderedList",null,!1)})),g=Ef(t,t.settings),p=function(){return function(n,t,e){var r,o,i;return function(n){var t,e,r,o,i,u=(e=function(){return a},r=Tf("Styles",[].concat(K((t=n.formats).items,(function(n){return Of(wf(n),n.title,n.isSelected(),n.getPreview(),ue(t.expansions,wf(n)))}))),e,!1),o=Dn.map(t.menus,(function(n,r){var o=K(n,(function(n){return Of(wf(n),n.title,void 0!==n.isSelected&&n.isSelected(),void 0!==n.getPreview?n.getPreview():"",ue(t.expansions,wf(n)))}));return Tf(r,o,e,!0)})),i=Tn.deepMerge(o,oe("styles",r)),{tmenu:ff.tieredData("styles",i,t.expansions)}),a=Sc(ff.sketch({dom:{tag:"div",classes:[Do.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(t,e){var r=ic.getValue(e);n.handle(e,r.value)},onEscape:function(){},onOpenMenu:function(n,t){var e=fc(n.element());sc(t.element(),e),bf.jumpTo(t,"current")},onOpenSubmenu:function(n,t,e){var r=fc(n.element()),o=Go(t.element(),'[role="menu"]').getOrDie("hacky"),i=n.getSystem().getByDom(o).getOrDie();sc(e.element(),r),bf.progressTo(i,"before"),bf.jumpTo(e,"after"),bf.progressTo(e,"current")},onCollapseMenu:function(n,t,e){var r=Go(t.element(),'[role="menu"]').getOrDie("hacky"),o=n.getSystem().getByDom(r).getOrDie();bf.progressTo(o,"after"),bf.progressTo(e,"current")},navigateOnHover:!1,openImmediately:!0,data:u.tmenu,markers:{backgroundMenu:Do.resolve("styles-background-menu"),menu:Do.resolve("styles-menu"),selectedMenu:Do.resolve("styles-selected-menu"),item:Do.resolve("styles-item"),selectedItem:Do.resolve("styles-selected-item")}}));return a.asSpec()}({formats:(r=n,i=(o=function(n){return en(n,(function(n){return void 0!==n.items?o(n.items).length>0?[n]:[]:!ue(n,"format")||r.formatter.canApply(n.format)?[n]:[]}))})(t),Cf.expand(i)),handle:function(t,r){n.undoManager.transact((function(){ko.isOn(t)?n.formatter.remove(r):n.formatter.apply(r)})),e()}})}(t,g,(function(){t.fire("scrollIntoView")}))},v=function(n,e){return{isSupported:function(){return n.forall((function(n){return ue(t.buttons,n)}))},sketch:e}};return{undo:v(N.none(),i),redo:v(N.none(),u),bold:v(N.none(),a),italic:v(N.none(),c),underline:v(N.none(),s),removeformat:v(N.none(),f),link:v(N.none(),(function(){return ms(n,t)})),unlink:v(N.none(),l),image:v(N.none(),(function(){return Tc(t)})),bullist:v(N.some("bullist"),d),numlist:v(N.some("numlist"),m),fontsizeselect:v(N.none(),(function(){return function(n,t){var e={onChange:function(n){yc.apply(t,n)},getInitialValue:function(){return yc.get(t)}};return mc(n,"font-size",(function(){return function(n){return[ja('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),(t=n,pc({onChange:t.onChange,sizes:bc,category:"font",getInitialValue:t.getInitialValue})),ja('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')];var t}(e)}))}(n,t)})),forecolor:v(N.none(),(function(){return function(n,t){var e={onChange:function(n,e,r){t.undoManager.transact((function(){t.formatter.apply("forecolor",{value:r}),t.nodeChanged()}))},getInitialValue:function(){return-1}};return mc(n,"color",(function(){return function(n){return[(t=n,e=function(n){return n<0?"black":n>360?"white":"hsl("+n+", 100%, 50%)"},dc.sketch({dom:Na('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[dc.parts()["left-edge"](ja('<div class="${prefix}-hue-slider-black"></div>')),dc.parts().spectrum({dom:Na('<div class="${prefix}-slider-gradient-container"></div>'),components:[ja('<div class="${prefix}-slider-gradient"></div>')],behaviours:Ar.derive([ko.config({toggleClass:Do.resolve("thumb-active")})])}),dc.parts()["right-edge"](ja('<div class="${prefix}-hue-slider-white"></div>')),dc.parts().thumb({dom:Na('<div class="${prefix}-slider-thumb"></div>'),behaviours:Ar.derive([ko.config({toggleClass:Do.resolve("thumb-active")})])})],onChange:function(n,r,o){var i=e(o);li(r.element(),"background-color",i),t.onChange(n,r,i)},onDragStart:function(n,t){ko.on(t)},onDragEnd:function(n,t){ko.off(t)},onInit:function(n,t,r){var o=e(r);li(t.element(),"background-color",o)},stepSize:10,min:0,max:360,getInitialValue:t.getInitialValue,sliderBehaviours:Ar.derive([Eo(dc.refresh)])}))];var t,e}(e)}))}(n,t)})),styleselect:v(N.none(),(function(){return Wa("style-formats",(function(e){t.fire("toReading"),n.dropup().appear(p,ko.on,e)}),Ar.derive([ko.config({toggleClass:Do.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),po.config({channels:ie([Ao(ro.orientationChanged(),ko.off),Ao(ro.dropupDismissed(),ko.off)])})]))}))}}(S,n),i=function(n,t){var e=function(n){var t=void 0!==n.toolbar?n.toolbar:Af;return Sn.isArray(t)?Df(t):Mf(t)}(n),r={};return en(e,(function(n){var e=!ue(r,n)&&ue(t,n)&&t[n].isSupported()?[t[n].sketch()]:[];return r[n]=!0,e}))}(n.settings,o),u={label:"The extra group",scrollable:!1,items:[]},a=Ur([r,{label:"the action group",scrollable:!0,items:i},u]),s=Ur([e,{label:"The read only mode group",scrollable:!0,items:[]},u]);!function(n,t){var e=Dn.keys(t.formatter.get());X(e,(function(e){t.formatter.formatChanged(e,(function(t){lm(n,e,t)}))})),X(["ul","ol"],(function(e){t.selection.selectorChanged(e,(function(t,r){lm(n,e,t)}))}))}(S,n)})),{iframeContainer:S.socket().element().dom(),editorContainer:S.element().dom()}}}}))}();